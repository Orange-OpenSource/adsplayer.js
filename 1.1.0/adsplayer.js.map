{"version":3,"sources":["node_modules/browser-pack/_prelude.js","adsplayer.js","index.js","src/AdsPlayer.js","src/AdsPlayerController.js","src/Debug.js","src/ErrorHandler.js","src/EventBus.js","src/FileLoader.js","src/mast/MastParser.js","src/mast/TriggerManager.js","src/mast/model/Mast.js","src/media/ImagePlayer.js","src/media/VideoPlayer.js","src/utils/utils.js","src/utils/xmldom.js","src/vast/AdPlayer.js","src/vast/CreativePlayer.js","src/vast/TrackingEventsManager.js","src/vast/VastParser.js","src/vast/VastPlayerManager.js","src/vast/model/Vast.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","global","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","AdsPlayer","undefined","_AdsPlayer","_AdsPlayer2","context","window","adsplayer","this","self","./src/AdsPlayer","2","_classCallCheck","instance","Constructor","TypeError","_onError","_error","data","_onWarning","_warning","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","_AdsPlayerController","_AdsPlayerController2","_EventBus","_EventBus2","NAME","VERSION","GIT_TAG","BUILD_DATE","adsPlayerContainer","_adsPlayerContainer","_eventBus","getInstance","_adsPlayerController","onErrorListener","bind","onWarningListener","player","callback","init","addEventListener","stream","adsUrl","load","then","stop","reset","destroy","removeEventListener","indexOf","play","pause","type","listener","useCapture","./AdsPlayerController","./EventBus","3","_Debug","_Debug2","_FileLoader","_FileLoader2","_ErrorHandler","_ErrorHandler2","_MastParser","_MastParser2","_TriggerManager","_TriggerManager2","_VastParser","_VastParser2","_VastPlayerManager","_VastPlayerManager2","_utils","_utils2","AdsPlayerController","_mainPlayer","_mainVideo","_mast","_fileLoaders","_triggerManagers","_vastPlayerManager","_mastParser","_vastParser","_errorHandler","_debug","_onVideoPlayingListener","_onVideoPlaying","_onVideoTimeupdateListener","_onVideoTimeupdate","_onVideoEndedListener","_onVideoEnded","_onTriggerEndListener","_onTriggerEnd","url","_this","fileLoader","vast","Promise","resolve","log","result","parse","response","baseUrl","error","sendWarning","LOAD_VAST_FAILED","push","trigger","uri","loadVastPromises","sources","isAbsoluteURI","_loadVast","reject","all","vasts","ads","mastContent","mastBaseUrl","triggerManager","triggers","_checkTriggersStart","_activateTrigger","_checkTriggersEnd","paused","dispatchEvent","ended","_resumeVideo","_pauseVideo","id","start","firstTrigger","_this2","activated","_loadTriggerVasts","_playTrigger","checkStartConditions","getTrigger","checkEndConditions","splice","warn","getVideoModel","getElement","setLevel","_this3","_parseMastFile","_start","sendError","name","message","abort","./Debug","./ErrorHandler","./FileLoader","./mast/MastParser","./mast/TriggerManager","./utils/utils","./vast/VastParser","./vast/VastPlayerManager","4","Date","HHMMSSmmm","h","getHours","toString","m","getMinutes","getSeconds","ms","getMilliseconds","HH","MM","SS","mmm","MMSSmmm","MemoryLogger","logArray","showLevel","info","debug","getLogs","NONE","ERROR","WARN","INFO","DEBUG","ALL","_instance","Debug","_level","_showTimestamp","_showElapsedTime","_startTime","_logger","console","level","logLevel","args","logTime","_getStringLevel","Array","apply","forEach","item","getLevel","_prepareLog","_log","arguments","5","ErrorHandler","JSON","stringify","DOWNLOAD_ERR_FILES","DOWNLOAD_ERR_NOT_XML","NO_VALID_MEDIA_FOUND","LOAD_MEDIA_FAILED","UNSUPPORTED_MEDIA_FILE","UNAVAILABLE_LINK","6","EventBus","_registrations","captype","listeners","_getListeners","idx","evt","slice","defaultPrevented","7","FileLoader","_request","base","substring","lastIndexOf","DOMParser","parser","xmlDoc","parseFromString","getElementsByTagName","readyState","_parseBaseUrl","needFailureReport","onload","report","onabort","aborted","status","responseXML","_parseXml","responseText","responseURL","XMLHttpRequest","onloadend","onerror","open","timeout","send","_load","8","_Mast","_Mast2","_xmldom","_xmldom2","MastParser","conditionNode","condition","Condition","conditionNodes","getAttribute","operator","conditions","_getCondition","sourceNode","source","Source","sourceNodes","altReference","format","_getSource","triggerNode","Trigger","startConditionNodes","getSubElements","endConditionNodes","description","startConditions","endConditions","mastNode","mast","triggerNodes","_getTrigger","xmlDom","mast_","Mast","_getTriggers","../utils/xmldom","./model/Mast","9","TriggerManager","_trigger","str","timeParts","SECONDS_IN_HOUR","SECONDS_IN_MIN","split","parseInt","parseFloat","value1","value2","res","OPERATOR","EQ","NEQ","GTR","GEQ","LT","LEQ","MOD","video","currentTime","TYPE","EVENT","ON_ITEM_START","PROPERTY","POSITION","_compareValues","_parseTime","DURATION","duration","ON_ITEM_END","_evaluateCondition","_evaluateConditions","10","alreadyProcessed","FORMAT","VAST","UIF","11","ImagePlayer","_uri","_image","_duration","_currentTime","_ended","_listeners","_timerInterval","_timerTime","_events","time","getTime","_notifyEvent","_stopTimer","setInterval","_updateCurrentTime","clearInterval","mediaFiles","mediaFile","document","getElementById","createElement","autoplay","src","_addEventListener","_removeEventListener","_startTimer","../Debug","../utils/utils","12","VideoPlayer","_video","mimeType","HTMLMediaElement","canPlay","canPlayType","isMediaSupported","sort","b","bitrate","muted","volume","13","utils","toLowerCase","14","xmldom","node","elements","child","firstElementChild","firstChild","namespaceURI","getElementsByTagNameNS","getElements","subName","element","getChildNode","childNodes","nodeName","getNodeTextValue","cdataSection","textSection","nodeValue","getChildNodeTextValue","15","_CreativePlayer","_CreativePlayer2","AdPlayer","_ad","_adPlayerContainer","_baseUrl","_creativeIndex","_creativePlayer","_onCreativeEndListener","_onCreativeEnd","impressions","impression","http","setRequestHeader","_stopCreative","_playNextCreative","index","linear","creative","inLine","creatives","_playCreative","ad","adPlayerContainer","mainVideo","_sendImpressions","_resumeCreative","_pauseCreative","../EventBus","./CreativePlayer","16","_TrackingEventsManager","_TrackingEventsManager2","_VideoPlayer","_VideoPlayer2","_ImagePlayer","_ImagePlayer2","CreativePlayer","_mediaPlayer","_trackingEventsManager","_onMediaPlayListener","_onMediaPlay","_onMediaPauseListener","_onMediaPause","_onMediaErrorListener","_onMediaError","_onMediaTimeupdateListener","_onMediaTimeupdate","_onMediaEndedListener","_onMediaEnded","setVolume","videoClicks","clickThrough","isVideo","isImage","setDuration","trackingEvents","getType","appendChild","style","cursor","_onAdClick","_onMainVideoVolumeChange","_play","removeChild","_pause","_stop","../media/ImagePlayer","../media/VideoPlayer","./TrackingEventsManager","17","TrackingEventsManager","_trackingEvents","_adMediaPlayer","_mute","_unmute","_eventListeners","xhr","eventType","trackingEvent","_listener","completed","event","_postEvent","oneShot","_eventListener","_loop","isEnded","getCurrentTime","getDuration","getVolume","state","fullScreen","mozFullScreen","webkitIsFullScreen","offsetPercent","offsetInSeconds","adMediaPlayer","_addPlayerEventListeners","_removePlayerEventListeners","18","_Vast","_Vast2","VastParser","trackingNode","TrackingEvent","offsetValue","videoClicksNode","VideoClicks","clickTracking","customClick","mediaFileNode","MediaFile","delivery","width","height","scalable","maintainAspectRatio","apiFramework","linearNode","Linear","trackingNodes","mediaFileNodes","adParameters","_getTrackingEvent","_getVideoClicks","_getMediaFile","creativeNode","Creative","adId","sequence","_getLinear","adNode","InLine","inLineNode","impressionNodes","creativeNodes","adSystem","adTitle","survey","Impression","_getCreative","Ad","_getInLine","vastNode","vast_","adNodes","_getAd","Vast","version","_getAds","./model/Vast","19","_AdPlayer","_AdPlayer2","VastPlayerManager","_vasts","_adIndex","_adPlayer","_onAdEndListener","_onAdEnd","_stopAd","_playNextAd","_vastIndex","_playAd","_playNextVast","_playVast","_resumeAd","_pauseAd","./AdPlayer","20","wrapper","extensions","Extensions","other","CompanionAds","nonLinearAds","LINEAR","NON_LINEAR_ADS","COMPANION_ADS","Companion","staticResource","iFrameResource","hTMLResource","altText","NonLinear","expandedWidth","expandedHeight","CREATIVEVIEW","START","MIDPOINT","FIRSTQUARTILE","THIRDQUARTILE","COMPLETE","MUTE","UNMUTE","PAUSE","REWIND","RESUME","FULLSCREEN","EXPAND","COLLAPSE","ACCEPTINVITATION","CLOSE","DELIVERY","STREAMING","PROGRESSIVE","StaticResource","uRI","creativeType"],"mappings":"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","file":"adsplayer.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function (global){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.AdsPlayer = undefined;\n\nvar _AdsPlayer = require('./src/AdsPlayer');\n\nvar _AdsPlayer2 = _interopRequireDefault(_AdsPlayer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Shove both of these into the global scope\nvar context = typeof window !== 'undefined' && window || global;\n\nvar adsplayer = context.adsplayer;\nif (!adsplayer) {\n    adsplayer = context.adsplayer = {};\n}\n\nadsplayer.AdsPlayer = _AdsPlayer2.default;\n\nexports.default = adsplayer;\nexports.AdsPlayer = _AdsPlayer2.default;\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./src/AdsPlayer\":2}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* AdsPlayer.\n* @constructor AdsPlayer\n* @param {Object} adsPlayerContainer - the DOM container in which &lt;video&gt; and &lt;img&gt; HTML components will be appended\n*/\n\nvar _AdsPlayerController = require('./AdsPlayerController');\n\nvar _AdsPlayerController2 = _interopRequireDefault(_AdsPlayerController);\n\nvar _EventBus = require('./EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NAME = 'AdsPlayer';\nvar VERSION = '1.1.0';\nvar GIT_TAG = 'd5d04cf';\nvar BUILD_DATE = '2017-5-3_15:14:51';\n\n///////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\nfunction _onError(e) {\n    this._error = e.data;\n}\n\nfunction _onWarning(e) {\n    this._warning = e.data;\n}\n\nvar AdsPlayer = function () {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    function AdsPlayer(adsPlayerContainer) {\n        _classCallCheck(this, AdsPlayer);\n\n        this._adsPlayerContainer = adsPlayerContainer;\n        this._error = null;\n        this._warning = null;\n        this._eventBus = _EventBus2.default.getInstance();\n        this._adsPlayerController = null;\n\n        this.onErrorListener = _onError.bind(this);\n        this.onWarningListener = _onWarning.bind(this);\n    }\n\n    // Plugin API\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * Returns the plugin name.\n    * @method getName\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {string} the plugin name\n    */\n\n\n    _createClass(AdsPlayer, [{\n        key: 'getName',\n        value: function getName() {\n            return NAME;\n        }\n\n        /**\n        * [Plugin API, invoked by hasplayer.js]\n        * Initializes the plugin.\n        * @method init\n        * @access public\n        * @memberof AdsPlayer#\n        * @param {Object} player - the MediaPlayer\n        * @param {function} callback - the callback function to invoke when initialization is done\n        */\n\n    }, {\n        key: 'init',\n        value: function init(player, callback) {\n            this._adsPlayerController = new _AdsPlayerController2.default();\n            this._adsPlayerController.init(player, this._adsPlayerContainer);\n            this._eventBus.addEventListener('error', this.onErrorListener);\n            this._eventBus.addEventListener('warning', this.onWarningListener);\n\n            callback();\n        }\n\n        /**\n        * [Plugin API, invoked by hasplayer.js]\n        * This method is invoked when a new stream is to be loaded/opened.\n        * @method load\n        * @access public\n        * @memberof AdsPlayer#\n        * @param {object} stream - the stream contaning all stream informations (url, protData, adsUrl)\n        */\n\n    }, {\n        key: 'load',\n        value: function load(stream, callback) {\n            if (stream.adsUrl) {\n                this._adsPlayerController.load(stream.adsUrl).then(function () {\n                    callback();\n                }).catch(function () {\n                    callback();\n                });\n            } else {\n                callback();\n            }\n        }\n\n        /**\n        * [Plugin API, invoked by hasplayer.js]\n        * This method is invoked when the current stream is to be stopped.\n        * @method stop\n        * @access public\n        * @memberof AdsPlayer#\n        */\n\n    }, {\n        key: 'stop',\n        value: function stop() {\n            this._adsPlayerController.stop();\n        }\n\n        /**\n        * [Plugin API, invoked by hasplayer.js]\n        * This method is invoked when the player is to be reset.\n        * @method reset\n        * @access public\n        * @memberof AdsPlayer#\n        */\n\n    }, {\n        key: 'reset',\n        value: function reset() {\n            this._adsPlayerController.reset();\n        }\n\n        /**\n        * [Plugin API, invoked by hasplayer.js]\n        * This method is invoked when this plugin is being removed/destroyed.\n        * @method destroy\n        * @access public\n        * @memberof AdsPlayer#\n        */\n\n    }, {\n        key: 'destroy',\n        value: function destroy() {\n            this._adsPlayerController.destroy();\n            this._eventBus.removeEventListener('error', this.onErrorListener);\n            this._eventBus.removeEventListener('warning', this.onWarningListener);\n        }\n\n        // AdsPlayer additionnal API\n\n        /**\n        * Returns the plugin version.\n        * @method getVersion\n        * @access public\n        * @memberof AdsPlayer#\n        * @return {string} the plugin version\n        */\n\n    }, {\n        key: 'getVersion',\n        value: function getVersion() {\n            return VERSION;\n        }\n\n        /**\n        * Returns the full plugin version, including git revision\n        * @access public\n        * @memberof AdsPlayer#\n        * @return {string} the full plugin version, including git revision\n        */\n\n    }, {\n        key: 'getVersionFull',\n        value: function getVersionFull() {\n            if (GIT_TAG.indexOf(\"@@\") === -1) {\n                return VERSION + '_' + GIT_TAG;\n            } else {\n                return VERSION;\n            }\n        }\n\n        /**\n        * Returns the build date.\n        * @method getBuildDate\n        * @access public\n        * @memberof AdsPlayer#\n        * @return {string} the build date\n        */\n\n    }, {\n        key: 'getBuildDate',\n        value: function getBuildDate() {\n            if (BUILD_DATE.indexOf(\"@@\") === -1) {\n                return BUILD_DATE;\n            } else {\n                return 'Not a builded version';\n            }\n        }\n\n        /**\n        * Plays/resumes the playback of the current ad.\n        * @method play\n        * @access public\n        * @memberof AdsPlayer#\n        */\n\n    }, {\n        key: 'play',\n        value: function play() {\n            this._adsPlayerController.play();\n        }\n\n        /**\n        * Pauses the playback of the current ad.\n        * @method pause\n        * @access public\n        * @memberof AdsPlayer#\n        */\n\n    }, {\n        key: 'pause',\n        value: function pause() {\n            this._adsPlayerController.pause();\n        }\n\n        /**\n        * Registers a listener on the specified event.\n        * The possible event types are:\n        * <li>'error' (see [error]{@link AdsPlayer#event:error} event specification)\n        * <li>'warning' (see [warning]{@link AdsPlayer#event:warning} event specification)\n        * <li>'start' (see [start]{@link AdsPlayer#event:start} event specification)\n        * <li>'end' (see [end]{@link AdsPlayer#event:end} event specification)\n        * <li>'click' (see [click]{@link AdsPlayer#event:click} event specification)\n        * @method addEventListener\n        * @access public\n        * @memberof AdsPlayer#\n        * @param {string} type - the event type for listen to\n        * @param {callback} listener - the callback which is called when an event of the specified type occurs\n        * @param {boolean} useCapture - see HTML DOM addEventListener() method specification\n        */\n\n    }, {\n        key: 'addEventListener',\n        value: function addEventListener(type, listener, useCapture) {\n            this._eventBus.addEventListener(type, listener, useCapture);\n        }\n\n        /**\n        * Unregisters the listener previously registered with the addEventListener() method.\n        * @method removeEventListener\n        * @access public\n        * @memberof AdsPlayer#\n        * @see [addEventListener]{@link AdsPlayer#addEventListener}\n        * @param {string} type - the event type on which the listener was registered\n        * @param {callback} listener - the callback which was registered to the event type\n        */\n\n    }, {\n        key: 'removeEventListener',\n        value: function removeEventListener(type, listener) {\n            this._eventBus.removeEventListener(type, listener);\n        }\n\n        /**\n        * Returns the Error object for the most recent error.\n        * @access public\n        * @memberof AdsPlayer#\n        * @return {object} the Error object for the most recent error, or null if there has not been an error\n        */\n\n    }, {\n        key: 'getError',\n        value: function getError() {\n            return this._error;\n        }\n\n        /**\n        * Returns the Warning object for the most recent warning.\n        * @access public\n        * @memberof AdsPlayer#\n        * @return {object} the Warning object for the most recent warning, or null if there has not been a warning\n        */\n\n    }, {\n        key: 'getWarning',\n        value: function getWarning() {\n            return this._warning;\n        }\n    }]);\n\n    return AdsPlayer;\n}();\n\n// /**\n//  * @class\n//  * @classdesc AdsPlayer\n//  */\n// AdsPlayer.prototype = {\n//     constructor: AdsPlayer\n// };\n\n// AdsPlayer.mast = {};\n// AdsPlayer.mast.model = {};\n// AdsPlayer.mast.model.Trigger = {};\n// AdsPlayer.mast.model.Trigger.Condition = {};\n// AdsPlayer.vast = {};\n// AdsPlayer.vast.model = {};\n// AdsPlayer.vast.model.Vast = {};\n// AdsPlayer.media = {};\n// AdsPlayer.utils = {};\n\n\n/////////// EVENTS\n\n/**\n* The 'start' event is fired when the playback of ad(s) is starting.\n* When the 'start' event is fired, the application shall hide the main player component and\n* display the ads player container in which the ad media player component(s) will be created\n* and displayed.\n*\n* @event AdsPlayer#start\n* @param {object} event - the event\n* @param {object} event.type - the event type ('start')\n*/\n\n/**\n* The 'end' event is fired when the playback of ad(s) has ended.\n* When the 'end' event is fired, the application shall display the main player component and\n* hide the ads player container.\n*\n* @event AdsPlayer#end\n* @param {object} event - the event\n* @param {object} event.type - the event type ('end')\n*/\n\n/**\n* The 'addElement' event is fired when a DOM element for playing an ad has been created\n* and will be appended in the ads player container.\n* The element can be either a &lt;video&gt; or an &lt;img&gt; element.\n*\n* @event AdsPlayer#addElement\n* @param {object} event - the event\n* @param {object} event.type - the event type ('addElement')\n* @param {object} event.data - the event data\n* @param {string} event.data.element - the created element\n* @param {string} event.data.type - the type of the element, 'video' for &lt;video&gt; or 'image' for &lt;img&gt;\n*/\n\n/**\n* The 'removeElement' event is fired when the DOM element for playing an ad is being removed\n* from the ads player container and deleted.\n*\n* @event AdsPlayer#removeElement\n* @param {object} event - the event\n* @param {object} event.type - the event type ('removeElement')\n* @param {object} event.data - the event data\n* @param {string} event.data.element - the created element\n* @param {string} event.data.type - the type of the element, 'video' for &lt;video&gt; or 'image' for &lt;img&gt;\n*/\n\n/**\n* The 'play' event is fired when the playback of media ad is starting.\n*\n* @event AdsPlayer#play\n* @param {object} event - the event\n* @param {object} event.type - the event type ('play')\n*/\n\n/**\n* The 'pause' event is fired when the playback of an ad is paused.\n*\n* @event AdsPlayer#pause\n* @param {object} event - the event\n* @param {object} event.type - the event type ('pause')\n*/\n\n/**\n* The 'click' event is fired when a click has been performed on the ad component.\n* When the 'click' event is fired, the application shall open the web page with the provided URI.\n*\n* @event AdsPlayer#click\n* @param {object} event - the event\n* @param {object} event.type - the event type ('click')\n* @param {object} event.data - the event data\n* @param {string} event.data.uri - the web page uri\n*/\n\n/**\n* The error event is fired when an error occurs.\n* When the error event is fired, the application shall stop the player.\n*\n* @event AdsPlayer#error\n* @param {object} event - the event\n* @param {object} event.type - the event type ('error')\n* @param {object} event.data - the event data\n* @param {string} event.data.code - error code\n* @param {string} event.data.message - error message\n* @param {object} event.data.data - error additionnal data\n*/\n\n/**\n* The warning event is fired when a warning occurs.\n*\n* @event AdsPlayer#warning\n* @param {object} event - the event\n* @param {object} event.type - the event type ('warning')\n* @param {object} event.data - the event data\n* @param {string} event.data.code - warning code\n* @param {string} event.data.message - warning message\n* @param {object} event.data.data - warning additionnal data\n*/\n\nexports.default = AdsPlayer;\n\n},{\"./AdsPlayerController\":3,\"./EventBus\":6}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* AdsPlayerController is th main controller class for AdsPlayer module.\n* It is in charge of downloading the MAST/VAST files and orchestrates the\n* detection of triggers and playing of ad(s).\n*/\n\nvar _Debug = require('./Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _FileLoader = require('./FileLoader');\n\nvar _FileLoader2 = _interopRequireDefault(_FileLoader);\n\nvar _ErrorHandler = require('./ErrorHandler');\n\nvar _ErrorHandler2 = _interopRequireDefault(_ErrorHandler);\n\nvar _EventBus = require('./EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nvar _MastParser = require('./mast/MastParser');\n\nvar _MastParser2 = _interopRequireDefault(_MastParser);\n\nvar _TriggerManager = require('./mast/TriggerManager');\n\nvar _TriggerManager2 = _interopRequireDefault(_TriggerManager);\n\nvar _VastParser = require('./vast/VastParser');\n\nvar _VastParser2 = _interopRequireDefault(_VastParser);\n\nvar _VastPlayerManager = require('./vast/VastPlayerManager');\n\nvar _VastPlayerManager2 = _interopRequireDefault(_VastPlayerManager);\n\nvar _utils = require('./utils/utils');\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AdsPlayerController = function () {\n    _createClass(AdsPlayerController, [{\n        key: '_loadVast',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _loadVast(url) {\n            var _this = this;\n\n            var fileLoader = new _FileLoader2.default(),\n                vast = null;\n\n            return new Promise(function (resolve /*, reject*/) {\n                _this._debug.log(\"Download VAST file: \" + url);\n                fileLoader.load(url).then(function (result) {\n                    _this._debug.log(\"Parse VAST file\");\n                    vast = _this._vastParser.parse(result.response);\n                    vast.baseUrl = result.baseUrl;\n                    resolve(vast);\n                }).catch(function (error) {\n                    if (error) {\n                        _this._errorHandler.sendWarning(_ErrorHandler2.default.LOAD_VAST_FAILED, \"Failed to load VAST file\", error);\n                    }\n                    resolve(null);\n                });\n                _this._fileLoaders.push(fileLoader);\n            });\n        }\n    }, {\n        key: '_loadTriggerVasts',\n        value: function _loadTriggerVasts(trigger) {\n            var loadVastPromises = [],\n                i,\n                uri;\n\n            for (i = 0; i < trigger.sources.length; i++) {\n                uri = trigger.sources[i].uri;\n                // Check for relative uri path and add base url if needed\n                uri = _utils2.default.isAbsoluteURI(uri) ? uri : this._mast.baseUrl + uri;\n                loadVastPromises.push(this._loadVast(uri));\n            }\n\n            return new Promise(function (resolve, reject) {\n                Promise.all(loadVastPromises).then(function (vasts) {\n                    // Push vast objects in the trigger in the original order\n                    // (this = promises returned objects)\n                    for (var i = 0; i < vasts.length; i++) {\n                        if (vasts[i] && vasts[i].ads && vasts[i].ads.length > 0) {\n                            trigger.vasts.push(vasts[i]);\n                        }\n                    }\n                    resolve();\n                }).catch(function () {\n                    reject();\n                });\n            });\n        }\n    }, {\n        key: '_parseMastFile',\n        value: function _parseMastFile(mastContent, mastBaseUrl) {\n            var triggerManager, i;\n\n            // Parse the MAST file\n            this._mast = this._mastParser.parse(mastContent);\n\n            if (!this._mast) {\n                return;\n            }\n\n            // Store base URL for subsequent VATS files download\n            this._mast.baseUrl = mastBaseUrl;\n\n            // Initialize the trigger managers\n            for (i = 0; i < this._mast.triggers.length; i++) {\n                triggerManager = new _TriggerManager2.default();\n                triggerManager.init(this._mast.triggers[i]);\n                this._triggerManagers.push(triggerManager);\n            }\n        }\n    }, {\n        key: '_onVideoPlaying',\n        value: function _onVideoPlaying() {\n            if (this._vastPlayerManager) {\n                this._debug.log(\"Pause main video\");\n                this._mainVideo.pause();\n            }\n        }\n    }, {\n        key: '_onVideoTimeupdate',\n        value: function _onVideoTimeupdate() {\n            // Check for mid-roll triggers\n            var trigger = this._checkTriggersStart();\n            if (trigger !== null) {\n                this._activateTrigger(trigger, true);\n            }\n        }\n    }, {\n        key: '_onVideoEnded',\n        value: function _onVideoEnded() {\n            // Check for end-roll triggers\n            var trigger = this._checkTriggersStart();\n            if (trigger !== null) {\n                this._activateTrigger(trigger, true);\n            }\n\n            this._checkTriggersEnd();\n        }\n    }, {\n        key: '_pauseVideo',\n        value: function _pauseVideo() {\n            if (!this._mainVideo.paused) {\n                this._debug.log(\"Pause main video\");\n                this._mainVideo.pause();\n            }\n        }\n    }, {\n        key: '_resumeVideo',\n        value: function _resumeVideo() {\n            if (this._mainVideo.paused) {\n                this._debug.log(\"Resume main video\");\n                this._mainVideo.play();\n            }\n        }\n    }, {\n        key: '_onTriggerEnd',\n        value: function _onTriggerEnd() {\n            this._debug.log('End playing trigger');\n\n            // Delete VAST player manager\n            if (this._vastPlayerManager) {\n                this._vastPlayerManager = null;\n            }\n\n            // Check if another trigger has to be activated\n            var trigger = this._checkTriggersStart();\n            if (trigger !== null) {\n                this._activateTrigger(trigger, false);\n            } else {\n                // Notifies the application ad(s) playback has ended\n                this._eventBus.dispatchEvent({ type: 'end', data: null });\n\n                if (!this._mainVideo.ended) {\n                    // Resume the main video element\n                    this._resumeVideo();\n                }\n            }\n        }\n    }, {\n        key: '_playTrigger',\n        value: function _playTrigger(trigger) {\n            if (trigger.vasts.length === 0) {\n                return;\n            }\n\n            // Pause the main video element\n            this._pauseVideo();\n\n            // Play the trigger\n            this._debug.log('Start playing trigger ' + trigger.id);\n            this._vastPlayerManager = new _VastPlayerManager2.default();\n            this._vastPlayerManager.init(trigger.vasts, this._adsPlayerContainer, this._mainVideo);\n            this._vastPlayerManager.start();\n        }\n    }, {\n        key: '_activateTrigger',\n        value: function _activateTrigger(trigger, firstTrigger) {\n            var _this2 = this;\n\n            // Check if a trigger is not already activated\n            if (this._vastPlayerManager) {\n                return;\n            }\n\n            if (firstTrigger) {\n                // Notifies the application ad(s) playback starts\n                this._eventBus.dispatchEvent({ type: 'start', data: null });\n            }\n\n            this._debug.log('Activate trigger ' + trigger.id);\n\n            trigger.activated = true;\n\n            if (trigger.vasts.length === 0) {\n                // Download VAST files\n                this._loadTriggerVasts(trigger).then(function () {\n                    _this2._playTrigger(trigger);\n                });\n            } else {\n                this._playTrigger(trigger);\n            }\n        }\n    }, {\n        key: '_checkTriggersStart',\n        value: function _checkTriggersStart() {\n            for (var i = 0; i < this._triggerManagers.length; i++) {\n                if (this._triggerManagers[i].checkStartConditions(this._mainVideo)) {\n                    return this._triggerManagers[i].getTrigger();\n                }\n            }\n            return null;\n        }\n    }, {\n        key: '_checkTriggersEnd',\n        value: function _checkTriggersEnd() {\n            for (var i = 0; i < this._triggerManagers.length; i++) {\n                if (this._triggerManagers[i].checkEndConditions(this._mainVideo)) {\n                    // Remove trigger manager => will not be activated anymore\n                    this._triggerManagers.splice(0, 1);\n                    i--;\n                }\n            }\n        }\n    }, {\n        key: '_start',\n        value: function _start() {\n            if (!this._mast) {\n                return;\n            }\n\n            if (this._mast.triggers.length === 0) {\n                this._debug.warn('No trigger in MAST');\n            }\n\n            // Check for pre-roll trigger\n            var trigger = this._checkTriggersStart();\n            if (trigger !== null) {\n                this._activateTrigger(trigger, true);\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function AdsPlayerController() {\n        _classCallCheck(this, AdsPlayerController);\n\n        this._mainPlayer = null;\n        this._mainVideo = null;\n        this._adsPlayerContainer = null;\n        this._mast = null;\n        this._fileLoaders = [];\n        this._triggerManagers = [];\n        this._vastPlayerManager = null;\n        this._mastParser = new _MastParser2.default();\n        this._vastParser = new _VastParser2.default();\n        this._errorHandler = _ErrorHandler2.default.getInstance();\n        this._debug = _Debug2.default.getInstance();\n        this._eventBus = _EventBus2.default.getInstance();\n\n        this._onVideoPlayingListener = this._onVideoPlaying.bind(this);\n        this._onVideoTimeupdateListener = this._onVideoTimeupdate.bind(this);\n        this._onVideoEndedListener = this._onVideoEnded.bind(this);\n        this._onTriggerEndListener = this._onTriggerEnd.bind(this);\n    }\n\n    /**\n     * Initialize the Ads Player Controller.\n     * @method init\n     * @access public\n     * @memberof AdsPlayerController#\n     * @param {Object} mainVideo - the HTML5 video element used by the main media player\n     * @param {Object} adsPlayerContainer - The container to create the HTML5 video/image elements used to play and render the ads media\n     */\n\n\n    _createClass(AdsPlayerController, [{\n        key: 'init',\n        value: function init(player, adsPlayerContainer) {\n            this._mainPlayer = player;\n            this._mainVideo = player.getVideoModel().getElement();\n            this._adsPlayerContainer = adsPlayerContainer;\n\n            // Add <video> event listener\n            this._mainVideo.addEventListener('playing', this._onVideoPlayingListener);\n            this._mainVideo.addEventListener('timeupdate', this._onVideoTimeupdateListener);\n            this._mainVideo.addEventListener('seeking', this._onVideoTimeupdateListener);\n            this._mainVideo.addEventListener('ended', this._onVideoEndedListener);\n\n            // Add trigger end event listener\n            this._eventBus.addEventListener('triggerEnd', this._onTriggerEndListener);\n\n            this._debug.setLevel(4);\n        }\n\n        /**\n         * Load/open a MAST file.\n         * @method load\n         * @access public\n         * @memberof AdsPlayerController#\n         * @param {string} mastUrl - the MAST file url\n         */\n\n    }, {\n        key: 'load',\n        value: function load(url) {\n            var _this3 = this;\n\n            var fileLoader = new _FileLoader2.default();\n\n            // Reset the MAST and trigger managers\n            this._mast = null;\n            this._triggerManagers = [];\n\n            // Download and parse MAST file\n            this._debug.log(\"Download MAST file: \" + url);\n\n            return new Promise(function (resolve, reject) {\n                fileLoader.load(url).then(function (result) {\n                    _this3._debug.log(\"Parse MAST file\");\n                    _this3._parseMastFile(result.response, result.baseUrl);\n                    // Start managing triggers and ads playing\n                    _this3._debug.log(\"Start\");\n                    _this3._start();\n                    resolve();\n                }).catch(function (error) {\n                    if (error) {\n                        _this3._errorHandler.sendError(error.name, error.message, error.data);\n                        reject(error);\n                    } else {\n                        resolve();\n                    }\n                });\n                _this3._fileLoaders.push(fileLoader);\n            });\n        }\n\n        /**\n         * Stops and resets the Ads player.\n         * @method reset\n         * @access public\n         * @memberof AdsPlayerController#\n         */\n\n    }, {\n        key: 'stop',\n        value: function stop() {\n\n            this._debug.log(\"Stop\");\n\n            // Stop/abort the file loaders\n            for (var i = 0; i < this._fileLoaders.length; i++) {\n                this._fileLoaders[i].abort();\n            }\n            this._fileLoaders = [];\n\n            // Stop the VAST player manager\n            if (this._vastPlayerManager) {\n                this._vastPlayerManager.stop();\n                this._vastPlayerManager = null;\n\n                // Notifies the application ad(s) playback has ended\n                this._eventBus.dispatchEvent({ type: 'end', data: null });\n            }\n        }\n    }, {\n        key: 'reset',\n        value: function reset() {\n\n            this._debug.log(\"Reset\");\n\n            this.stop();\n\n            // Reset the trigger managers\n            this._triggerManagers = [];\n\n            // Reset the MAST\n            this._mast = null;\n        }\n    }, {\n        key: 'destroy',\n        value: function destroy() {\n\n            this._debug.log(\"Destroy\");\n\n            this.reset();\n\n            // Remove <video> event listener\n            this._mainVideo.removeEventListener('playing', this._onVideoPlayingListener);\n            this._mainVideo.removeEventListener('timeupdate', this._onVideoTimeupdateListener);\n            this._mainVideo.removeEventListener('seeking', this._onVideoTimeupdateListener);\n            this._mainVideo.removeEventListener('ended', this._onVideoEndedListener);\n\n            // Remove trigger end event listener\n            this._eventBus.removeEventListener('triggerEnd', this._onTriggerEndListener);\n        }\n\n        /**\n         * Plays/resumes the playback of the current ad.\n         * @method reset\n         * @access public\n         * @memberof AdsPlayerController#\n         */\n\n    }, {\n        key: 'play',\n        value: function play() {\n\n            this._debug.log(\"Play\");\n            // Start the VAST player manager\n            if (this._vastPlayerManager) {\n                this._vastPlayerManager.play();\n            }\n        }\n\n        /**\n         * Pauses the playback of the current ad.\n         * @method reset\n         * @access public\n         * @memberof AdsPlayerController#\n         */\n\n    }, {\n        key: 'pause',\n        value: function pause() {\n\n            this._debug.log(\"Pause\");\n            // Pause the VAST player manager\n            if (this._vastPlayerManager) {\n                this._vastPlayerManager.pause();\n            }\n        }\n    }]);\n\n    return AdsPlayerController;\n}();\n\nexports.default = AdsPlayerController;\n\n},{\"./Debug\":4,\"./ErrorHandler\":5,\"./EventBus\":6,\"./FileLoader\":7,\"./mast/MastParser\":8,\"./mast/TriggerManager\":9,\"./utils/utils\":13,\"./vast/VastParser\":18,\"./vast/VastPlayerManager\":19}],4:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* Debug utility class.\n*/\nDate.prototype.HHMMSSmmm = function () {\n\n    var h = this.getHours().toString(),\n        m = this.getMinutes().toString(),\n        s = this.getSeconds().toString(),\n        ms = this.getMilliseconds().toString(),\n        HH = h[1] ? h : \"0\" + h[0],\n        MM = m[1] ? m : \"0\" + m[0],\n        SS = s[1] ? s : \"0\" + s[0],\n        mmm = ms[2] ? ms : \"0\" + (ms[1] ? ms : \"0\" + ms[0]);\n\n    return HH + \":\" + MM + \":\" + SS + \".\" + mmm;\n};\n\nDate.prototype.MMSSmmm = function () {\n\n    var m = this.getMinutes().toString(),\n        s = this.getSeconds().toString(),\n        ms = this.getMilliseconds().toString(),\n        MM = m[1] ? m : \"0\" + m[0],\n        SS = s[1] ? s : \"0\" + s[0],\n        mmm = ms[2] ? ms : \"0\" + (ms[1] ? ms : \"0\" + ms[0]);\n\n    return MM + \":\" + SS + \".\" + mmm;\n};\n\n// MemoryLogger definition\n\nvar MemoryLogger = function MemoryLogger() {\n    // array to store logs\n    this.logArray = [];\n    // boolean to set leve in message\n    this.showLevel = true;\n};\n\nMemoryLogger.prototype.error = MemoryLogger.prototype.warn = MemoryLogger.prototype.info = MemoryLogger.prototype.debug = function (message) {\n    this.logArray.push(message);\n};\n\nMemoryLogger.prototype.getLogs = function () {\n    return this.logArray;\n};\n\nvar NONE = 0;\nvar ERROR = 1;\nvar WARN = 2;\nvar INFO = 3;\nvar DEBUG = 4;\nvar ALL = 4;\n\nvar _instance = null;\n\nvar Debug = function () {\n    _createClass(Debug, [{\n        key: \"_getStringLevel\",\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _getStringLevel(level) {\n            switch (level) {\n                case NONE:\n                    return \"\";\n                case ERROR:\n                    return \"ERROR\";\n                case WARN:\n                    return \"WARN\";\n                case INFO:\n                    return \"INFO\";\n                case DEBUG:\n                case ALL:\n                    return \"DEBUG\";\n                default:\n                    return \"\";\n            }\n        }\n    }, {\n        key: \"_prepareLog\",\n        value: function _prepareLog(logLevel, args) {\n            var message = \"\",\n                logTime = null;\n\n            if (this._showTimestamp) {\n                logTime = new Date();\n                message += \"[\" + logTime.HHMMSSmmm() + \"]\";\n            }\n\n            if (this._logger && this._logger.showLevel) {\n                message += \"[\" + this._getStringLevel(logLevel) + \"]\";\n            }\n\n            if (this._showElapsedTime) {\n                message += \"[\" + new Date(logTime - this._startTime).MMSSmmm() + \"]\";\n            }\n\n            message += \"[AdsPlayer] \";\n\n            Array.apply(null, args).forEach(function (item) {\n                message += item + \" \";\n            });\n\n            return message;\n        }\n    }, {\n        key: \"_log\",\n        value: function _log(logLevel, args) {\n            if (logLevel <= this.getLevel()) {\n\n                var message = this._prepareLog(logLevel, args);\n\n                switch (logLevel) {\n                    case ERROR:\n                        this._logger.error(message);\n                        break;\n                    case WARN:\n                        this._logger.warn(message);\n                        break;\n                    case INFO:\n                        this._logger.info(message);\n                        break;\n                    case DEBUG:\n                        this._logger.debug(message);\n                        break;\n                }\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }], [{\n        key: \"getInstance\",\n        value: function getInstance() {\n            if (_instance === null) {\n                _instance = new Debug();\n            }\n\n            return _instance;\n        }\n    }]);\n\n    function Debug() {\n        _classCallCheck(this, Debug);\n\n        if (_instance !== null) {\n            return _instance;\n        }\n\n        this._level = 4;\n        this._showTimestamp = true;\n        this._showElapsedTime = false;\n        this._startTime = new Date();\n        this._logger = console;\n\n        _instance = this;\n        return _instance;\n    }\n\n    _createClass(Debug, [{\n        key: \"getLevel\",\n        value: function getLevel() {\n            return this._level;\n        }\n    }, {\n        key: \"setLevel\",\n        value: function setLevel(value) {\n            this._level = value;\n        }\n    }, {\n        key: \"getLogger\",\n        value: function getLogger() {\n            return this._logger;\n        }\n    }, {\n        key: \"setLogger\",\n        value: function setLogger(type) {\n            switch (type) {\n                case 'memory':\n                    this._logger = new MemoryLogger();\n                    break;\n\n                case 'console':\n                    this._logger = console;\n                    break;\n\n                default:\n                    this._logger = null;\n            }\n        }\n    }, {\n        key: \"error\",\n        value: function error() {\n            this._log(ERROR, arguments);\n        }\n    }, {\n        key: \"warn\",\n        value: function warn() {\n            this._log(WARN, arguments);\n        }\n    }, {\n        key: \"info\",\n        value: function info() {\n            this._log(INFO, arguments);\n        }\n\n        // Keep this function for compatibility\n\n    }, {\n        key: \"log\",\n        value: function log() {\n            this._log(DEBUG, arguments);\n        }\n    }]);\n\n    return Debug;\n}();\n\nexports.default = Debug;\n\n},{}],5:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* Errors and warning notifications handler.\n*/\n\nvar _Debug = require('./Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _EventBus = require('./EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _instance = null;\n\nvar ErrorHandler = function () {\n    _createClass(ErrorHandler, null, [{\n        key: 'getInstance',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n        value: function getInstance() {\n            if (_instance === null) {\n                _instance = new ErrorHandler();\n            }\n\n            return _instance;\n        }\n    }]);\n\n    function ErrorHandler() {\n        _classCallCheck(this, ErrorHandler);\n\n        if (_instance !== null) {\n            return _instance;\n        }\n\n        this._eventBus = _EventBus2.default.getInstance();\n        this._debug = _Debug2.default.getInstance();\n\n        _instance = this;\n        return _instance;\n    }\n\n    /**\n     * [sendWarning description]\n     * @param  {[type]} code    [description]\n     * @param  {[type]} message [description]\n     * @param  {[type]} data    [description]\n     * @return {[type]}         [description]\n     */\n\n\n    _createClass(ErrorHandler, [{\n        key: 'sendWarning',\n        value: function sendWarning(code, message, data) {\n            this._eventBus.dispatchEvent({\n                type: 'warning',\n                data: {\n                    code: code,\n                    message: message,\n                    data: data\n                }\n            });\n            this._debug.warn(\"[Warn] Code: \" + code + \", Message: \" + message + \", Data: \" + JSON.stringify(data, null, '\\t'));\n        }\n\n        /**\n         * [sendError description]\n         * @param  {[type]} code    [description]\n         * @param  {[type]} message [description]\n         * @param  {[type]} data    [description]\n         * @return {[type]}         [description]\n         */\n\n    }, {\n        key: 'sendError',\n        value: function sendError(code, message, data) {\n            this._eventBus.dispatchEvent({\n                type: 'error',\n                data: {\n                    code: code,\n                    message: message,\n                    data: data\n                }\n            });\n            this._debug.error(\"[Error] Code: \" + code + \", Message: \" + message + \", Data: \" + JSON.stringify(data, null, '\\t'));\n        }\n    }]);\n\n    return ErrorHandler;\n}();\n\n// File Loader errors\n\n\nErrorHandler.DOWNLOAD_ERR_FILES = \"DOWNLOAD_ERR_FILES\";\nErrorHandler.DOWNLOAD_ERR_NOT_XML = \"DOWNLOAD_ERR_NOT_XML\";\n\nErrorHandler.LOAD_VAST_FAILED = \"LOAD_VAST_FAILED\";\n\n// Media Player errors\nErrorHandler.NO_VALID_MEDIA_FOUND = \"NO_VALID_MEDIA_FOUND\";\nErrorHandler.LOAD_MEDIA_FAILED = \"LOAD_MEDIA_FAILED\";\nErrorHandler.UNSUPPORTED_MEDIA_FILE = \"UNSUPPORTED_MEDIA_FILE\";\nErrorHandler.UNAVAILABLE_LINK = \"UNAVAILABLE_LINK\";\n\nexports.default = ErrorHandler;\n\n},{\"./Debug\":4,\"./EventBus\":6}],6:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* Event bus utility class for events listening and notifying.\n*/\n\nvar _Debug = require('./Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _instance = null;\n\nvar EventBus = function () {\n    _createClass(EventBus, [{\n        key: '_getListeners',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n\n        value: function _getListeners(type, useCapture) {\n            if (useCapture === undefined) {\n                // to provide a default parameter that works !!\n                useCapture = false;\n            }\n            var captype = (useCapture ? '1' : '0') + type;\n\n            if (!(captype in this._registrations)) {\n                this._registrations[captype] = [];\n            }\n\n            return this._registrations[captype];\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }], [{\n        key: 'getInstance',\n        value: function getInstance() {\n            if (_instance === null) {\n                _instance = new EventBus();\n            }\n\n            return _instance;\n        }\n    }]);\n\n    function EventBus() {\n        _classCallCheck(this, EventBus);\n\n        if (_instance !== null) {\n            return _instance;\n        }\n\n        this._registrations = {};\n        this._debug = _Debug2.default.getInstance();\n\n        _instance = this;\n        return _instance;\n    }\n\n    /**\n     * [addEventListener description]\n     * @param {[type]} type       [description]\n     * @param {[type]} listener   [description]\n     * @param {[type]} useCapture [description]\n     */\n\n\n    _createClass(EventBus, [{\n        key: 'addEventListener',\n        value: function addEventListener(type, listener, useCapture) {\n            var listeners = this._getListeners(type, useCapture),\n                idx = listeners.indexOf(listener);\n\n            if (idx === -1) {\n                listeners.push(listener);\n            }\n        }\n\n        /**\n         * [removeEventListener description]\n         * @param  {[type]} type       [description]\n         * @param  {[type]} listener   [description]\n         * @param  {[type]} useCapture [description]\n         * @return {[type]}            [description]\n         */\n\n    }, {\n        key: 'removeEventListener',\n        value: function removeEventListener(type, listener, useCapture) {\n            var listeners = this._getListeners(type, useCapture),\n                idx = listeners.indexOf(listener);\n\n            if (idx !== -1) {\n                listeners.splice(idx, 1);\n            }\n        }\n\n        /**\n         * [dispatchEvent description]\n         * @param  {[type]} evt [description]\n         * @return {[type]}     [description]\n         */\n\n    }, {\n        key: 'dispatchEvent',\n        value: function dispatchEvent(evt) {\n            var listeners = this._getListeners(evt.type, false).slice(),\n                i = 0;\n\n            for (i = 0; i < listeners.length; i += 1) {\n                listeners[i].call(this, evt);\n            }\n            return !evt.defaultPrevented;\n        }\n    }]);\n\n    return EventBus;\n}();\n\nexports.default = EventBus;\n\n},{\"./Debug\":4}],7:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* File downloader utility class.\n*/\n\nvar _ErrorHandler = require(\"./ErrorHandler\");\n\nvar _ErrorHandler2 = _interopRequireDefault(_ErrorHandler);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar FileLoader = function () {\n    _createClass(FileLoader, [{\n        key: \"_parseBaseUrl\",\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _parseBaseUrl(url) {\n            var base = null;\n\n            if (url.indexOf(\"/\") !== -1) {\n                if (url.indexOf(\"?\") !== -1) {\n                    url = url.substring(0, url.indexOf(\"?\"));\n                }\n                base = url.substring(0, url.lastIndexOf(\"/\") + 1);\n            }\n\n            return base;\n        }\n    }, {\n        key: \"_parseXml\",\n        value: function _parseXml(data) {\n\n            if (!window.DOMParser) {\n                return null;\n            }\n\n            try {\n                var parser = new window.DOMParser();\n\n                var xmlDoc = parser.parseFromString(data, \"text/xml\");\n                if (xmlDoc.getElementsByTagName('parsererror').length > 0) {\n                    throw new Error('Error parsing XML');\n                }\n                return xmlDoc;\n            } catch (e) {\n                return null;\n            }\n        }\n    }, {\n        key: \"_abort\",\n        value: function _abort() {\n            if (this._request !== null && this._request.readyState > 0 && this._request.readyState < 4) {\n                this._request.abort();\n            }\n        }\n    }, {\n        key: \"_load\",\n        value: function _load(url, resolve, reject) {\n            var baseUrl = this._parseBaseUrl(url),\n                needFailureReport = true,\n                onload = null,\n                report = null,\n                onabort = null,\n                self = this;\n\n            onabort = function onabort() {\n                this.aborted = true;\n            };\n\n            onload = function onload() {\n                if (this.status < 200 || this.status > 299) {\n                    return;\n                }\n\n                if (this.status === 200 && this.readyState === 4) {\n\n                    // Parse responseText in case of wrong response Content-Type\n                    var xmlDoc = this.responseXML || self._parseXml(this.responseText);\n\n                    // Check if response is in XML format.\n                    if (xmlDoc === null) {\n                        needFailureReport = true;\n                        return;\n                    }\n\n                    // Get the redirection URL and use it as base URL\n                    if (this.responseURL) {\n                        baseUrl = self._parseBaseUrl(this.responseURL);\n                    }\n\n                    needFailureReport = false;\n\n                    // Return XML DOM (as input to parsers)\n                    resolve({\n                        response: xmlDoc,\n                        baseUrl: baseUrl\n                    });\n                }\n            };\n\n            report = function report() {\n                if (!needFailureReport) {\n                    return;\n                }\n                needFailureReport = false;\n\n                if (this.aborted) {\n                    // Request has been aborted => reject without error\n                    reject();\n                } else if (this.status < 200 || this.status > 299) {\n                    // Request has failed => reject with error\n                    reject({\n                        name: _ErrorHandler2.default.DOWNLOAD_ERR_FILES,\n                        message: \"Failed to download file\",\n                        data: {\n                            url: url,\n                            status: this.status\n                        }\n                    });\n                } else if (this.responseXML === null) {\n                    // Response was not in XML format => reject with error\n                    reject({\n                        name: _ErrorHandler2.default.DOWNLOAD_ERR_NOT_XML,\n                        message: \"The downloaded file format is not in xml format\",\n                        data: {\n                            url: url\n                        }\n                    });\n                }\n            };\n\n            try {\n                this._request = new XMLHttpRequest();\n                this._request.onload = onload;\n                this._request.onloadend = report;\n                this._request.onerror = report;\n                this._request.onabort = onabort;\n                this._request.open(\"GET\", url, true);\n                this._request.timeout = 10000;\n                this._request.send();\n            } catch (e) {\n                this._request.onerror();\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function FileLoader() {\n        _classCallCheck(this, FileLoader);\n\n        this._request = null;\n    }\n\n    _createClass(FileLoader, [{\n        key: \"load\",\n        value: function load(url) {\n            var _this = this;\n\n            return new Promise(function (resolve, reject) {\n                _this._load(url, resolve, reject);\n            });\n        }\n    }, {\n        key: \"abort\",\n        value: function abort() {\n            if (this._request !== null && this._request.readyState > 0 && this._request.readyState < 4) {\n                this._request.abort();\n            }\n        }\n    }]);\n\n    return FileLoader;\n}();\n\nexports.default = FileLoader;\n\n},{\"./ErrorHandler\":5}],8:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* MAST parser. This class parses MAST file in XML format\n* and construct the corresponding MAST object according to MAST data model.\n*/\n\nvar _Mast = require('./model/Mast');\n\nvar _Mast2 = _interopRequireDefault(_Mast);\n\nvar _xmldom = require('../utils/xmldom');\n\nvar _xmldom2 = _interopRequireDefault(_xmldom);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MastParser = function () {\n    _createClass(MastParser, [{\n        key: '_getCondition',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _getCondition(conditionNode) {\n            var condition = new _Mast2.default.Condition(),\n                conditionNodes = void 0;\n\n            condition.type = conditionNode.getAttribute('type');\n            condition.name = conditionNode.getAttribute('name');\n            condition.value = conditionNode.getAttribute('value');\n            condition.operator = conditionNode.getAttribute('operator');\n            conditionNodes = conditionNode.getElementsByTagName('condition');\n            for (var i = 0; i < conditionNodes.length; i++) {\n                condition.conditions.push(this._getCondition(conditionNodes[i]));\n            }\n\n            return condition;\n        }\n    }, {\n        key: '_getSource',\n        value: function _getSource(sourceNode) {\n            var source = new _Mast2.default.Source(),\n                sourceNodes = void 0;\n\n            source.uri = sourceNode.getAttribute('uri');\n            source.altReference = sourceNode.getAttribute('altReference');\n            source.format = sourceNode.getAttribute('format');\n            sourceNodes = sourceNode.getElementsByTagName('source');\n            for (var i = 0; i < sourceNodes.length; i++) {\n                source.sources.push(this._getSource(sourceNodes[i]));\n            }\n\n            return source;\n        }\n    }, {\n        key: '_getTrigger',\n        value: function _getTrigger(triggerNode) {\n            var trigger = new _Mast2.default.Trigger(),\n                startConditionNodes = _xmldom2.default.getSubElements(triggerNode, 'startConditions', 'condition'),\n                endConditionNodes = _xmldom2.default.getSubElements(triggerNode, 'endConditions', 'condition'),\n                sourceNodes = _xmldom2.default.getSubElements(triggerNode, 'sources', 'source'),\n                i = void 0;\n\n            trigger.id = triggerNode.getAttribute('id');\n            trigger.description = triggerNode.getAttribute('description');\n\n            for (i = 0; i < startConditionNodes.length; i++) {\n                trigger.startConditions.push(this._getCondition(startConditionNodes[i]));\n            }\n\n            for (i = 0; i < endConditionNodes.length; i++) {\n                trigger.endConditions.push(this._getCondition(endConditionNodes[i]));\n            }\n\n            for (i = 0; i < sourceNodes.length; i++) {\n                trigger.sources.push(this._getSource(sourceNodes[i]));\n            }\n\n            return trigger;\n        }\n    }, {\n        key: '_getTriggers',\n        value: function _getTriggers(mastNode, mast) {\n            var triggerNodes = _xmldom2.default.getSubElements(mastNode, 'triggers', 'trigger');\n\n            for (var i = 0; i < triggerNodes.length; i++) {\n                mast.triggers.push(this._getTrigger(triggerNodes[i]));\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function MastParser() {\n        _classCallCheck(this, MastParser);\n    }\n\n    /**\n    * Parses the MAST xml file and get the triggers.\n    * @param {object} xmlDom - the XML DOM to parse\n    */\n\n\n    _createClass(MastParser, [{\n        key: 'parse',\n        value: function parse(xmlDom) {\n            var mast_ = new _Mast2.default.Mast(),\n                mastNode = _xmldom2.default.getElement(xmlDom, 'MAST');\n\n            if (mastNode === null) {\n                return mast_;\n            }\n\n            this._getTriggers(mastNode, mast_);\n\n            return mast_;\n        }\n    }]);\n\n    return MastParser;\n}();\n\nexports.default = MastParser;\n\n},{\"../utils/xmldom\":14,\"./model/Mast\":10}],9:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The TriggerManager manages the detection of the start and end of a trigger.\n* It takes as input a trigger object (as parsed from a MAST file) and tests the start and end conditions\n* to detect the activation and revocation of a trigger.\n*/\n\nvar _Mast = require('./model/Mast');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TriggerManager = function () {\n    _createClass(TriggerManager, [{\n        key: '_parseTime',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _parseTime(str) {\n            var timeParts,\n                SECONDS_IN_HOUR = 60 * 60,\n                SECONDS_IN_MIN = 60;\n\n            if (!str) {\n                return -1;\n            }\n\n            timeParts = str.split(':');\n\n            // Check time format, must be HH:MM:SS(.mmm)\n            if (timeParts.length !== 3) {\n                return -1;\n            }\n\n            return parseInt(timeParts[0]) * SECONDS_IN_HOUR + parseInt(timeParts[1]) * SECONDS_IN_MIN + parseFloat(timeParts[2]);\n        }\n    }, {\n        key: '_compareValues',\n        value: function _compareValues(value1, value2, operator) {\n            var res = false;\n\n            if (value1 < 0 || value2 < 0) {\n                return false;\n            }\n\n            switch (operator) {\n                case _Mast.Condition.OPERATOR.EQ:\n                    res = value1 === value2;\n                    break;\n                case _Mast.Condition.OPERATOR.NEQ:\n                    res = value1 !== value2;\n                    break;\n                case _Mast.Condition.OPERATOR.GTR:\n                    res = value1 > value2;\n                    break;\n                case _Mast.Condition.OPERATOR.GEQ:\n                    res = value1 >= value2;\n                    break;\n                case _Mast.Condition.OPERATOR.LT:\n                    res = value1 < value2;\n                    break;\n                case _Mast.Condition.OPERATOR.LEQ:\n                    res = value1 <= value2;\n                    break;\n                case _Mast.Condition.OPERATOR.MOD:\n                    res = value1 % value2 === 0;\n                    break;\n                default:\n                    break;\n            }\n            return res;\n        }\n    }, {\n        key: '_evaluateCondition',\n        value: function _evaluateCondition(condition, video) {\n            var res = false,\n                i;\n\n            // Check pre-roll condition for activation\n            if (video.currentTime === 0 && condition.type === _Mast.Condition.TYPE.EVENT && condition.name === _Mast.Condition.NAME.ON_ITEM_START) {\n                res = true;\n            }\n\n            // Check mid-roll condition for activation\n            if (condition.type === _Mast.Condition.TYPE.PROPERTY) {\n                switch (condition.name) {\n                    case _Mast.Condition.NAME.POSITION:\n                        res = this._compareValues(video.currentTime, this._parseTime(condition.value), condition.operator);\n                        break;\n                    case _Mast.Condition.NAME.DURATION:\n                        res = this._compareValues(video.duration, this._parseTime(condition.value), condition.operator);\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // Check condition for revocation\n            if (video.ended && condition.type === _Mast.Condition.TYPE.EVENT && condition.name === _Mast.Condition.NAME.ON_ITEM_END) {\n                res = true;\n            }\n\n            // AND with sub-conditions\n            // MAST spec. : \"Child conditions are treated as an implicit AND, all children of a condition must evaluate true before a trigger will fire (or be revoked) from that condition.\"\n            for (i = 0; i < condition.conditions.length; i++) {\n                res &= this._evaluateCondition(condition.conditions[i], video);\n            }\n\n            return res;\n        }\n    }, {\n        key: '_evaluateConditions',\n        value: function _evaluateConditions(conditions, video) {\n            var res = false,\n                i;\n\n            // Evaluate each condition\n            // MAST spec. : \"Multiple condition elements are treated as an implicit OR, any one of them evaluating true will fire the trigger.\"\n            for (i = 0; i < conditions.length; i++) {\n                res |= this._evaluateCondition(conditions[i], video);\n            }\n\n            return res;\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function TriggerManager() {\n        _classCallCheck(this, TriggerManager);\n\n        this._trigger = null;\n    }\n\n    /**\n     * Initializes the TriggerManager.\n     * @method init\n     * @access public\n     * @memberof TriggerManager#\n     * @param {Object} trigger - the trigger to handle by this manager\n     */\n\n\n    _createClass(TriggerManager, [{\n        key: 'init',\n        value: function init(trigger) {\n            this._trigger = trigger;\n        }\n\n        /**\n         * Returns the trigger object managed by this TriggerManager.\n         * @method init\n         * @access public\n         * @memberof TriggerManager#\n         * @return {Object} the managed trigger object\n         */\n\n    }, {\n        key: 'getTrigger',\n        value: function getTrigger() {\n            return this._trigger;\n        }\n\n        /**\n         * Evaluates the trigger start conditions.\n         * @method checkStartConditions\n         * @access public\n         * @memberof TriggerManager#\n         * @param {Number} video - the main video element\n         */\n\n    }, {\n        key: 'checkStartConditions',\n        value: function checkStartConditions(video) {\n            if (this._trigger.activated) {\n                return false;\n            }\n            return this._evaluateConditions(this._trigger.startConditions, video);\n        }\n\n        /**\n         * Evaluates the trigger end conditions.\n         * @method checkEndConditions\n         * @access public\n         * @memberof TriggerManager#\n         * @param {Number} video - the main video element\n         */\n\n    }, {\n        key: 'checkEndConditions',\n        value: function checkEndConditions(video) {\n            return this._evaluateConditions(this._trigger.endConditions, video);\n        }\n    }]);\n\n    return TriggerManager;\n}();\n\nexports.default = TriggerManager;\n\n},{\"./model/Mast\":10}],10:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* @class Mast\n* @ignore\n*/\nvar Mast = function Mast() {\n    _classCallCheck(this, Mast);\n\n    this.baseUrl = '';\n    this.triggers = []; // pointer to any number of Ad objects\n};\n\n/**\n* @class Trigger\n* @ignore\n*/\n\n\nvar Trigger = function Trigger() {\n    _classCallCheck(this, Trigger);\n\n    this.id = '';\n    this.description = 0;\n    this.startConditions = []; // pointer to a list of start conditions to  : AdsPlayer.mast.model.Trigger.Condition\n    this.endConditions = []; // pointer to a list of end conditions : AdsPlayer.mast.model.Trigger.Condition\n    this.sources = []; // pointer to a list of sources : AdsPlayer.mast.model.Trigger.Source\n    this.alreadyProcessed = false; // mainly in the seeked case : do not replay trigger already played\n    this.vasts = [];\n    this.activated = false;\n};\n\n/**\n* @class Condition\n* @ignore\n*/\n\n\nvar Condition = function Condition() {\n    _classCallCheck(this, Condition);\n\n    this.type = '';\n    this.name = '';\n    this.value = '';\n    this.operator = '';\n    this.conditions = [];\n};\n\n// ConditionType\n\n\nCondition.TYPE = {\n    EVENT: 'event',\n    PROPERTY: 'property'\n\n};\n\n// ConditionName\nCondition.NAME = {\n    ON_ITEM_START: 'OnItemStart',\n    ON_ITEM_END: 'OnItemEnd',\n    POSITION: 'Position',\n    DURATION: 'Duration'\n};\n\n// ConditionOperator\nCondition.OPERATOR = {\n    EQ: 'EQ', // equal\n    NEQ: 'NEQ', // not equal\n    GTR: 'GTR', // greater\n    GEQ: 'GEQ', // greater or equal\n    LT: 'LT', // lower\n    LEQ: 'LEQ', // lower or equal\n    MOD: 'MOD' // modulo\n};\n\n/**\n* @class Source\n* @ignore\n*/\n\nvar Source = function Source() {\n    _classCallCheck(this, Source);\n\n    this.uri = '';\n    this.altReference = '';\n    this.format = '';\n    this.sources = [];\n    // this.targets = [];\n};\n\n// SourceFormat\n\n\nSource.FORMAT = {\n    VAST: 'vast',\n    UIF: 'uif'\n};\n\nvar mast = {};\n\nmast.Mast = Mast;\nmast.Trigger = Trigger;\nmast.Condition = Condition;\nmast.Source = Source;\n\nexports.default = mast;\nexports.Mast = Mast;\nexports.Trigger = Trigger;\nexports.Condition = Condition;\nexports.Source = Source;\n\n},{}],11:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The ImagePlayer is a MediaPlayer implementation for playing still images.\n*/\n\nvar _Debug = require('../Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _utils = require('../utils/utils');\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ImagePlayer = function () {\n    _createClass(ImagePlayer, [{\n        key: '_getListeners',\n        value: function _getListeners(type) {\n            if (!(type in this._listeners)) {\n                this._listeners[type] = [];\n            }\n            return this._listeners[type];\n        }\n    }, {\n        key: '_addEventListener',\n        value: function _addEventListener(type, listener) {\n            var listeners = this._getListeners(type),\n                idx = listeners.indexOf(listener);\n\n            if (idx === -1) {\n                listeners.push(listener);\n            }\n        }\n    }, {\n        key: '_removeEventListener',\n        value: function _removeEventListener(type, listener) {\n            var listeners = this._getListeners(type),\n                idx = listeners.indexOf(listener);\n\n            if (idx !== -1) {\n                listeners.splice(idx, 1);\n            }\n        }\n    }, {\n        key: '_notifyEvent',\n        value: function _notifyEvent(type) {\n            var listeners = this._getListeners(type),\n                i = 0;\n\n            for (i = 0; i < listeners.length; i++) {\n                listeners[i].call(this);\n            }\n        }\n    }, {\n        key: '_updateCurrentTime',\n        value: function _updateCurrentTime() {\n            var time = new Date().getTime();\n\n            this._currentTime += (time - this._timerTime) / 1000;\n            //this._debug.log(\"Image timeupdate, time = \" + this._currentTime);\n            this._notifyEvent('timeupdate');\n\n            if (this._currentTime >= this._duration) {\n                this._stopTimer();\n                this._ended = true;\n                this._notifyEvent('ended');\n            }\n\n            this._timerTime = time;\n        }\n    }, {\n        key: '_startTimer',\n        value: function _startTimer() {\n            if (this._timerInterval !== null) {\n                return;\n            }\n            this._notifyEvent('play');\n            this._timerTime = new Date().getTime();\n            this._timerInterval = setInterval(this._updateCurrentTime.bind(this), 200);\n        }\n    }, {\n        key: '_stopTimer',\n        value: function _stopTimer() {\n            if (this._timerInterval === null) {\n                return;\n            }\n            this._notifyEvent('pause');\n            clearInterval(this._timerInterval);\n            this._timerInterval = null;\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function ImagePlayer() {\n        _classCallCheck(this, ImagePlayer);\n\n        this._uri = '';\n        this._image = null;\n        this._duration = 0;\n        this._currentTime = 0;\n        this._ended = false;\n        this._listeners = {};\n        this._timerInterval = null;\n        this._timerTime = -1;\n        this._events = ['play', 'pause', 'timeupdate', 'ended'];\n        this._debug = _Debug2.default.getInstance();\n    }\n\n    _createClass(ImagePlayer, [{\n        key: 'load',\n        value: function load(baseUrl, mediaFiles) {\n\n            var mediaFile = null,\n                type,\n                i;\n\n            // Load the first supported image format\n            // Support only jpeg, png and gif image formats\n            for (i = 0; i < mediaFiles.length; i++) {\n                type = mediaFiles[i].type;\n                if (type === \"image/jpeg\" || type === \"image/jpg\" || type === \"image/png\" || type === \"image/gif\") {\n                    mediaFile = mediaFiles[i];\n                    break;\n                }\n            }\n\n            if (mediaFile === null) {\n                return false;\n            }\n\n            // Get adsplayer-image element if already declared in DOM\n            this._image = document.getElementById('adsplayer-image');\n\n            if (!this._image) {\n                // Create the image element\n                this._image = document.createElement('img');\n                this._image.autoplay = false;\n                this._image.id = 'adsplayer-image';\n            }\n\n            // Add base URL\n            this._uri = mediaFile.uri;\n            this._uri = _utils2.default.isAbsoluteURI(this._uri) ? this._uri : baseUrl + this._uri;\n\n            this._debug.log(\"Load image media, uri = \" + this._uri);\n            this._image.src = this._uri;\n\n            // Reset current time\n            this._currentTime = 0;\n            this._ended = false;\n\n            return true;\n        }\n    }, {\n        key: 'getType',\n        value: function getType() {\n            return \"image\";\n        }\n    }, {\n        key: 'getElement',\n        value: function getElement() {\n            return this._image;\n        }\n    }, {\n        key: 'addEventListener',\n        value: function addEventListener(type, listener) {\n            if (!this._image) {\n                return;\n            }\n            if (this._events.indexOf(type) !== -1) {\n                this._addEventListener(type, listener);\n            } else {\n                this._image.addEventListener(type, listener);\n            }\n        }\n    }, {\n        key: 'removeEventListener',\n        value: function removeEventListener(type, listener) {\n            if (!this._image) {\n                return;\n            }\n            if (this._events.indexOf(type) !== -1) {\n                this._removeEventListener(type, listener);\n            } else {\n                this._image.removeEventListener(type, listener);\n            }\n        }\n    }, {\n        key: 'setDuration',\n        value: function setDuration(duration) {\n            this._duration = duration;\n        }\n    }, {\n        key: 'getDuration',\n        value: function getDuration() {\n            return this._duration;\n        }\n    }, {\n        key: 'getCurrentTime',\n        value: function getCurrentTime() {\n            return this._currentTime;\n        }\n    }, {\n        key: 'setVolume',\n        value: function setVolume() /*volume*/{\n            // NA\n        }\n    }, {\n        key: 'getVolume',\n        value: function getVolume() {\n            return 0;\n        }\n    }, {\n        key: 'play',\n        value: function play() {\n            if (!this._image) {\n                return;\n            }\n            this._startTimer();\n        }\n    }, {\n        key: 'pause',\n        value: function pause() {\n            if (!this._image) {\n                return;\n            }\n            this._stopTimer();\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            if (!this._image) {\n                return;\n            }\n            this._stopTimer();\n        }\n    }, {\n        key: 'reset',\n        value: function reset() {\n            if (!this._image) {\n                return;\n            }\n            this._image = null;\n            this._listeners = {};\n        }\n    }, {\n        key: 'isEnded',\n        value: function isEnded() {\n            return this._ended;\n        }\n    }]);\n\n    return ImagePlayer;\n}();\n\nexports.default = ImagePlayer;\n\n},{\"../Debug\":4,\"../utils/utils\":13}],12:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The VideoPlayer is a MediaPlayer implementation for playing video files.\n*/\n\nvar _Debug = require('../Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _utils = require('../utils/utils');\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar VideoPlayer = function () {\n    _createClass(VideoPlayer, [{\n        key: 'isMediaSupported',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function isMediaSupported(mimeType) {\n            if (!this._video) {\n                throw \"isMediaSupported(): element not created\";\n            }\n            if (!(this._video instanceof HTMLMediaElement)) {\n                throw \"isMediaSupported(): element must be of type HTMLMediaElement\";\n            }\n\n            var canPlay = this._video.canPlayType(mimeType);\n            return canPlay === \"probably\" || canPlay === \"maybe\";\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function VideoPlayer() {\n        _classCallCheck(this, VideoPlayer);\n\n        this._uri = '';\n        this._video = null;\n        this._debug = _Debug2.default.getInstance();\n    }\n\n    _createClass(VideoPlayer, [{\n        key: 'load',\n        value: function load(baseUrl, mediaFiles) {\n\n            // Get 'adsplayer-video' element if already declared in DOM\n            this._video = document.getElementById('adsplayer-video');\n\n            if (!this._video) {\n                // Create the video element\n                this._video = document.createElement('video');\n                this._video.autoplay = false;\n                this._video.id = 'adsplayer-video';\n            }\n\n            // Check if input format is supported\n            if (!this.isMediaSupported(mediaFiles[0].type)) {\n                return false;\n            }\n\n            // Sort the mediafiles in bitrate ascending order\n            mediaFiles.sort(function (a, b) {\n                if (a.bitrate && b.bitrate) {\n                    return a.bitrate - b.bitrate;\n                }\n                return -1;\n            });\n\n            // Play the media file with lowest bitrate\n            this._uri = mediaFiles[0].uri;\n\n            // Add base URL\n            this._uri = _utils2.default.isAbsoluteURI(this._uri) ? this._uri : baseUrl + this._uri;\n\n            this._debug.log(\"Load video media, uri = \" + this._uri);\n\n            this._video.addEventListener('error', function (e) {\n                console.log(e);\n            });\n\n            this._video.src = this._uri;\n\n            return true;\n        }\n    }, {\n        key: 'getType',\n        value: function getType() {\n            return \"video\";\n        }\n    }, {\n        key: 'getElement',\n        value: function getElement() {\n            return this._video;\n        }\n    }, {\n        key: 'addEventListener',\n        value: function addEventListener(type, listener) {\n            if (!this._video) {\n                return;\n            }\n            this._video.addEventListener(type, listener);\n        }\n    }, {\n        key: 'removeEventListener',\n        value: function removeEventListener(type, listener) {\n            if (!this._video) {\n                return;\n            }\n            this._video.removeEventListener(type, listener);\n        }\n    }, {\n        key: 'setDuration',\n        value: function setDuration() /*duration*/{\n            // duration is handled by the video element\n        }\n    }, {\n        key: 'getDuration',\n        value: function getDuration() {\n            if (!this._video) {\n                return 0;\n            }\n            return this._video.duration;\n        }\n    }, {\n        key: 'getCurrentTime',\n        value: function getCurrentTime() {\n            if (!this._video) {\n                return 0;\n            }\n            return this._video.currentTime;\n        }\n    }, {\n        key: 'getVolume',\n        value: function getVolume() {\n            if (!this._video) {\n                return 0;\n            }\n            return this._video.muted ? 0 : this._video.volume;\n        }\n    }, {\n        key: 'setVolume',\n        value: function setVolume(volume) {\n            if (!this._video) {\n                return;\n            }\n            this._video.volume = volume;\n        }\n    }, {\n        key: 'play',\n        value: function play() {\n            if (!this._video) {\n                return;\n            }\n            this._video.play();\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            if (!this._video) {\n                return;\n            }\n            this._video.pause();\n        }\n    }, {\n        key: 'pause',\n        value: function pause() {\n            if (!this._video) {\n                return;\n            }\n            this._video.pause();\n        }\n    }, {\n        key: 'reset',\n        value: function reset() {\n            if (!this._video) {\n                return;\n            }\n            this._video = null;\n        }\n    }, {\n        key: 'isEnded',\n        value: function isEnded() {\n            return this._video.ended;\n        }\n    }]);\n\n    return VideoPlayer;\n}();\n\nexports.default = VideoPlayer;\n\n},{\"../Debug\":4,\"../utils/utils\":13}],13:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nvar utils = {};\n\nutils.isAbsoluteURI = function (uri) {\n    return uri.toLowerCase().indexOf('http://') >= 0 || uri.toLowerCase().indexOf('https://') >= 0;\n};\n\nexports.default = utils;\n\n},{}],14:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nvar xmldom = {};\n\nxmldom.getElementsByTagName = function (node, name) {\n    var elements = node.getElementsByTagName(name);\n    if (elements.length < 1) {\n        var child = node.firstElementChild || node.firstChild;\n        if (child) {\n            var namespaceURI = child.namespaceURI;\n            elements = node.getElementsByTagNameNS(namespaceURI, name);\n        }\n    }\n    return elements;\n};\n\nxmldom.getElement = function (node, name) {\n    var elements = this.getElementsByTagName(node, name);\n    if (elements.length < 1) {\n        return null;\n    }\n    return elements[0];\n};\n\nxmldom.getElements = function (node, name) {\n    return this.getElementsByTagName(node, name);\n};\n\nxmldom.getSubElements = function (node, name, subName) {\n    var element = this.getElement(node, name);\n    if (element === null) {\n        return [];\n    }\n    return this.getElements(element, subName);\n};\n\nxmldom.getChildNode = function (node, name) {\n    if (!node || !node.childNodes) {\n        return null;\n    }\n    for (var i = 0; i < node.childNodes.length; i++) {\n        if (node.childNodes[i].nodeName === name) {\n            return node.childNodes[i];\n        }\n    }\n    return null;\n};\n\nxmldom.getNodeTextValue = function (node) {\n    var cdataSection = this.getChildNode(node, '#cdata-section'),\n        textSection = this.getChildNode(node, '#text');\n    if (cdataSection) {\n        return cdataSection.nodeValue;\n    } else if (textSection) {\n        return textSection.nodeValue;\n    }\n    return '';\n};\n\nxmldom.getChildNodeTextValue = function (node, name) {\n    var element = this.getElement(node, name);\n    if (element === null) {\n        return '';\n    }\n    return this.getNodeTextValue(element);\n};\n\nexports.default = xmldom;\n\n},{}],15:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The AdPlayer manages the sequencing of playing creatives of a single Ad.\n* It takes as input the Ad object as returned by the VAST parser.\n* The AdPlayer plays sequentially all contained Creatives,\n* with the help of a CreativePlayer.\n*\n* Dispatch events:\n*  - 'adStart' when when the playback of the ad (first creative) is starting.\n*  - 'adEnd' when the playback of the (all creatives) has ended\n*/\n\nvar _CreativePlayer = require('./CreativePlayer');\n\nvar _CreativePlayer2 = _interopRequireDefault(_CreativePlayer);\n\nvar _Debug = require('../Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _EventBus = require('../EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AdPlayer = function () {\n    _createClass(AdPlayer, [{\n        key: '_sendImpressions',\n        value: function _sendImpressions(impressions) {\n            var impression = void 0;\n\n            if (impressions.length === 0) {\n                return;\n            }\n\n            for (var i = 0; i < impressions.length; i++) {\n                impression = impressions[i];\n                if (impression.uri && impression.uri.length > 0) {\n                    this._debug.log(\"Send Impression, uri = \" + impression.uri);\n                    var http = new XMLHttpRequest();\n                    http.open(\"GET\", impression.uri, true);\n                    http.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n                    http.send();\n                }\n            }\n        }\n    }, {\n        key: '_onCreativeEnd',\n        value: function _onCreativeEnd() {\n\n            this._debug.log(\"Creative ended\");\n\n            // Stop the current creative media\n            this._stopCreative();\n\n            // Play next creative\n            this._playNextCreative();\n        }\n    }, {\n        key: '_pauseCreative',\n        value: function _pauseCreative() {\n            if (!this._creativePlayer) {\n                return;\n            }\n            this._creativePlayer.pause();\n        }\n    }, {\n        key: '_resumeCreative',\n        value: function _resumeCreative() {\n            if (!this._creativePlayer) {\n                return;\n            }\n            this._creativePlayer.play();\n        }\n    }, {\n        key: '_stopCreative',\n        value: function _stopCreative() {\n            if (!this._creativePlayer) {\n                return;\n            }\n            this._eventBus.removeEventListener('creativeEnd', this._onCreativeEndListener);\n            this._creativePlayer.stop();\n            this._creativePlayer = null;\n        }\n    }, {\n        key: '_playCreative',\n        value: function _playCreative(index) {\n            var creative = this._ad.inLine.creatives[index],\n                linear;\n\n            this._creativeIndex = index;\n            this._debug.log(\"Play Creative - index = \" + this._creativeIndex);\n\n            // Play Linear element\n            linear = creative.linear;\n\n            if (linear) {\n                this._debug.log(\"Play Linear Ad, duration = \" + linear.duration);\n                this._eventBus.addEventListener('creativeEnd', this._onCreativeEndListener);\n                this._creativePlayer = new _CreativePlayer2.default();\n                if (!this._creativePlayer.init(creative.linear, this._adPlayerContainer, this._mainVideo, this._baseUrl)) {\n                    this._playNextCreative();\n                }\n            } else {\n                this._playNextCreative();\n            }\n        }\n    }, {\n        key: '_playNextCreative',\n        value: function _playNextCreative() {\n\n            this._creativeIndex++;\n\n            if (this._creativeIndex < this._ad.inLine.creatives.length) {\n                this._playCreative(this._creativeIndex);\n            } else {\n                // Notify end of Ad\n                this._eventBus.dispatchEvent({\n                    type: \"adEnd\",\n                    data: {}\n                });\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n        /**\n         * Initializes the AdPlayer\n         * @method constructor\n         * @access public\n         * @memberof AdPlayer#\n         */\n\n    }]);\n\n    function AdPlayer() {\n        _classCallCheck(this, AdPlayer);\n\n        this._ad = null;\n        this._adPlayerContainer = null;\n        this._mainVideo = null;\n        this._baseUrl = '';\n        this._creativeIndex = -1;\n        this._creativePlayer = null;\n        this._debug = _Debug2.default.getInstance();\n        this._eventBus = _EventBus2.default.getInstance();\n\n        this._onCreativeEndListener = this._onCreativeEnd.bind(this);\n    }\n\n    /**\n     * Initializes the AdManager.\n     * @method init\n     * @access public\n     * @memberof VastPlayerManager#\n     * @param {Object} ad - the Ad to play\n     * @param {Array} adPlayerContainer - the HTML DOM container for ads player components\n     * @param {Object} mainVideo - the HTML5 video element used by the main media player\n     * @param {string} baseUrl - the base URL for media files\n     */\n\n\n    _createClass(AdPlayer, [{\n        key: 'init',\n        value: function init(ad, adPlayerContainer, mainVideo, baseUrl) {\n            this._ad = ad;\n            this._adPlayerContainer = adPlayerContainer;\n            this._mainVideo = mainVideo;\n            this._baseUrl = baseUrl;\n        }\n    }, {\n        key: 'start',\n        value: function start() {\n            // Notify an Ad is starting to play\n            this._eventBus.dispatchEvent({\n                type: 'adStart',\n                data: {}\n            });\n\n            // Send Impressions tracking\n            this._sendImpressions(this._ad.inLine.impressions);\n\n            // Play first Creative\n            this._playCreative(0);\n        }\n    }, {\n        key: 'play',\n        value: function play() {\n            this._resumeCreative();\n        }\n    }, {\n        key: 'pause',\n        value: function pause() {\n            this._pauseCreative();\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            this._stopCreative();\n        }\n    }]);\n\n    return AdPlayer;\n}();\n\nexports.default = AdPlayer;\n\n},{\"../Debug\":4,\"../EventBus\":6,\"./CreativePlayer\":16}],16:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The CreativePlayer manages:\n* - the playing of media files within a Creative (with the help of a Image/VideoPlayer)\n* - the tracking events (with the help of a TrackingEventsManager)\n* - the display of the ad skipping component\n* - the user clicks\n*/\n\nvar _TrackingEventsManager = require('./TrackingEventsManager');\n\nvar _TrackingEventsManager2 = _interopRequireDefault(_TrackingEventsManager);\n\nvar _VideoPlayer = require('../media/VideoPlayer');\n\nvar _VideoPlayer2 = _interopRequireDefault(_VideoPlayer);\n\nvar _ImagePlayer = require('../media/ImagePlayer');\n\nvar _ImagePlayer2 = _interopRequireDefault(_ImagePlayer);\n\nvar _Debug = require('../Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _EventBus = require('../EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CreativePlayer = function () {\n    _createClass(CreativePlayer, [{\n        key: '_parseTime',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _parseTime(str) {\n            var timeParts,\n                SECONDS_IN_HOUR = 60 * 60,\n                SECONDS_IN_MIN = 60;\n\n            if (!str) {\n                return -1;\n            }\n\n            timeParts = str.split(':');\n\n            // Check time format, must be HH:MM:SS(.mmm)\n            if (timeParts.length !== 3) {\n                return -1;\n            }\n\n            return parseInt(timeParts[0]) * SECONDS_IN_HOUR + parseInt(timeParts[1]) * SECONDS_IN_MIN + parseFloat(timeParts[2]);\n        }\n    }, {\n        key: '_onMediaPlay',\n        value: function _onMediaPlay() {\n\n            this._debug.log(\"Creative media play\");\n\n            // Notify the creative has ended\n            this._eventBus.dispatchEvent({\n                type: 'play',\n                data: {}\n            });\n        }\n    }, {\n        key: '_onMediaPause',\n        value: function _onMediaPause() {\n\n            this._debug.log(\"Creative media pause\");\n\n            // Notify the creative has ended\n            this._eventBus.dispatchEvent({\n                type: 'pause',\n                data: {}\n            });\n        }\n    }, {\n        key: '_onMediaError',\n        value: function _onMediaError() {\n\n            this._debug.log(\"Creative media error\");\n\n            // Notify the creative has ended\n            this._eventBus.dispatchEvent({\n                type: 'creativeEnd',\n                data: {}\n            });\n        }\n    }, {\n        key: '_onMediaEnded',\n        value: function _onMediaEnded() {\n\n            this._debug.log(\"creative media ended\");\n\n            // Notify the creative has ended\n            this._eventBus.dispatchEvent({\n                type: 'creativeEnd',\n                data: {}\n            });\n        }\n    }, {\n        key: '_onMediaTimeupdate',\n        value: function _onMediaTimeupdate() {\n\n            //this._debug.log(\"Media timeupdate: \" + this._mediaPlayer.getCurrentTime());\n        }\n    }, {\n        key: '_onMainVideoVolumeChange',\n        value: function _onMainVideoVolumeChange() {\n            if (!this._mediaPlayer) {\n                return;\n            }\n            this._mediaPlayer.setVolume(this._mainVideo.muted ? 0 : this._mainVideo.volume);\n        }\n    }, {\n        key: '_onAdClick',\n        value: function _onAdClick(creative) {\n            // this = creative player\n            if (!creative.videoClicks) {\n                return;\n            }\n            this._debug.log(\"Creative Click\");\n            // ClickThrough : send an event for the application to open the web page\n            if (creative.videoClicks.clickThrough) {\n                this._debug.log(\"Ad click, uri = \" + creative.videoClicks.clickThrough);\n                this._eventBus.dispatchEvent({\n                    type: 'click',\n                    data: {\n                        uri: creative.videoClicks.clickThrough\n                    }\n                });\n            }\n\n            // TODO\n            // ClickTracking\n            // if (this.videoClicks.clickTracking) {\n            // }\n        }\n    }, {\n        key: '_load',\n        value: function _load(creative, baseUrl) {\n            var mediaFile, isVideo, isImage;\n\n            if (!creative) {\n                return false;\n            }\n\n            if (creative.mediaFiles.length === 0) {\n                return false;\n            }\n\n            mediaFile = creative.mediaFiles[0];\n\n            // Video or image media ?\n            isVideo = mediaFile.type.indexOf('video') !== -1;\n            isImage = mediaFile.type.indexOf('image') !== -1;\n\n            if (isVideo) {\n                this._mediaPlayer = new _VideoPlayer2.default();\n            } else if (isImage) {\n                this._mediaPlayer = new _ImagePlayer2.default();\n            } else {\n                // Unknown/unsupported media type\n                return false;\n            }\n\n            // Load the media files\n            this._debug.log(\"Creative load\");\n            if (!this._mediaPlayer.load(baseUrl, creative.mediaFiles)) {\n                this._mediaPlayer = null;\n                return false;\n            }\n\n            this._mediaPlayer.setDuration(this._parseTime(creative.duration));\n            this._mediaPlayer.addEventListener('play', this._onMediaPlayListener);\n            this._mediaPlayer.addEventListener('pause', this._onMediaPauseListener);\n            this._mediaPlayer.addEventListener('error', this._onMediaErrorListener);\n            this._mediaPlayer.addEventListener('timeupdate', this._onMediaTimeupdateListener);\n            this._mediaPlayer.addEventListener('ended', this._onMediaEndedListener);\n\n            // Add tracking events\n            if (creative.trackingEvents) {\n                this._trackingEventsManager = new _TrackingEventsManager2.default();\n                this._trackingEventsManager.init(creative.trackingEvents, this._mediaPlayer);\n                this._trackingEventsManager.start();\n            }\n\n            // Notify a creative is starting to play\n            this._eventBus.dispatchEvent({\n                type: 'creativeStart',\n                data: {}\n            });\n\n            // Notify a media element has been created and appended into document\n            this._eventBus.dispatchEvent({\n                type: 'addElement',\n                data: {\n                    element: this._mediaPlayer.getElement(),\n                    type: this._mediaPlayer.getType()\n                }\n            });\n\n            // Add the media player DOM element\n            this._adPlayerContainer.appendChild(this._mediaPlayer.getElement());\n\n            // Listener for click\n            if (creative.videoClicks) {\n                if (creative.videoClicks.clickThrough) {\n                    this._mediaPlayer.getElement().style.cursor = 'pointer';\n                }\n                this._mediaPlayer.getElement().addEventListener('click', this._onAdClick.bind(this, creative));\n            }\n\n            // Align media volume to main video volume, add 'volumechange' listener\n            this._onMainVideoVolumeChange();\n            this._mainVideo.addEventListener('volumechange', this._onMainVideoVolumeChange.bind(this));\n\n            // Start playing the media\n            this._play();\n\n            return true;\n        }\n    }, {\n        key: '_play',\n        value: function _play() {\n\n            if (!this._mediaPlayer) {\n                return;\n            }\n\n            this._debug.log(\"Creative play\");\n\n            // Play the media player\n            this._mediaPlayer.play();\n        }\n    }, {\n        key: '_pause',\n        value: function _pause() {\n\n            if (!this._mediaPlayer) {\n                return;\n            }\n\n            this._debug.log(\"Creative pause\");\n\n            // Pause the media player\n            this._mediaPlayer.pause();\n        }\n    }, {\n        key: '_stop',\n        value: function _stop() {\n\n            if (!this._mediaPlayer) {\n                return;\n            }\n\n            this._debug.log(\"Creative stop\");\n\n            // Stop listening for 'volumechange' event\n            this._mainVideo.removeEventListener('volumechange', this._onMainVideoVolumeChange);\n            this._mainVideo = null;\n\n            // Stop the media player\n            this._mediaPlayer.removeEventListener('play', this._onMediaPlayListener);\n            this._mediaPlayer.removeEventListener('pause', this._onMediaPauseListener);\n            this._mediaPlayer.removeEventListener('error', this._onMediaErrorListener);\n            this._mediaPlayer.removeEventListener('timeupdate', this._onMediaTimeupdateListener);\n            this._mediaPlayer.removeEventListener('ended', this._onMediaEndedListener);\n            this._mediaPlayer.stop();\n\n            // Notify a media element has been removed from DOM\n            this._eventBus.dispatchEvent({\n                type: 'removeElement',\n                data: {\n                    element: this._mediaPlayer.getElement(),\n                    type: this._mediaPlayer.getType()\n                }\n            });\n\n            // Remove the element from the DOM\n            this._adPlayerContainer.removeChild(this._mediaPlayer.getElement());\n\n            // Reset the media player\n            this._mediaPlayer.reset();\n            this._mediaPlayer = null;\n\n            // Stop the TrackingEvents manager\n            if (this._trackingEventsManager) {\n                this._trackingEventsManager.stop();\n                this._trackingEventsManager = null;\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function CreativePlayer() {\n        _classCallCheck(this, CreativePlayer);\n\n        this._adPlayerContainer = null;\n        this._mediaPlayer = null;\n        this._trackingEventsManager = null;\n        this._mainVideo = null;\n        this._debug = _Debug2.default.getInstance();\n        this._eventBus = _EventBus2.default.getInstance();\n\n        this._onMediaPlayListener = this._onMediaPlay.bind(this);\n        this._onMediaPauseListener = this._onMediaPause.bind(this);\n        this._onMediaErrorListener = this._onMediaError.bind(this);\n        this._onMediaTimeupdateListener = this._onMediaTimeupdate.bind(this);\n        this._onMediaEndedListener = this._onMediaEnded.bind(this);\n    }\n\n    /**\n     * Initializes the creative player.\n     * @method init\n     * @access public\n     * @memberof CreativePlayer#\n     * @param {Object} creative - the creative element to play\n     * @param {Object} adPlayerContainer - the HTML DOM container for ads player components\n     * @param {Object} mainVideo - the HTML5 video element used by the main media player\n     * @param {string} baseUrl - the base URL for media files\n     */\n\n\n    _createClass(CreativePlayer, [{\n        key: 'init',\n        value: function init(creative, adPlayerContainer, mainVideo, baseUrl) {\n            this._adPlayerContainer = adPlayerContainer;\n            this._mainVideo = mainVideo;\n            return this._load(creative, baseUrl);\n        }\n    }, {\n        key: 'play',\n        value: function play() {\n            this._play();\n        }\n    }, {\n        key: 'pause',\n        value: function pause() {\n            this._pause();\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            this._stop();\n        }\n    }]);\n\n    return CreativePlayer;\n}();\n\nexports.default = CreativePlayer;\n\n},{\"../Debug\":4,\"../EventBus\":6,\"../media/ImagePlayer\":11,\"../media/VideoPlayer\":12,\"./TrackingEventsManager\":17}],17:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The TrackingEventsManager manages the sending of the tracking events while a creative's media is playing.\n* It takes as input the list of tracking events to send.\n*/\n\nvar _Debug = require('../Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TrackingEventsManager = function () {\n    _createClass(TrackingEventsManager, [{\n        key: '_postEvent',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _postEvent(uri) {\n            var xhr = new XMLHttpRequest();\n            xhr.open('GET', uri, true);\n            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n            xhr.send();\n        }\n    }, {\n        key: '_addEventListener',\n        value: function _addEventListener(element, eventType, trackingEvent) {\n\n            var self = this,\n                _listener = function _listener() /*event*/{\n                if (this.completed === true) {\n                    return;\n                }\n                if (this.uri === undefined || this.uri.length === 0) {\n                    return;\n                }\n                if (this.condition && !this.condition()) {\n                    return;\n                }\n                self._debug.log(\"Send tracking event \" + this.event + \", uri = \" + this.uri);\n                self._postEvent(this.uri);\n                if (this.oneShot === true) {\n                    this.completed = true;\n                }\n            },\n                _eventListener = {\n                type: eventType,\n                element: element,\n                listener: _listener.bind(trackingEvent)\n            };\n\n            element.addEventListener(eventType, _eventListener.listener);\n            this._eventListeners.push(_eventListener);\n        }\n    }, {\n        key: '_addPlayerEventListeners',\n        value: function _addPlayerEventListeners() {\n            var _this = this;\n\n            var _loop = function _loop(i) {\n                var trackingEvent = _this._trackingEvents[i];\n                if (trackingEvent.uri && trackingEvent.uri.length > 0) {\n                    switch (trackingEvent.event) {\n                        case 'creativeView':\n                            trackingEvent.oneShot = true;\n                            _this._addEventListener(_this._adMediaPlayer, 'loadeddata', trackingEvent);\n                            break;\n                        case 'start':\n                            trackingEvent.oneShot = true;\n                            _this._addEventListener(_this._adMediaPlayer, 'playing', trackingEvent);\n                            break;\n                        case 'pause':\n                            trackingEvent.oneShot = false;\n                            trackingEvent.condition = function () {\n                                // To ignore pause event that may be raised at end of stream\n                                return _this._adMediaPlayer.isEnded() === false;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'pause', trackingEvent);\n                            break;\n                        case 'resume':\n                            trackingEvent.oneShot = false;\n                            trackingEvent.condition = function () {\n                                return _this._adMediaPlayer.getCurrentTime() > 0;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'play', trackingEvent);\n                            break;\n                        case 'firstQuartile':\n                            trackingEvent.oneShot = true;\n                            trackingEvent.condition = function () {\n                                //_debug.log(\"Progress: \" + (this._adMediaPlayer.getCurrentTime() / _adMediaPlayer.getDuration()));\n                                return _this._adMediaPlayer.getCurrentTime() / _this._adMediaPlayer.getDuration() >= 0.25;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'timeupdate', trackingEvent);\n                            break;\n                        case 'midpoint':\n                            trackingEvent.oneShot = true;\n                            trackingEvent.condition = function () {\n                                //_debug.log(\"Progress: \" + (this._adMediaPlayer.getCurrentTime() / _adMediaPlayer.getDuration()));\n                                return _this._adMediaPlayer.getCurrentTime() / _this._adMediaPlayer.getDuration() >= 0.50;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'timeupdate', trackingEvent);\n                            break;\n                        case 'thirdQuartile':\n                            trackingEvent.oneShot = true;\n                            trackingEvent.condition = function () {\n                                //_debug.log(\"Progress: \" + (this._adMediaPlayer.getCurrentTime() / _adMediaPlayer.getDuration()));\n                                return _this._adMediaPlayer.getCurrentTime() / _this._adMediaPlayer.getDuration() >= 0.75;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'timeupdate', trackingEvent);\n                            break;\n                        case 'rewind':\n                            trackingEvent.oneShot = false;\n                            trackingEvent.condition = function () {\n                                var res = _this._adMediaPlayer.getCurrentTime() < _this._currentTime && _this._adMediaPlayer.isEnded() === false;\n                                _this._currentTime = _this._adMediaPlayer.getCurrentTime();\n                                return res;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'timeupdate', trackingEvent);\n                            break;\n                        case 'complete':\n                            _this._addEventListener(_this._adMediaPlayer, 'ended', trackingEvent);\n                            break;\n                        case 'mute':\n                            trackingEvent.oneShot = false;\n                            trackingEvent.condition = function () {\n                                var res = !_this._mute && _this._adMediaPlayer.getVolume() === 0;\n                                _this._mute = _this._adMediaPlayer.getVolume() === 0;\n                                return res;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'volumechange', trackingEvent);\n                            break;\n                        case 'unmute':\n                            trackingEvent.oneShot = false;\n                            trackingEvent.condition = function () {\n                                var res = !_this._unmute && _this._adMediaPlayer.getVolume() > 0;\n                                _this._unmute = _this._adMediaPlayer.getVolume() > 0;\n                                return res;\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'volumechange', trackingEvent);\n                            break;\n                        case 'fullscreen':\n                        case 'exitFullscreen':\n                            trackingEvent.oneShot = false;\n                            trackingEvent.condition = function () {\n                                var event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : trackingEvent.event;\n\n                                var state = event === 'fullscreen';\n                                return document.fullScreen === state || document.mozFullScreen === state || document.webkitIsFullScreen === state;\n                            };\n                            _this._addEventListener(document, 'webkitfullscreenchange', trackingEvent);\n                            _this._addEventListener(document, 'mozfullscreenchange', trackingEvent);\n                            _this._addEventListener(document, 'MSFullscreenChange', trackingEvent);\n                            _this._addEventListener(document, 'fullscreenChange', trackingEvent);\n                            break;\n                        case 'progress':\n                            trackingEvent.oneShot = true;\n                            trackingEvent.condition = function () {\n                                if (trackingEvent.offsetPercent) {\n                                    //this._debug.log(\"progress:\" + this._adMediaPlayer.getCurrentTime()+\" vs offsetPercent = \" + trackingEvent.offsetPercent * this._adMediaPlayer.getDuration());\n                                    return _this._adMediaPlayer.getCurrentTime() >= trackingEvent.offsetPercent * _this._adMediaPlayer.getDuration();\n                                } else {\n                                    //this._debug.log(\"progress:\" + this._adMediaPlayer.getCurrentTime()+\" vs offsetInSeconds \" + trackingEvent.offsetInSeconds);\n                                    return _this._adMediaPlayer.getCurrentTime() >= trackingEvent.offsetInSeconds;\n                                }\n                            };\n                            _this._addEventListener(_this._adMediaPlayer, 'timeupdate', trackingEvent);\n                            break;\n                        case 'acceptInvitationLinear':\n                            trackingEvent.oneShot = false;\n                            _this._addEventListener(_this._adMediaPlayer, 'click', trackingEvent);\n                            break;\n                        case 'closeLinear':\n                            trackingEvent.oneShot = false;\n                            _this._addEventListener(window, 'beforeunload', trackingEvent);\n                            break;\n                        default:\n                            break;\n                    }\n                }\n            };\n\n            for (var i = 0; i < this._trackingEvents.length; i++) {\n                _loop(i);\n            }\n        }\n    }, {\n        key: '_removePlayerEventListeners',\n        value: function _removePlayerEventListeners() {\n            for (var i = 0; i < this._eventListeners.length; i++) {\n                this._eventListeners[i].element.removeEventListener(this._eventListeners[i].type, this._eventListeners[i].listener);\n            }\n            this._eventListeners = [];\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function TrackingEventsManager() {\n        _classCallCheck(this, TrackingEventsManager);\n\n        this._trackingEvents = null;\n        this._adMediaPlayer = null;\n        this._currentTime = -1;\n        this._mute = -1;\n        this._unmute = -1;\n        this._debug = _Debug2.default.getInstance();\n        this._eventListeners = [];\n    }\n\n    /**\n     * Initializes the TrackingEventsManager.\n     * @method init\n     * @access public\n     * @memberof TrackingEventsManager#\n     * @param {Array} trackingEvents - the array of tracking events to manage\n     * @param {Object} adMediaPlayer - the ad media player\n     */\n\n\n    _createClass(TrackingEventsManager, [{\n        key: 'init',\n        value: function init(trackingEvents, adMediaPlayer) {\n            this._trackingEvents = trackingEvents;\n            this._adMediaPlayer = adMediaPlayer;\n            this._mute = this._adMediaPlayer.getVolume() === 0;\n            this._unmute = this._adMediaPlayer.getVolume() > 0;\n        }\n    }, {\n        key: 'start',\n        value: function start() {\n            if (this._trackingEvents.length === 0) {\n                return;\n            }\n            this._addPlayerEventListeners();\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            this._removePlayerEventListeners();\n        }\n    }]);\n\n    return TrackingEventsManager;\n}();\n\nexports.default = TrackingEventsManager;\n\n},{\"../Debug\":4}],18:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* VAST parser. This class parses VAST file in XML format\n* and construct the corresponding VAST object according to VAST data model.\n*/\n\nvar _Vast = require('./model/Vast');\n\nvar _Vast2 = _interopRequireDefault(_Vast);\n\nvar _xmldom = require('../utils/xmldom');\n\nvar _xmldom2 = _interopRequireDefault(_xmldom);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar VastParser = function () {\n    _createClass(VastParser, [{\n        key: '_getTrackingEvent',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _getTrackingEvent(trackingNode) {\n            var trackingEvent = new _Vast2.default.TrackingEvent();\n\n            trackingEvent.event = trackingNode.getAttribute('event');\n            trackingEvent.uri = _xmldom2.default.getNodeTextValue(trackingNode);\n            if (trackingEvent.event == \"progress\") {\n                var offsetValue = trackingNode.getAttribute('offset');\n                if (offsetValue.indexOf(\"%\") == -1) {\n                    /* convert HH:MM:SS ( or HH:MM:SS.mmm) in seconds */\n                    trackingEvent.offsetInSeconds = new Date('1970-01-01T' + offsetValue + 'Z').getTime() / 1000;\n                } else {\n                    trackingEvent.offsetPercent = offsetValue.substring(0, offsetValue.indexOf(\"%\")) / 100;\n                }\n            }\n            return trackingEvent;\n        }\n    }, {\n        key: '_getVideoClicks',\n        value: function _getVideoClicks(videoClicksNode) {\n            var videoClicks = new _Vast2.default.VideoClicks(),\n                nodeName = void 0,\n                nodeValue = void 0;\n\n            for (var i = 0; i < videoClicksNode.childNodes.length; i++) {\n                nodeName = videoClicksNode.childNodes[i].nodeName;\n                nodeValue = _xmldom2.default.getNodeTextValue(videoClicksNode.childNodes[i]);\n\n                switch (nodeName) {\n                    case \"ClickThrough\":\n                        videoClicks.clickThrough = nodeValue;\n                        break;\n                    case \"ClickTracking\":\n                        videoClicks.clickTracking = nodeValue;\n                        break;\n                    case \"CustomClick\":\n                        videoClicks.customClick = nodeValue;\n                        break;\n                }\n            }\n\n            return videoClicks;\n        }\n    }, {\n        key: '_getMediaFile',\n        value: function _getMediaFile(mediaFileNode) {\n            var mediaFile = new _Vast2.default.MediaFile();\n\n            mediaFile.id = mediaFileNode.getAttribute('id');\n            mediaFile.delivery = mediaFileNode.getAttribute('delivery');\n            mediaFile.type = mediaFileNode.getAttribute('type');\n            mediaFile.bitrate = mediaFileNode.getAttribute('bitrate');\n            mediaFile.width = mediaFileNode.getAttribute('width');\n            mediaFile.height = mediaFileNode.getAttribute('height');\n            mediaFile.scalable = mediaFileNode.getAttribute('scalable');\n            mediaFile.maintainAspectRatio = mediaFileNode.getAttribute('maintainAspectRatio');\n            mediaFile.apiFramework = mediaFileNode.getAttribute('apiFramework');\n            mediaFile.uri = _xmldom2.default.getNodeTextValue(mediaFileNode);\n\n            return mediaFile;\n        }\n    }, {\n        key: '_getLinear',\n        value: function _getLinear(linearNode) {\n            var linear = new _Vast2.default.Linear(),\n                trackingNodes = void 0,\n                videoClicksNode = void 0,\n                mediaFileNodes = void 0,\n                i = void 0;\n\n            linear.duration = _xmldom2.default.getChildNodeTextValue(linearNode, 'Duration');\n            linear.adParameters = _xmldom2.default.getChildNodeTextValue(linearNode, 'AdParameters');\n\n            trackingNodes = _xmldom2.default.getSubElements(linearNode, 'TrackingEvents', 'Tracking');\n            for (i = 0; i < trackingNodes.length; i++) {\n                linear.trackingEvents.push(this._getTrackingEvent(trackingNodes[i]));\n            }\n\n            videoClicksNode = _xmldom2.default.getElement(linearNode, 'VideoClicks');\n            if (videoClicksNode) {\n                linear.videoClicks = this._getVideoClicks(videoClicksNode);\n            }\n\n            mediaFileNodes = _xmldom2.default.getSubElements(linearNode, 'MediaFiles', 'MediaFile');\n            for (i = 0; i < mediaFileNodes.length; i++) {\n                linear.mediaFiles.push(this._getMediaFile(mediaFileNodes[i]));\n            }\n\n            return linear;\n        }\n    }, {\n        key: '_getCreative',\n        value: function _getCreative(creativeNode) {\n            var creative = new _Vast2.default.Creative(),\n                linearNode = void 0;\n\n            creative.id = creativeNode.getAttribute('id');\n            creative.adId = creativeNode.getAttribute('AdID');\n            creative.sequence = creativeNode.getAttribute('sequence');\n\n            linearNode = _xmldom2.default.getElement(creativeNode, 'Linear');\n            if (linearNode) {\n                creative.linear = this._getLinear(linearNode);\n            }\n\n            // TODO: get Companion and non-Linear elements\n\n            return creative;\n        }\n    }, {\n        key: '_getInLine',\n        value: function _getInLine(adNode) {\n            var inLine = new _Vast2.default.InLine(),\n                inLineNode = _xmldom2.default.getElement(adNode, 'InLine'),\n                impressionNodes = void 0,\n                creativeNodes = void 0,\n                i = void 0;\n\n            if (inLineNode === null) {\n                return null;\n            }\n\n            inLine.adSystem = _xmldom2.default.getChildNodeTextValue(inLineNode, 'AdSystem');\n            inLine.adTitle = _xmldom2.default.getChildNodeTextValue(inLineNode, 'AdTitle');\n            inLine.description = _xmldom2.default.getChildNodeTextValue(inLineNode, 'Description');\n            inLine.survey = _xmldom2.default.getChildNodeTextValue(inLineNode, 'Survey');\n            inLine.error = _xmldom2.default.getChildNodeTextValue(inLineNode, 'Error');\n\n            impressionNodes = _xmldom2.default.getElements(inLineNode, 'Impression');\n            for (i = 0; i < impressionNodes.length; i++) {\n                var impression = new _Vast2.default.Impression();\n                impression.id = impressionNodes[i].getAttribute('id');\n                impression.uri = _xmldom2.default.getNodeTextValue(impressionNodes[i]);\n                inLine.impressions.push(impression);\n            }\n\n            creativeNodes = _xmldom2.default.getSubElements(inLineNode, 'Creatives', 'Creative');\n            for (i = 0; i < creativeNodes.length; i++) {\n                inLine.creatives.push(this._getCreative(creativeNodes[i]));\n            }\n\n            return inLine;\n        }\n    }, {\n        key: '_getAd',\n        value: function _getAd(adNode) {\n            var ad = new _Vast2.default.Ad();\n            ad.id = adNode.getAttribute('id');\n            ad.sequence = adNode.getAttribute('sequence');\n            ad.inLine = this._getInLine(adNode);\n            return ad;\n        }\n    }, {\n        key: '_getAds',\n        value: function _getAds(vastNode, vast_) {\n            var adNodes = _xmldom2.default.getElements(vastNode, 'Ad');\n            for (var i = 0; i < adNodes.length; i++) {\n                vast_.ads.push(this._getAd(adNodes[i]));\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function VastParser() {\n        _classCallCheck(this, VastParser);\n    }\n\n    /**\n    * Parses the VAST XML DOM and get the triggers.\n    * @param {object} xmlDom - the XML DOM to parse\n    */\n\n\n    _createClass(VastParser, [{\n        key: 'parse',\n        value: function parse(xmlDom) {\n            var vast_ = new _Vast2.default.Vast(),\n                vastNode = _xmldom2.default.getElement(xmlDom, 'VAST');\n\n            if (vastNode === null) {\n                return vast_;\n            }\n\n            vast_.version = vastNode.getAttribute('version');\n\n            this._getAds(vastNode, vast_);\n\n            return vast_;\n        }\n    }]);\n\n    return VastParser;\n}();\n\nexports.default = VastParser;\n\n},{\"../utils/xmldom\":14,\"./model/Vast\":20}],19:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * The copyright in this software module is being made available under the BSD License, included\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * below. This software module may be subject to other third party and/or contributor rights,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * including patent rights, and no such rights are granted under this license.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Copyright (c) 2016, Orange\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * All rights reserved.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Redistribution and use in source and binary forms, with or without modification, are permitted\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * provided that the following conditions are met:\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions of source code must retain the above copyright notice, this list of conditions\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   and the following disclaimer.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Redistributions in binary form must reproduce the above copyright notice, this list of\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   conditions and the following disclaimer in the documentation and/or other materials provided\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   with the distribution.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   products derived from this software module without specific prior written permission.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\n\n/**\n* The VastPlayerManager manages the sequencing of playing ads of a single VAST.\n* It takes as input the list of Vast objects as returned by the VAST parser.\n* For each Vast, the VastPlayerManager plays sequentially all contained Ads,\n* with the help of an AdPlayer.\n*/\n\nvar _AdPlayer = require('./AdPlayer');\n\nvar _AdPlayer2 = _interopRequireDefault(_AdPlayer);\n\nvar _Debug = require('../Debug');\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _EventBus = require('../EventBus');\n\nvar _EventBus2 = _interopRequireDefault(_EventBus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar VastPlayerManager = function () {\n    _createClass(VastPlayerManager, [{\n        key: '_onAdEnd',\n\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n        value: function _onAdEnd() {\n\n            this._debug.log(\"Ad ended\");\n\n            // Stop the current Ad\n            this._stopAd();\n\n            // Play next Ad\n            this._playNextAd();\n        }\n    }, {\n        key: '_pauseAd',\n        value: function _pauseAd() {\n            if (!this._adPlayer) {\n                return;\n            }\n            this._adPlayer.pause();\n        }\n    }, {\n        key: '_resumeAd',\n        value: function _resumeAd() {\n            if (!this._adPlayer) {\n                return;\n            }\n            this._adPlayer.play();\n        }\n    }, {\n        key: '_stopAd',\n        value: function _stopAd() {\n            if (!this._adPlayer) {\n                return;\n            }\n            this._eventBus.removeEventListener('adEnd', this._onAdEndListener);\n            this._adPlayer.stop();\n            this._adPlayer = null;\n        }\n    }, {\n        key: '_playAd',\n        value: function _playAd(index) {\n            var vast = this._vasts[this._vastIndex],\n                ad = vast.ads[index];\n\n            this._adIndex = index;\n            this._debug.log(\"Play Ad - index = \" + this._adIndex);\n\n            this._eventBus.addEventListener('adEnd', this._onAdEndListener);\n            this._adPlayer = new _AdPlayer2.default();\n            this._adPlayer.init(ad, this._adPlayerContainer, this._mainVideo, vast.baseUrl);\n            this._adPlayer.start();\n        }\n    }, {\n        key: '_playNextAd',\n        value: function _playNextAd() {\n            var vast = this._vasts[this._vastIndex];\n\n            this._adIndex++;\n\n            if (this._adIndex < vast.ads.length) {\n                this._playAd(this._adIndex);\n            } else {\n                this._playNextVast();\n            }\n        }\n    }, {\n        key: '_playVast',\n        value: function _playVast(index) {\n            var vast = this._vasts[index];\n\n            if (vast.ads.length === 0) {\n                // Empty VAST\n                return;\n            }\n\n            this._vastIndex = index;\n            this._debug.log(\"Play Vast - index = \" + this._vastIndex);\n\n            // Play first Ad\n            this._playAd(0);\n        }\n    }, {\n        key: '_playNextVast',\n        value: function _playNextVast() {\n\n            this._vastIndex++;\n\n            if (this._vastIndex < this._vasts.length) {\n                this._playVast(this._vastIndex);\n            } else {\n                // Notify end of trigger\n                this._eventBus.dispatchEvent({\n                    type: 'triggerEnd',\n                    data: {}\n                });\n            }\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////////////////\n        ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    }]);\n\n    function VastPlayerManager() {\n        _classCallCheck(this, VastPlayerManager);\n\n        this._vasts = [];\n        this._adPlayerContainer = null;\n        this._adIndex = -1;\n        this._adPlayer = null;\n        this._debug = _Debug2.default.getInstance();\n        this._eventBus = _EventBus2.default.getInstance();\n        this._onAdEndListener = this._onAdEnd.bind(this);\n    }\n\n    /**\n     * Initializes the VastPlayerManager.\n     * @method init\n     * @access public\n     * @memberof VastPlayerManager#\n     * @param {Array} vasts - the array of Vast components to play\n     * @param {Array} adPlayerContainer - the HTML DOM container for ads player components\n     */\n\n\n    _createClass(VastPlayerManager, [{\n        key: 'init',\n        value: function init(vasts, adPlayerContainer, mainVideo) {\n            this._vasts = vasts;\n            this._adPlayerContainer = adPlayerContainer;\n            this._mainVideo = mainVideo;\n        }\n    }, {\n        key: 'start',\n        value: function start() {\n            if (!this._vasts || this._vasts.length === 0) {\n                return;\n            }\n\n            // Notify a trigger is starting to play\n            this._eventBus.dispatchEvent({\n                type: 'triggerStart',\n                data: {}\n            });\n\n            this._playVast(0);\n        }\n    }, {\n        key: 'play',\n        value: function play() {\n            this._resumeAd();\n        }\n    }, {\n        key: 'pause',\n        value: function pause() {\n            this._pauseAd();\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            this._stopAd();\n        }\n    }]);\n\n    return VastPlayerManager;\n}();\n\nexports.default = VastPlayerManager;\n\n},{\"../Debug\":4,\"../EventBus\":6,\"./AdPlayer\":15}],20:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* @class Vast\n* @ignore\n*/\nvar Vast = function Vast() {\n    _classCallCheck(this, Vast);\n\n    this.version = '';\n    this.ads = [];\n};\n\n/**\n* @class Ad\n* @ignore\n*/\n\n\nvar Ad = function Ad() {\n    _classCallCheck(this, Ad);\n\n    this.id = ''; // [Optional] an ad server-defined string for the ad\n    this.sequence = 0; // [Optional] the sequence in which an ad should play\n    this.inLine = null;\n    this.wrapper = null;\n};\n\n/**\n* @class InLine\n* @ignore\n*/\n\n\nvar InLine = function InLine() {\n    _classCallCheck(this, InLine);\n\n    this.adSystem = ''; // [Required] Source ad server\n    this.adTitle = ''; // [Required] Title\n    this.description = ''; // [Optional] Description\n    this.survey = ''; // [Optional] URI of request to survey vendor\n    this.error = ''; // [Optional] URI to request if ad does not play due to error\n    this.impressions = []; // [Required] URIs to track impressions.\n    this.creatives = []; // [Required] Creative elements\n    this.extensions = []; // [Optional] Any valid XML may be included in the Extensions node\n};\n\n/**\n* @class Impression\n* @ignore\n*/\n\n\nvar Impression = function Impression() {\n    _classCallCheck(this, Impression);\n\n    this.uri = ''; // [Required] URI to track Impression\n    this.id = ''; // [Optional] Identifier\n};\n\n/**\n* @class Extensions\n* @ignore\n*/\n\n\nvar Extensions = function Extensions() {\n    _classCallCheck(this, Extensions);\n\n    this.uri = ''; //\n    this.other = ''; //\n};\n\n/**\n* @class Creative\n* @ignore\n*/\n\n\nvar Creative = function Creative() {\n    _classCallCheck(this, Creative);\n\n    this.id = ''; // [Optional] Identifier\n    this.adId = ''; // [Optional] Ad-ID for the creative (formerly ISCI)\n    this.sequence = 0; // [Optional] The preferred order in which multiple Creatives should be displayed\n    this.linear = null; // [Optional] Linear ad\n    this.CompanionAds = []; // [Optional] Companion ads\n    this.nonLinearAds = []; // [Optional] Non-linear ads\n};\n\n// Creative types\n\n\nCreative.TYPE = {\n    LINEAR: 'linear',\n    NON_LINEAR_ADS: 'NonLinearAds',\n    COMPANION_ADS: 'CompanionAds'\n};\n\n/**\n* @class Linear\n* @ignore\n*/\n\nvar Linear = function Linear() {\n    _classCallCheck(this, Linear);\n\n    this.duration = 0; // [Required] Duration in standard time format, hh:mm:ss\n    this.trackingEvents = []; // [Optional] Tracking events elements\n    this.adParameters = ''; // [Optional] Data to be passed into the video ad\n    this.videoClicks = null; // [Optional] Video clicks\n    this.mediaFiles = []; // [Required] Media file elements\n};\n\n/**\n* @class Companion\n* @ignore\n*/\n\n\nvar Companion = function Companion() {\n    _classCallCheck(this, Companion);\n\n    this.id = ''; // optional : identifier\n    this.width = 0; // width pixel dimension of companion\n    this.height = 0; // height pixel dimension of companion\n    this.staticResource = null; // optional : pointer to the static resource : AdsPlayer.vast.model.Ad.StaticResource\n    this.iFrameResource = ''; // optional : URI source for an IFrame to display the companion element\n    this.hTMLResource = ''; // optional : HTML to display the companion element : shall be CDATA value\n    this.trackingEvents = []; // optional : pointer to any number of tracking objects : AdsPlayer.vast.model.Ad.CompanionTracking\n    this.clickThrough = ''; // optional : URI to open as destination page when user clicks on the companion\n    this.altText = ''; // optional : alt text to be displayed when companion is rendered in HTML environment.\n    this.adParameters = ''; // optional : data to be passed into the companion ads\n};\n\n//\n//      Non Linear Ads\n//\n\n/**\n* @class Companion\n* @ignore\n*/\n\n\nvar NonLinear = function NonLinear() {\n    _classCallCheck(this, NonLinear);\n\n    this.id = ''; // optional : identifier\n    this.width = 0; // width pixel dimension of non linear\n    this.height = 0; // height pixel dimension of non linear\n    this.expandedWidth = 0; // optional : pixel dimensions of expanding nonlinear ad when in expanded state\n    this.expandedHeight = 0; // optional : pixel dimensions of expanding nonlinear ad when in expanded state\n    this.scalable = true; // optional : whether it is acceptable to scale the image\n    this.maintainAspectRatio = true; // optional : whether the ad must have its aspect ratio maintained when scaled\n    this.apiFramework = ''; // optional : defines the method to use for communication with the nonlinear element\n    this.staticResource = null; // optional : pointer to the static resource : AdsPlayer.vast.model.Ad.StaticResource\n    this.hTMLResource = ''; // optional : HTML to display the companion element : shall be CDATA value\n    this.trackingEvents = []; // optional : pointer to any number of tracking objects : AdsPlayer.vast.model.Ad.Tracking\n    this.clickThrough = ''; // optional : URI to open as destination page when user clicks on the non-linear ad unit\n    this.adParameters = ''; // optional : data to be passed into the video ad\n};\n\n/**\n* @class TrackingEvent\n* @ignore\n*/\n\n\nvar TrackingEvent = function TrackingEvent() {\n    _classCallCheck(this, TrackingEvent);\n\n    this.uri = ''; // [Optional] URI to track various events during playback\n    this.event = ''; // [Required] The name of the event to track for the Linear element\n    this.offsetInSeconds = ''; // [Optional] Required in \"Progess\" event, not use with other events\n    this.offsetPercent = ''; // [Optional] Required in \"Progess\" event, not use with other events\n};\n\n/**\n* [TrackingEvent description]\n* @type {Object}\n*/\n\n\nTrackingEvent.TYPE = {\n    CREATIVEVIEW: 'creativeView',\n    START: 'start',\n    MIDPOINT: 'midpoint',\n    FIRSTQUARTILE: 'firstQuartile',\n    THIRDQUARTILE: 'thirdQuartile',\n    COMPLETE: 'complete',\n    MUTE: 'mute',\n    UNMUTE: 'unmute',\n    PAUSE: 'pause',\n    REWIND: 'rewind',\n    RESUME: 'resume',\n    FULLSCREEN: 'fullscreen',\n    EXPAND: 'expand',\n    COLLAPSE: 'collapse',\n    ACCEPTINVITATION: 'acceptInvitation',\n    CLOSE: 'close'\n};\n\n/**\n* @class VideoClicks\n* @ignore\n*/\n\nvar VideoClicks = function VideoClicks() {\n    _classCallCheck(this, VideoClicks);\n\n    this.clickThrough = ''; // [Optional] URI to open as destination page when user clicks on the video\n    this.clickTracking = ''; // [Optional] URI to request for tracking purposes when user clicks on the video\n    this.customClick = ''; // [Optional] URI to request on custom events such as hotspotted video\n};\n\n/**\n* @class MediaFile\n* @ignore\n*/\n\n\nvar MediaFile = function MediaFile() {\n    _classCallCheck(this, MediaFile);\n\n    this.id = ''; // [Optional] Identifier\n    this.delivery = ''; // [Required] Method of delivery of ad ('streaming' or 'progressive')\n    this.type = ''; // [Required] MIME type\n    this.bitrate = 0; // [Optional] Bitrate of encoded video in Kbps\n    this.width = 0; // [Required] Pixel dimensions of video\n    this.height = 0; // [Required] Pixel dimensions of video\n    this.scalable = true; // [Optional] Whether it is acceptable to scale the image.\n    this.maintainAspectRatio = true; // [Optional] Whether the ad must have its aspect ratio maintained when scaled\n    this.apiFramework = ''; // [Optional] Defines the method to use for communication if the MediaFile is interactive.\n    this.uri = '';\n};\n\n// MediaFile delivery types\n\n\nMediaFile.DELIVERY = {\n    STREAMING: 'streaming',\n    PROGRESSIVE: 'progressive '\n};\n\n/**\n* @class StaticResource\n* @ignore\n*/\n\nvar StaticResource = function StaticResource() {\n    _classCallCheck(this, StaticResource);\n\n    this.uRI = ''; // optional : URI to a static file, such as an image or SWF file\n    this.creativeType = ''; // mime type of static resource\n};\n\nvar vast = {};\n\nvast.Vast = Vast;\nvast.Ad = Ad;\nvast.InLine = InLine;\nvast.Impression = Impression;\nvast.Extensions = Extensions;\nvast.Creative = Creative;\nvast.Linear = Linear;\nvast.Companion = Companion;\nvast.NonLinear = NonLinear;\nvast.TrackingEvent = TrackingEvent;\nvast.VideoClicks = VideoClicks;\nvast.MediaFile = MediaFile;\nvast.StaticResource = StaticResource;\n\nexports.default = vast;\nexports.Vast = Vast;\nexports.Ad = Ad;\nexports.InLine = InLine;\nexports.Impression = Impression;\nexports.Extensions = Extensions;\nexports.Creative = Creative;\nexports.Linear = Linear;\nexports.Companion = Companion;\nexports.NonLinear = NonLinear;\nexports.TrackingEvent = TrackingEvent;\nexports.VideoClicks = VideoClicks;\nexports.MediaFile = MediaFile;\nexports.StaticResource = StaticResource;\n\n},{}]},{},[1])\n\n","\nimport AdsPlayer from './src/AdsPlayer';\n\n// Shove both of these into the global scope\nvar context = (typeof window !== 'undefined' && window) || global;\n\nvar adsplayer = context.adsplayer;\nif (!adsplayer) {\n    adsplayer = context.adsplayer = {};\n}\n\nadsplayer.AdsPlayer = AdsPlayer;\n\nexport default adsplayer;\nexport { AdsPlayer };\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* AdsPlayer.\n* @constructor AdsPlayer\n* @param {Object} adsPlayerContainer - the DOM container in which &lt;video&gt; and &lt;img&gt; HTML components will be appended\n*/\n\nimport AdsPlayerController from './AdsPlayerController';\nimport EventBus from './EventBus';\n\nconst NAME = 'AdsPlayer';\nconst VERSION = '';\nconst GIT_TAG = '@@REVISION';\nconst BUILD_DATE = '@@TIMESTAMP';\n\n///////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\nfunction _onError (e) {\n    this._error = e.data;\n}\n\nfunction _onWarning (e) {\n    this._warning = e.data;\n}\n\nclass AdsPlayer {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor (adsPlayerContainer) {\n\n        this._adsPlayerContainer = adsPlayerContainer;\n        this._error = null;\n        this._warning = null;\n        this._eventBus = EventBus.getInstance();\n        this._adsPlayerController = null;\n\n        this.onErrorListener = _onError.bind(this);\n        this.onWarningListener = _onWarning.bind(this);\n    }\n\n    // Plugin API\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * Returns the plugin name.\n    * @method getName\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {string} the plugin name\n    */\n    getName () {\n        return NAME;\n    }\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * Initializes the plugin.\n    * @method init\n    * @access public\n    * @memberof AdsPlayer#\n    * @param {Object} player - the MediaPlayer\n    * @param {function} callback - the callback function to invoke when initialization is done\n    */\n    init (player, callback) {\n        this._adsPlayerController = new AdsPlayerController();\n        this._adsPlayerController.init(player, this._adsPlayerContainer);\n        this._eventBus.addEventListener('error', this.onErrorListener);\n        this._eventBus.addEventListener('warning', this.onWarningListener);\n\n        callback();\n    }\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * This method is invoked when a new stream is to be loaded/opened.\n    * @method load\n    * @access public\n    * @memberof AdsPlayer#\n    * @param {object} stream - the stream contaning all stream informations (url, protData, adsUrl)\n    */\n    load (stream, callback) {\n        if (stream.adsUrl) {\n            this._adsPlayerController.load(stream.adsUrl).then(function () {\n                callback();\n            }).catch(function () {\n                callback();\n            });\n        } else {\n            callback();\n        }\n    }\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * This method is invoked when the current stream is to be stopped.\n    * @method stop\n    * @access public\n    * @memberof AdsPlayer#\n    */\n    stop () {\n        this._adsPlayerController.stop();\n    }\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * This method is invoked when the player is to be reset.\n    * @method reset\n    * @access public\n    * @memberof AdsPlayer#\n    */\n    reset () {\n        this._adsPlayerController.reset();\n    }\n\n    /**\n    * [Plugin API, invoked by hasplayer.js]\n    * This method is invoked when this plugin is being removed/destroyed.\n    * @method destroy\n    * @access public\n    * @memberof AdsPlayer#\n    */\n    destroy () {\n        this._adsPlayerController.destroy();\n        this._eventBus.removeEventListener('error', this.onErrorListener);\n        this._eventBus.removeEventListener('warning', this.onWarningListener);\n    }\n\n    // AdsPlayer additionnal API\n\n    /**\n    * Returns the plugin version.\n    * @method getVersion\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {string} the plugin version\n    */\n    getVersion () {\n        return VERSION;\n    }\n\n    /**\n    * Returns the full plugin version, including git revision\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {string} the full plugin version, including git revision\n    */\n    getVersionFull  () {\n        if (GIT_TAG.indexOf(\"@@\") === -1) {\n            return VERSION + '_' + GIT_TAG;\n        } else {\n            return VERSION;\n        }\n    }\n\n    /**\n    * Returns the build date.\n    * @method getBuildDate\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {string} the build date\n    */\n    getBuildDate () {\n        if (BUILD_DATE.indexOf(\"@@\") === -1) {\n            return BUILD_DATE;\n        } else {\n            return 'Not a builded version';\n        }\n    }\n\n    /**\n    * Plays/resumes the playback of the current ad.\n    * @method play\n    * @access public\n    * @memberof AdsPlayer#\n    */\n    play () {\n        this._adsPlayerController.play();\n    }\n\n    /**\n    * Pauses the playback of the current ad.\n    * @method pause\n    * @access public\n    * @memberof AdsPlayer#\n    */\n    pause () {\n        this._adsPlayerController.pause();\n    }\n\n    /**\n    * Registers a listener on the specified event.\n    * The possible event types are:\n    * <li>'error' (see [error]{@link AdsPlayer#event:error} event specification)\n    * <li>'warning' (see [warning]{@link AdsPlayer#event:warning} event specification)\n    * <li>'start' (see [start]{@link AdsPlayer#event:start} event specification)\n    * <li>'end' (see [end]{@link AdsPlayer#event:end} event specification)\n    * <li>'click' (see [click]{@link AdsPlayer#event:click} event specification)\n    * @method addEventListener\n    * @access public\n    * @memberof AdsPlayer#\n    * @param {string} type - the event type for listen to\n    * @param {callback} listener - the callback which is called when an event of the specified type occurs\n    * @param {boolean} useCapture - see HTML DOM addEventListener() method specification\n    */\n    addEventListener (type, listener, useCapture) {\n        this._eventBus.addEventListener(type, listener, useCapture);\n    }\n\n    /**\n    * Unregisters the listener previously registered with the addEventListener() method.\n    * @method removeEventListener\n    * @access public\n    * @memberof AdsPlayer#\n    * @see [addEventListener]{@link AdsPlayer#addEventListener}\n    * @param {string} type - the event type on which the listener was registered\n    * @param {callback} listener - the callback which was registered to the event type\n    */\n    removeEventListener (type, listener) {\n        this._eventBus.removeEventListener(type, listener);\n    }\n\n    /**\n    * Returns the Error object for the most recent error.\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {object} the Error object for the most recent error, or null if there has not been an error\n    */\n    getError () {\n        return this._error;\n    }\n\n    /**\n    * Returns the Warning object for the most recent warning.\n    * @access public\n    * @memberof AdsPlayer#\n    * @return {object} the Warning object for the most recent warning, or null if there has not been a warning\n    */\n    getWarning () {\n        return this._warning;\n    }\n}\n\n// /**\n//  * @class\n//  * @classdesc AdsPlayer\n//  */\n// AdsPlayer.prototype = {\n//     constructor: AdsPlayer\n// };\n\n// AdsPlayer.mast = {};\n// AdsPlayer.mast.model = {};\n// AdsPlayer.mast.model.Trigger = {};\n// AdsPlayer.mast.model.Trigger.Condition = {};\n// AdsPlayer.vast = {};\n// AdsPlayer.vast.model = {};\n// AdsPlayer.vast.model.Vast = {};\n// AdsPlayer.media = {};\n// AdsPlayer.utils = {};\n\n\n\n/////////// EVENTS\n\n/**\n* The 'start' event is fired when the playback of ad(s) is starting.\n* When the 'start' event is fired, the application shall hide the main player component and\n* display the ads player container in which the ad media player component(s) will be created\n* and displayed.\n*\n* @event AdsPlayer#start\n* @param {object} event - the event\n* @param {object} event.type - the event type ('start')\n*/\n\n/**\n* The 'end' event is fired when the playback of ad(s) has ended.\n* When the 'end' event is fired, the application shall display the main player component and\n* hide the ads player container.\n*\n* @event AdsPlayer#end\n* @param {object} event - the event\n* @param {object} event.type - the event type ('end')\n*/\n\n/**\n* The 'addElement' event is fired when a DOM element for playing an ad has been created\n* and will be appended in the ads player container.\n* The element can be either a &lt;video&gt; or an &lt;img&gt; element.\n*\n* @event AdsPlayer#addElement\n* @param {object} event - the event\n* @param {object} event.type - the event type ('addElement')\n* @param {object} event.data - the event data\n* @param {string} event.data.element - the created element\n* @param {string} event.data.type - the type of the element, 'video' for &lt;video&gt; or 'image' for &lt;img&gt;\n*/\n\n/**\n* The 'removeElement' event is fired when the DOM element for playing an ad is being removed\n* from the ads player container and deleted.\n*\n* @event AdsPlayer#removeElement\n* @param {object} event - the event\n* @param {object} event.type - the event type ('removeElement')\n* @param {object} event.data - the event data\n* @param {string} event.data.element - the created element\n* @param {string} event.data.type - the type of the element, 'video' for &lt;video&gt; or 'image' for &lt;img&gt;\n*/\n\n/**\n* The 'play' event is fired when the playback of media ad is starting.\n*\n* @event AdsPlayer#play\n* @param {object} event - the event\n* @param {object} event.type - the event type ('play')\n*/\n\n/**\n* The 'pause' event is fired when the playback of an ad is paused.\n*\n* @event AdsPlayer#pause\n* @param {object} event - the event\n* @param {object} event.type - the event type ('pause')\n*/\n\n/**\n* The 'click' event is fired when a click has been performed on the ad component.\n* When the 'click' event is fired, the application shall open the web page with the provided URI.\n*\n* @event AdsPlayer#click\n* @param {object} event - the event\n* @param {object} event.type - the event type ('click')\n* @param {object} event.data - the event data\n* @param {string} event.data.uri - the web page uri\n*/\n\n/**\n* The error event is fired when an error occurs.\n* When the error event is fired, the application shall stop the player.\n*\n* @event AdsPlayer#error\n* @param {object} event - the event\n* @param {object} event.type - the event type ('error')\n* @param {object} event.data - the event data\n* @param {string} event.data.code - error code\n* @param {string} event.data.message - error message\n* @param {object} event.data.data - error additionnal data\n*/\n\n/**\n* The warning event is fired when a warning occurs.\n*\n* @event AdsPlayer#warning\n* @param {object} event - the event\n* @param {object} event.type - the event type ('warning')\n* @param {object} event.data - the event data\n* @param {string} event.data.code - warning code\n* @param {string} event.data.message - warning message\n* @param {object} event.data.data - warning additionnal data\n*/\n\nexport default AdsPlayer;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* AdsPlayerController is th main controller class for AdsPlayer module.\n* It is in charge of downloading the MAST/VAST files and orchestrates the\n* detection of triggers and playing of ad(s).\n*/\n\nimport Debug from './Debug';\nimport FileLoader from './FileLoader';\nimport ErrorHandler from './ErrorHandler';\nimport EventBus from './EventBus';\nimport MastParser from './mast/MastParser';\nimport TriggerManager from './mast/TriggerManager';\nimport VastParser from './vast/VastParser';\nimport VastPlayerManager from './vast/VastPlayerManager';\nimport utils from './utils/utils';\n\n\nclass AdsPlayerController {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _loadVast (url) {\n        var fileLoader = new FileLoader(),\n            vast = null;\n\n        return new Promise((resolve/*, reject*/) => {\n            this._debug.log(\"Download VAST file: \" + url);\n            fileLoader.load(url).then(result => {\n                    this._debug.log(\"Parse VAST file\");\n                    vast = this._vastParser.parse(result.response);\n                    vast.baseUrl = result.baseUrl;\n                    resolve(vast);\n                }).catch(error => {\n                    if (error) {\n                        this._errorHandler.sendWarning(ErrorHandler.LOAD_VAST_FAILED, \"Failed to load VAST file\", error);\n                    }\n                    resolve(null);\n                }\n            );\n            this._fileLoaders.push(fileLoader);\n        });\n    }\n\n    _loadTriggerVasts (trigger) {\n        var loadVastPromises = [],\n            i,\n            uri;\n\n        for (i = 0; i < trigger.sources.length; i++) {\n            uri = trigger.sources[i].uri;\n            // Check for relative uri path and add base url if needed\n            uri = utils.isAbsoluteURI(uri) ? uri : (this._mast.baseUrl + uri);\n            loadVastPromises.push(this._loadVast(uri));\n        }\n\n        return new Promise((resolve, reject) => {\n            Promise.all(loadVastPromises).then(vasts => {\n                // Push vast objects in the trigger in the original order\n                // (this = promises returned objects)\n                for (var i = 0; i < vasts.length; i++) {\n                    if (vasts[i] && vasts[i].ads && vasts[i].ads.length > 0) {\n                        trigger.vasts.push(vasts[i]);\n                    }\n                }\n                resolve();\n            }).catch(() => {\n                reject();\n            });\n        });\n    }\n\n    _parseMastFile (mastContent, mastBaseUrl) {\n        var triggerManager,\n            i;\n\n        // Parse the MAST file\n        this._mast = this._mastParser.parse(mastContent);\n\n        if (!this._mast) {\n            return;\n        }\n\n        // Store base URL for subsequent VATS files download\n        this._mast.baseUrl = mastBaseUrl;\n\n        // Initialize the trigger managers\n        for (i = 0; i < this._mast.triggers.length; i++) {\n            triggerManager = new TriggerManager();\n            triggerManager.init(this._mast.triggers[i]);\n            this._triggerManagers.push(triggerManager);\n        }\n    }\n\n    _onVideoPlaying () {\n        if (this._vastPlayerManager) {\n            this._debug.log(\"Pause main video\");\n            this._mainVideo.pause();\n        }\n    }\n\n    _onVideoTimeupdate () {\n        // Check for mid-roll triggers\n        var trigger = this._checkTriggersStart();\n        if (trigger !== null) {\n            this._activateTrigger(trigger, true);\n        }\n    }\n\n    _onVideoEnded () {\n        // Check for end-roll triggers\n        var trigger = this._checkTriggersStart();\n        if (trigger !== null) {\n            this._activateTrigger(trigger, true);\n        }\n\n        this._checkTriggersEnd();\n    }\n\n    _pauseVideo () {\n        if (!this._mainVideo.paused) {\n            this._debug.log(\"Pause main video\");\n            this._mainVideo.pause();\n        }\n    }\n\n    _resumeVideo () {\n        if (this._mainVideo.paused) {\n            this._debug.log(\"Resume main video\");\n            this._mainVideo.play();\n        }\n    }\n\n    _onTriggerEnd () {\n        this._debug.log('End playing trigger');\n\n        // Delete VAST player manager\n        if (this._vastPlayerManager) {\n            this._vastPlayerManager = null;\n        }\n\n        // Check if another trigger has to be activated\n        var trigger = this._checkTriggersStart();\n        if (trigger !== null) {\n            this._activateTrigger(trigger, false);\n        } else {\n            // Notifies the application ad(s) playback has ended\n            this._eventBus.dispatchEvent({type: 'end', data: null});\n\n            if (!this._mainVideo.ended) {\n                // Resume the main video element\n                this._resumeVideo();\n            }\n        }\n    }\n\n    _playTrigger (trigger) {\n        if (trigger.vasts.length === 0) {\n            return;\n        }\n\n        // Pause the main video element\n        this._pauseVideo();\n\n        // Play the trigger\n        this._debug.log('Start playing trigger ' + trigger.id);\n        this._vastPlayerManager = new VastPlayerManager();\n        this._vastPlayerManager.init(trigger.vasts, this._adsPlayerContainer, this._mainVideo);\n        this._vastPlayerManager.start();\n    }\n\n    _activateTrigger (trigger, firstTrigger) {\n\n        // Check if a trigger is not already activated\n        if (this._vastPlayerManager) {\n            return;\n        }\n\n        if (firstTrigger) {\n            // Notifies the application ad(s) playback starts\n            this._eventBus.dispatchEvent({type: 'start', data: null});\n        }\n\n        this._debug.log('Activate trigger ' + trigger.id);\n\n        trigger.activated = true;\n\n        if (trigger.vasts.length === 0) {\n            // Download VAST files\n            this._loadTriggerVasts(trigger).then(() => {\n                this._playTrigger(trigger);\n            });\n        } else {\n            this._playTrigger(trigger);\n        }\n    }\n\n    _checkTriggersStart () {\n        for (var i = 0; i < this._triggerManagers.length; i++) {\n            if (this._triggerManagers[i].checkStartConditions(this._mainVideo)) {\n                return this._triggerManagers[i].getTrigger();\n            }\n        }\n        return null;\n    }\n\n    _checkTriggersEnd () {\n        for (var i = 0; i < this._triggerManagers.length; i++) {\n            if (this._triggerManagers[i].checkEndConditions(this._mainVideo)) {\n                // Remove trigger manager => will not be activated anymore\n                this._triggerManagers.splice(0, 1);\n                i--;\n            }\n        }\n    }\n\n    _start () {\n        if (!this._mast) {\n            return;\n        }\n\n        if (this._mast.triggers.length === 0) {\n            this._debug.warn('No trigger in MAST');\n        }\n\n        // Check for pre-roll trigger\n        var trigger = this._checkTriggersStart();\n        if (trigger !== null) {\n            this._activateTrigger(trigger, true);\n        }\n\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor () {\n\n        this._mainPlayer = null;\n        this._mainVideo = null;\n        this._adsPlayerContainer = null;\n        this._mast = null;\n        this._fileLoaders = [];\n        this._triggerManagers = [];\n        this._vastPlayerManager = null;\n        this._mastParser = new MastParser();\n        this._vastParser = new VastParser();\n        this._errorHandler = ErrorHandler.getInstance();\n        this._debug = Debug.getInstance();\n        this._eventBus = EventBus.getInstance();\n\n        this._onVideoPlayingListener = this._onVideoPlaying.bind(this);\n        this._onVideoTimeupdateListener = this._onVideoTimeupdate.bind(this);\n        this._onVideoEndedListener = this._onVideoEnded.bind(this);\n        this._onTriggerEndListener = this._onTriggerEnd.bind(this);\n    }\n\n    /**\n     * Initialize the Ads Player Controller.\n     * @method init\n     * @access public\n     * @memberof AdsPlayerController#\n     * @param {Object} mainVideo - the HTML5 video element used by the main media player\n     * @param {Object} adsPlayerContainer - The container to create the HTML5 video/image elements used to play and render the ads media\n     */\n    init (player, adsPlayerContainer) {\n        this._mainPlayer = player;\n        this._mainVideo = player.getVideoModel().getElement();\n        this._adsPlayerContainer = adsPlayerContainer;\n\n        // Add <video> event listener\n        this._mainVideo.addEventListener('playing', this._onVideoPlayingListener);\n        this._mainVideo.addEventListener('timeupdate', this._onVideoTimeupdateListener);\n        this._mainVideo.addEventListener('seeking', this._onVideoTimeupdateListener);\n        this._mainVideo.addEventListener('ended', this._onVideoEndedListener);\n\n        // Add trigger end event listener\n        this._eventBus.addEventListener('triggerEnd', this._onTriggerEndListener);\n\n        this._debug.setLevel(4);\n    }\n\n\n    /**\n     * Load/open a MAST file.\n     * @method load\n     * @access public\n     * @memberof AdsPlayerController#\n     * @param {string} mastUrl - the MAST file url\n     */\n    load (url) {\n        let fileLoader = new FileLoader();\n\n        // Reset the MAST and trigger managers\n        this._mast = null;\n        this._triggerManagers = [];\n\n        // Download and parse MAST file\n        this._debug.log(\"Download MAST file: \" + url);\n\n        return new Promise((resolve, reject) => {\n            fileLoader.load(url).then(result => {\n                this._debug.log(\"Parse MAST file\");\n                this._parseMastFile(result.response, result.baseUrl);\n                // Start managing triggers and ads playing\n                this._debug.log(\"Start\");\n                this._start();\n                resolve();\n            }).catch(error => {\n                if (error) {\n                    this._errorHandler.sendError(error.name, error.message, error.data);\n                    reject(error);\n                } else {\n                    resolve();\n                }\n            });\n            this._fileLoaders.push(fileLoader);\n        });\n    }\n\n    /**\n     * Stops and resets the Ads player.\n     * @method reset\n     * @access public\n     * @memberof AdsPlayerController#\n     */\n    stop () {\n\n        this._debug.log(\"Stop\");\n\n        // Stop/abort the file loaders\n        for (var i = 0; i < this._fileLoaders.length; i++) {\n            this._fileLoaders[i].abort();\n        }\n        this._fileLoaders = [];\n\n        // Stop the VAST player manager\n        if (this._vastPlayerManager) {\n            this._vastPlayerManager.stop();\n            this._vastPlayerManager = null;\n\n            // Notifies the application ad(s) playback has ended\n            this._eventBus.dispatchEvent({type: 'end', data: null});\n        }\n    }\n\n    reset () {\n\n        this._debug.log(\"Reset\");\n\n        this.stop();\n\n        // Reset the trigger managers\n        this._triggerManagers = [];\n\n        // Reset the MAST\n        this._mast = null;\n    }\n\n    destroy () {\n\n        this._debug.log(\"Destroy\");\n\n        this.reset();\n\n        // Remove <video> event listener\n        this._mainVideo.removeEventListener('playing', this._onVideoPlayingListener);\n        this._mainVideo.removeEventListener('timeupdate', this._onVideoTimeupdateListener);\n        this._mainVideo.removeEventListener('seeking', this._onVideoTimeupdateListener);\n        this._mainVideo.removeEventListener('ended', this._onVideoEndedListener);\n\n        // Remove trigger end event listener\n        this._eventBus.removeEventListener('triggerEnd', this._onTriggerEndListener);\n    }\n\n    /**\n     * Plays/resumes the playback of the current ad.\n     * @method reset\n     * @access public\n     * @memberof AdsPlayerController#\n     */\n    play () {\n\n        this._debug.log(\"Play\");\n        // Start the VAST player manager\n        if (this._vastPlayerManager) {\n            this._vastPlayerManager.play();\n        }\n    }\n\n    /**\n     * Pauses the playback of the current ad.\n     * @method reset\n     * @access public\n     * @memberof AdsPlayerController#\n     */\n    pause () {\n\n        this._debug.log(\"Pause\");\n        // Pause the VAST player manager\n        if (this._vastPlayerManager) {\n            this._vastPlayerManager.pause();\n        }\n    }\n}\n\nexport default AdsPlayerController;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* Debug utility class.\n*/\nDate.prototype.HHMMSSmmm = function() {\n\n    var h = this.getHours().toString(),\n        m = this.getMinutes().toString(),\n        s = this.getSeconds().toString(),\n        ms = this.getMilliseconds().toString(),\n        HH = h[1] ? h : \"0\" + h[0],\n        MM = m[1] ? m : \"0\" + m[0],\n        SS = s[1] ? s : \"0\" + s[0],\n        mmm = ms[2] ? ms : \"0\" + (ms[1] ? ms : \"0\" + ms[0]);\n\n    return HH + \":\" + MM + \":\" + SS + \".\" + mmm;\n};\n\nDate.prototype.MMSSmmm = function() {\n\n    var m = this.getMinutes().toString(),\n        s = this.getSeconds().toString(),\n        ms = this.getMilliseconds().toString(),\n        MM = m[1] ? m : \"0\" + m[0],\n        SS = s[1] ? s : \"0\" + s[0],\n        mmm = ms[2] ? ms : \"0\" + (ms[1] ? ms : \"0\" + ms[0]);\n\n    return MM + \":\" + SS + \".\" + mmm;\n};\n\n// MemoryLogger definition\n\nvar MemoryLogger = function() {\n    // array to store logs\n    this.logArray = [];\n    // boolean to set leve in message\n    this.showLevel = true;\n};\n\nMemoryLogger.prototype.error =\n    MemoryLogger.prototype.warn =\n    MemoryLogger.prototype.info =\n    MemoryLogger.prototype.debug = function(message) {\n        this.logArray.push(message);\n};\n\nMemoryLogger.prototype.getLogs = function() {\n    return this.logArray;\n};\n\n\nconst NONE = 0;\nconst ERROR = 1;\nconst WARN = 2;\nconst INFO = 3;\nconst DEBUG = 4;\nconst ALL = 4;\n\n\nlet _instance = null;\n\nclass Debug {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _getStringLevel(level) {\n        switch (level) {\n            case NONE:\n                return \"\";\n            case ERROR:\n                return \"ERROR\";\n            case WARN:\n                return \"WARN\";\n            case INFO:\n                return \"INFO\";\n            case DEBUG:\n            case ALL:\n                return \"DEBUG\";\n            default:\n                return \"\";\n        }\n    }\n\n    _prepareLog(logLevel, args) {\n        let message = \"\",\n            logTime = null;\n\n        if (this._showTimestamp) {\n            logTime = new Date();\n            message += \"[\" + logTime.HHMMSSmmm() + \"]\";\n        }\n\n        if (this._logger && this._logger.showLevel) {\n            message += \"[\" + this._getStringLevel(logLevel) + \"]\";\n        }\n\n        if (this._showElapsedTime) {\n            message += \"[\" + new Date(logTime - this._startTime).MMSSmmm() + \"]\";\n        }\n\n        message += \"[AdsPlayer] \";\n\n        Array.apply(null, args).forEach(function(item) {\n            message += item + \" \";\n        });\n\n        return message;\n    }\n\n    _log (logLevel, args) {\n        if (logLevel <= this.getLevel()) {\n\n            let message = this._prepareLog(logLevel, args);\n\n            switch (logLevel) {\n                case ERROR:\n                    this._logger.error(message);\n                    break;\n                case WARN:\n                    this._logger.warn(message);\n                    break;\n                case INFO:\n                    this._logger.info(message);\n                    break;\n                case DEBUG:\n                    this._logger.debug(message);\n                    break;\n            }\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    static getInstance() {\n        if (_instance === null) {\n            _instance = new Debug();\n        }\n\n        return _instance;\n    }\n\n    constructor() {\n\n        if (_instance !== null) {\n            return _instance;\n        }\n\n        this._level = 4;\n        this._showTimestamp = true;\n        this._showElapsedTime = false;\n        this._startTime = new Date();\n        this._logger = console;\n\n        _instance = this;\n        return _instance;\n    }\n\n    getLevel () {\n        return this._level;\n    }\n\n    setLevel (value) {\n        this._level = value;\n    }\n\n    getLogger () {\n        return this._logger;\n    }\n\n    setLogger (type) {\n        switch (type) {\n            case 'memory':\n                this._logger = new MemoryLogger();\n                break;\n\n            case 'console':\n                this._logger = console;\n                break;\n\n            default:\n                this._logger = null;\n        }\n    }\n\n    error() {\n        this._log(ERROR, arguments);\n    }\n\n    warn () {\n        this._log(WARN, arguments);\n    }\n\n    info () {\n        this._log(INFO, arguments);\n    }\n\n    // Keep this function for compatibility\n    log () {\n        this._log(DEBUG, arguments);\n    }\n}\n\nexport default Debug;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* Errors and warning notifications handler.\n*/\n\nimport Debug from './Debug';\nimport EventBus from './EventBus';\n\nlet _instance = null;\n\n\nclass ErrorHandler {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    static getInstance() {\n        if (_instance === null) {\n            _instance = new ErrorHandler();\n        }\n\n        return _instance;\n    }\n\n    constructor() {\n\n        if (_instance !== null) {\n            return _instance;\n        }\n\n        this._eventBus = EventBus.getInstance();\n        this._debug = Debug.getInstance();\n\n        _instance = this;\n        return _instance;\n    }\n\n    /**\n     * [sendWarning description]\n     * @param  {[type]} code    [description]\n     * @param  {[type]} message [description]\n     * @param  {[type]} data    [description]\n     * @return {[type]}         [description]\n     */\n    sendWarning (code, message, data) {\n        this._eventBus.dispatchEvent({\n            type: 'warning',\n            data: {\n                code: code,\n                message: message,\n                data: data\n            }\n        });\n        this._debug.warn(\"[Warn] Code: \" + code + \", Message: \" + message + \", Data: \" + JSON.stringify(data, null, '\\t'));\n    }\n\n    /**\n     * [sendError description]\n     * @param  {[type]} code    [description]\n     * @param  {[type]} message [description]\n     * @param  {[type]} data    [description]\n     * @return {[type]}         [description]\n     */\n    sendError (code, message, data) {\n        this._eventBus.dispatchEvent({\n            type: 'error',\n            data: {\n                code: code,\n                message: message,\n                data: data\n            }\n        });\n        this._debug.error(\"[Error] Code: \" + code + \", Message: \" + message + \", Data: \" + JSON.stringify(data, null, '\\t'));\n    }\n}\n\n// File Loader errors\nErrorHandler.DOWNLOAD_ERR_FILES = \"DOWNLOAD_ERR_FILES\";\nErrorHandler.DOWNLOAD_ERR_NOT_XML = \"DOWNLOAD_ERR_NOT_XML\";\n\nErrorHandler.LOAD_VAST_FAILED = \"LOAD_VAST_FAILED\";\n\n// Media Player errors\nErrorHandler.NO_VALID_MEDIA_FOUND = \"NO_VALID_MEDIA_FOUND\";\nErrorHandler.LOAD_MEDIA_FAILED = \"LOAD_MEDIA_FAILED\";\nErrorHandler.UNSUPPORTED_MEDIA_FILE = \"UNSUPPORTED_MEDIA_FILE\";\nErrorHandler.UNAVAILABLE_LINK = \"UNAVAILABLE_LINK\";\n\nexport default ErrorHandler;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* Event bus utility class for events listening and notifying.\n*/\n\nimport Debug from './Debug';\n\nlet _instance = null;\n\nclass EventBus {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n\n    _getListeners (type, useCapture) {\n        if (useCapture === undefined) { // to provide a default parameter that works !!\n            useCapture = false;\n        }\n        var captype = (useCapture ? '1' : '0') + type;\n\n        if (!(captype in this._registrations)) {\n            this._registrations[captype] = [];\n        }\n\n        return this._registrations[captype];\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    static getInstance() {\n        if (_instance === null) {\n            _instance = new EventBus();\n        }\n\n        return _instance;\n    }\n\n    constructor() {\n\n        if (_instance !== null) {\n            return _instance;\n        }\n\n        this._registrations = {};\n        this._debug = Debug.getInstance();\n\n        _instance = this;\n        return _instance;\n    }\n\n    /**\n     * [addEventListener description]\n     * @param {[type]} type       [description]\n     * @param {[type]} listener   [description]\n     * @param {[type]} useCapture [description]\n     */\n    addEventListener (type, listener, useCapture) {\n        var listeners = this._getListeners(type, useCapture),\n            idx = listeners.indexOf(listener);\n\n        if (idx === -1) {\n            listeners.push(listener);\n        }\n    }\n\n    /**\n     * [removeEventListener description]\n     * @param  {[type]} type       [description]\n     * @param  {[type]} listener   [description]\n     * @param  {[type]} useCapture [description]\n     * @return {[type]}            [description]\n     */\n    removeEventListener (type, listener, useCapture) {\n        var listeners = this._getListeners(type, useCapture),\n            idx = listeners.indexOf(listener);\n\n        if (idx !== -1) {\n            listeners.splice(idx, 1);\n        }\n    }\n\n    /**\n     * [dispatchEvent description]\n     * @param  {[type]} evt [description]\n     * @return {[type]}     [description]\n     */\n    dispatchEvent (evt) {\n        var listeners = this._getListeners(evt.type, false).slice(),\n            i = 0;\n\n        for (i = 0; i < listeners.length; i += 1) {\n            listeners[i].call(this, evt);\n        }\n        return !evt.defaultPrevented;\n    }\n}\n\nexport default EventBus;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* File downloader utility class.\n*/\n\nimport ErrorHandler from './ErrorHandler';\n\nclass FileLoader {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _parseBaseUrl (url) {\n        var base = null;\n\n        if (url.indexOf(\"/\") !== -1) {\n            if (url.indexOf(\"?\") !== -1) {\n                url = url.substring(0, url.indexOf(\"?\"));\n            }\n            base = url.substring(0, url.lastIndexOf(\"/\") + 1);\n        }\n\n        return base;\n    }\n\n    _parseXml (data) {\n\n        if (!window.DOMParser) {\n            return null;\n        }\n\n        try {\n            let parser = new window.DOMParser();\n\n            let xmlDoc = parser.parseFromString(data, \"text/xml\");\n            if (xmlDoc.getElementsByTagName('parsererror').length > 0) {\n                throw new Error('Error parsing XML');\n            }\n            return xmlDoc;\n        } catch (e) {\n            return null;\n        }\n    }\n\n    _abort () {\n        if (this._request !== null && this._request.readyState > 0 && this._request.readyState < 4) {\n            this._request.abort();\n        }\n    }\n\n    _load (url, resolve, reject) {\n        let baseUrl = this._parseBaseUrl(url),\n            needFailureReport = true,\n            onload = null,\n            report = null,\n            onabort = null,\n            self = this;\n\n        onabort = function() {\n            this.aborted = true;\n        };\n\n        onload = function() {\n            if (this.status < 200 || this.status > 299) {\n                return;\n            }\n\n            if (this.status === 200 && this.readyState === 4) {\n\n                // Parse responseText in case of wrong response Content-Type\n                let xmlDoc = this.responseXML || self._parseXml(this.responseText);\n\n                // Check if response is in XML format.\n                if (xmlDoc === null) {\n                    needFailureReport = true;\n                    return;\n                }\n\n                // Get the redirection URL and use it as base URL\n                if (this.responseURL) {\n                    baseUrl = self._parseBaseUrl(this.responseURL);\n                }\n\n                needFailureReport = false;\n\n                // Return XML DOM (as input to parsers)\n                resolve({\n                    response: xmlDoc,\n                    baseUrl: baseUrl\n                });\n\n            }\n        };\n\n        report = function() {\n            if (!needFailureReport) {\n                return;\n            }\n            needFailureReport = false;\n\n            if (this.aborted) {\n                // Request has been aborted => reject without error\n                reject();\n            } else if (this.status < 200 || this.status > 299) {\n                // Request has failed => reject with error\n                reject({\n                    name: ErrorHandler.DOWNLOAD_ERR_FILES,\n                    message: \"Failed to download file\",\n                    data: {\n                        url: url,\n                        status: this.status\n                    }\n                });\n            } else if (this.responseXML === null) {\n                // Response was not in XML format => reject with error\n                reject({\n                    name: ErrorHandler.DOWNLOAD_ERR_NOT_XML,\n                    message: \"The downloaded file format is not in xml format\",\n                    data: {\n                        url: url\n                    }\n                });\n            }\n        };\n\n        try {\n            this._request = new XMLHttpRequest();\n            this._request.onload = onload;\n            this._request.onloadend = report;\n            this._request.onerror = report;\n            this._request.onabort = onabort;\n            this._request.open(\"GET\", url, true);\n            this._request.timeout = 10000;\n            this._request.send();\n        } catch (e) {\n            this._request.onerror();\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n        this._request = null;\n    }\n\n    load (url) {\n        return new Promise((resolve, reject) => {\n            this._load(url, resolve, reject);\n        });\n    }\n\n    abort () {\n        if (this._request !== null &&\n            this._request.readyState > 0 &&\n            this._request.readyState < 4) {\n            this._request.abort();\n        }\n    }\n}\n\nexport default FileLoader;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* MAST parser. This class parses MAST file in XML format\n* and construct the corresponding MAST object according to MAST data model.\n*/\n\nimport mast from './model/Mast';\nimport xmldom from '../utils/xmldom';\n\nclass MastParser {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _getCondition (conditionNode) {\n        let condition = new mast.Condition(),\n            conditionNodes;\n\n        condition.type = conditionNode.getAttribute('type');\n        condition.name = conditionNode.getAttribute('name');\n        condition.value = conditionNode.getAttribute('value');\n        condition.operator = conditionNode.getAttribute('operator');\n        conditionNodes = conditionNode.getElementsByTagName('condition');\n        for (let i = 0; i < conditionNodes.length; i++) {\n            condition.conditions.push(this._getCondition(conditionNodes[i]));\n        }\n\n        return condition;\n    }\n\n    _getSource (sourceNode) {\n        let source = new mast.Source(),\n            sourceNodes;\n\n        source.uri = sourceNode.getAttribute('uri');\n        source.altReference = sourceNode.getAttribute('altReference');\n        source.format = sourceNode.getAttribute('format');\n        sourceNodes = sourceNode.getElementsByTagName('source');\n        for (let i = 0; i < sourceNodes.length; i++) {\n            source.sources.push(this._getSource(sourceNodes[i]));\n        }\n\n        return source;\n    }\n\n    _getTrigger (triggerNode) {\n        let trigger = new mast.Trigger(),\n            startConditionNodes = xmldom.getSubElements(triggerNode, 'startConditions', 'condition'),\n            endConditionNodes = xmldom.getSubElements(triggerNode, 'endConditions', 'condition'),\n            sourceNodes = xmldom.getSubElements(triggerNode, 'sources', 'source'),\n            i;\n\n        trigger.id = triggerNode.getAttribute('id');\n        trigger.description = triggerNode.getAttribute('description');\n\n        for (i = 0; i < startConditionNodes.length; i++) {\n            trigger.startConditions.push(this._getCondition(startConditionNodes[i]));\n        }\n\n        for (i = 0; i < endConditionNodes.length; i++) {\n            trigger.endConditions.push(this._getCondition(endConditionNodes[i]));\n        }\n\n        for (i = 0; i < sourceNodes.length; i++) {\n            trigger.sources.push(this._getSource(sourceNodes[i]));\n        }\n\n        return trigger;\n    }\n\n    _getTriggers (mastNode, mast) {\n        let triggerNodes = xmldom.getSubElements(mastNode, 'triggers', 'trigger');\n\n        for (let i = 0; i < triggerNodes.length; i++) {\n            mast.triggers.push(this._getTrigger(triggerNodes[i]));\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n    }\n\n    /**\n    * Parses the MAST xml file and get the triggers.\n    * @param {object} xmlDom - the XML DOM to parse\n    */\n    parse (xmlDom) {\n        let mast_ = new mast.Mast(),\n            mastNode = xmldom.getElement(xmlDom, 'MAST');\n\n        if (mastNode === null) {\n            return mast_;\n        }\n\n        this._getTriggers(mastNode, mast_);\n\n        return mast_;\n    }\n}\n\n\nexport default MastParser;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The TriggerManager manages the detection of the start and end of a trigger.\n* It takes as input a trigger object (as parsed from a MAST file) and tests the start and end conditions\n* to detect the activation and revocation of a trigger.\n*/\n\nimport { Condition } from './model/Mast';\n\nclass TriggerManager {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _parseTime (str) {\n        var timeParts,\n            SECONDS_IN_HOUR = 60 * 60,\n            SECONDS_IN_MIN = 60;\n\n        if (!str) {\n            return -1;\n        }\n\n        timeParts = str.split(':');\n\n        // Check time format, must be HH:MM:SS(.mmm)\n        if (timeParts.length !== 3) {\n            return -1;\n        }\n\n        return  (parseInt(timeParts[0]) * SECONDS_IN_HOUR) +\n                (parseInt(timeParts[1]) * SECONDS_IN_MIN) +\n                (parseFloat(timeParts[2]));\n    }\n\n    _compareValues (value1, value2, operator) {\n        var res = false;\n\n        if (value1 < 0 || value2 < 0) {\n            return false;\n        }\n\n        switch (operator) {\n            case Condition.OPERATOR.EQ:\n                res = (value1 === value2);\n                break;\n            case Condition.OPERATOR.NEQ:\n                res = (value1 !== value2);\n                break;\n            case Condition.OPERATOR.GTR:\n                res = (value1 > value2);\n                break;\n            case Condition.OPERATOR.GEQ:\n                res = (value1 >= value2);\n                break;\n            case Condition.OPERATOR.LT:\n                res = (value1 < value2);\n                break;\n            case Condition.OPERATOR.LEQ:\n                res = (value1 <= value2);\n                break;\n            case Condition.OPERATOR.MOD:\n                res = ((value1 % value2) === 0);\n                break;\n            default:\n                break;\n        }\n        return res;\n    }\n\n    _evaluateCondition (condition, video) {\n        var res = false,\n            i;\n\n        // Check pre-roll condition for activation\n        if (video.currentTime === 0 && condition.type === Condition.TYPE.EVENT && condition.name === Condition.NAME.ON_ITEM_START) {\n            res = true;\n        }\n\n        // Check mid-roll condition for activation\n        if (condition.type === Condition.TYPE.PROPERTY) {\n            switch (condition.name) {\n                case Condition.NAME.POSITION:\n                    res = this._compareValues(video.currentTime, this._parseTime(condition.value), condition.operator);\n                    break;\n                case Condition.NAME.DURATION:\n                    res = this._compareValues(video.duration, this._parseTime(condition.value), condition.operator);\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        // Check condition for revocation\n        if (video.ended && condition.type === Condition.TYPE.EVENT && condition.name === Condition.NAME.ON_ITEM_END) {\n            res = true;\n        }\n\n        // AND with sub-conditions\n        // MAST spec. : \"Child conditions are treated as an implicit AND, all children of a condition must evaluate true before a trigger will fire (or be revoked) from that condition.\"\n        for (i = 0; i < condition.conditions.length; i++) {\n            res &= this._evaluateCondition(condition.conditions[i], video);\n        }\n\n        return res;\n    }\n\n    _evaluateConditions (conditions, video) {\n        var res = false,\n            i;\n\n        // Evaluate each condition\n        // MAST spec. : \"Multiple condition elements are treated as an implicit OR, any one of them evaluating true will fire the trigger.\"\n        for (i = 0; i < conditions.length; i++) {\n            res |=  this._evaluateCondition(conditions[i], video);\n        }\n\n        return res;\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n        this._trigger = null;\n    }\n\n    /**\n     * Initializes the TriggerManager.\n     * @method init\n     * @access public\n     * @memberof TriggerManager#\n     * @param {Object} trigger - the trigger to handle by this manager\n     */\n    init (trigger) {\n        this._trigger = trigger;\n    }\n\n    /**\n     * Returns the trigger object managed by this TriggerManager.\n     * @method init\n     * @access public\n     * @memberof TriggerManager#\n     * @return {Object} the managed trigger object\n     */\n    getTrigger () {\n        return this._trigger;\n    }\n\n    /**\n     * Evaluates the trigger start conditions.\n     * @method checkStartConditions\n     * @access public\n     * @memberof TriggerManager#\n     * @param {Number} video - the main video element\n     */\n    checkStartConditions (video) {\n        if (this._trigger.activated) {\n            return false;\n        }\n        return this._evaluateConditions(this._trigger.startConditions, video);\n    }\n\n    /**\n     * Evaluates the trigger end conditions.\n     * @method checkEndConditions\n     * @access public\n     * @memberof TriggerManager#\n     * @param {Number} video - the main video element\n     */\n    checkEndConditions (video) {\n        return this._evaluateConditions(this._trigger.endConditions, video);\n    }\n}\n\nexport default TriggerManager;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* @class Mast\n* @ignore\n*/\nclass Mast {\n    constructor () {\n        this.baseUrl = '';\n        this.triggers = [];     // pointer to any number of Ad objects\n    }\n}\n\n/**\n* @class Trigger\n* @ignore\n*/\nclass Trigger {\n    constructor () {\n        this.id = '';\n        this.description = 0;\n        this.startConditions = [];      // pointer to a list of start conditions to  : AdsPlayer.mast.model.Trigger.Condition\n        this.endConditions = [];        // pointer to a list of end conditions : AdsPlayer.mast.model.Trigger.Condition\n        this.sources = [];              // pointer to a list of sources : AdsPlayer.mast.model.Trigger.Source\n        this.alreadyProcessed = false;  // mainly in the seeked case : do not replay trigger already played\n        this.vasts = [];\n        this.activated = false;\n    }\n}\n\n/**\n* @class Condition\n* @ignore\n*/\nclass Condition {\n    constructor () {\n        this.type = '';\n        this.name = '';\n        this.value = '';\n        this.operator = '';\n        this.conditions = [];\n    }\n}\n\n// ConditionType\nCondition.TYPE = {\n    EVENT: 'event',\n    PROPERTY: 'property'\n\n};\n\n// ConditionName\nCondition.NAME = {\n    ON_ITEM_START: 'OnItemStart',\n    ON_ITEM_END: 'OnItemEnd',\n    POSITION: 'Position',\n    DURATION: 'Duration'\n};\n\n// ConditionOperator\nCondition.OPERATOR = {\n    EQ:  'EQ',  // equal\n    NEQ: 'NEQ', // not equal\n    GTR: 'GTR', // greater\n    GEQ: 'GEQ', // greater or equal\n    LT:  'LT',  // lower\n    LEQ: 'LEQ', // lower or equal\n    MOD: 'MOD'  // modulo\n};\n\n/**\n* @class Source\n* @ignore\n*/\nclass Source {\n    constructor () {\n        this.uri = '';\n        this.altReference = '';\n        this.format = '';\n        this.sources = [];\n        // this.targets = [];\n    }\n}\n\n// SourceFormat\nSource.FORMAT = {\n    VAST: 'vast',\n    UIF: 'uif'\n};\n\n\nvar mast = {};\n\nmast.Mast = Mast;\nmast.Trigger = Trigger;\nmast.Condition = Condition;\nmast.Source = Source;\n\nexport default mast;\nexport { Mast, Trigger, Condition, Source };","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The ImagePlayer is a MediaPlayer implementation for playing still images.\n*/\n\nimport Debug from '../Debug';\nimport utils from '../utils/utils';\n\n\nclass ImagePlayer {\n\n    _getListeners (type) {\n        if (!(type in this._listeners)) {\n            this._listeners[type] = [];\n        }\n        return this._listeners[type];\n    }\n\n    _addEventListener (type, listener) {\n        var listeners = this._getListeners(type),\n            idx = listeners.indexOf(listener);\n\n        if (idx === -1) {\n            listeners.push(listener);\n        }\n    }\n\n    _removeEventListener (type, listener) {\n        var listeners = this._getListeners(type),\n            idx = listeners.indexOf(listener);\n\n        if (idx !== -1) {\n            listeners.splice(idx, 1);\n        }\n    }\n\n    _notifyEvent (type) {\n        var listeners = this._getListeners(type),\n            i = 0;\n\n        for (i = 0; i < listeners.length; i++) {\n            listeners[i].call(this);\n        }\n    }\n\n    _updateCurrentTime () {\n        var time = new Date().getTime();\n\n        this._currentTime += (time - this._timerTime) / 1000;\n        //this._debug.log(\"Image timeupdate, time = \" + this._currentTime);\n        this._notifyEvent('timeupdate');\n\n        if (this._currentTime >= this._duration) {\n            this._stopTimer();\n            this._ended = true;\n            this._notifyEvent('ended');\n        }\n\n        this._timerTime = time;\n    }\n\n    _startTimer () {\n        if (this._timerInterval !== null) {\n            return;\n        }\n        this._notifyEvent('play');\n        this._timerTime = new Date().getTime();\n        this._timerInterval = setInterval(this._updateCurrentTime.bind(this), 200);\n    }\n\n    _stopTimer () {\n        if (this._timerInterval === null) {\n            return;\n        }\n        this._notifyEvent('pause');\n        clearInterval(this._timerInterval);\n        this._timerInterval = null;\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n\n        this._uri = '';\n        this._image = null;\n        this._duration = 0;\n        this._currentTime = 0;\n        this._ended = false;\n        this._listeners = {};\n        this._timerInterval = null;\n        this._timerTime = -1;\n        this._events = ['play', 'pause', 'timeupdate', 'ended'];\n        this._debug = Debug.getInstance();\n    }\n\n    load (baseUrl, mediaFiles) {\n\n        var mediaFile = null,\n            type,\n            i;\n\n        // Load the first supported image format\n        // Support only jpeg, png and gif image formats\n        for (i = 0; i < mediaFiles.length; i++) {\n            type = mediaFiles[i].type;\n            if ((type === \"image/jpeg\") || (type === \"image/jpg\") || (type === \"image/png\") || (type === \"image/gif\")) {\n                mediaFile = mediaFiles[i];\n                break;\n            }\n        }\n\n        if (mediaFile === null) {\n            return false;\n        }\n\n        // Get adsplayer-image element if already declared in DOM\n        this._image = document.getElementById('adsplayer-image');\n\n        if (!this._image) {\n            // Create the image element\n            this._image = document.createElement('img');\n            this._image.autoplay = false;\n            this._image.id = 'adsplayer-image';\n        }\n\n        // Add base URL\n        this._uri = mediaFile.uri;\n        this._uri = utils.isAbsoluteURI(this._uri) ? this._uri : (baseUrl + this._uri);\n\n        this._debug.log(\"Load image media, uri = \" + this._uri);\n        this._image.src = this._uri;\n\n        // Reset current time\n        this._currentTime = 0;\n        this._ended = false;\n\n        return true;\n    }\n\n    getType () {\n        return \"image\";\n    }\n\n    getElement () {\n        return this._image;\n    }\n\n    addEventListener (type, listener) {\n        if (!this._image) {\n            return;\n        }\n        if (this._events.indexOf(type) !== -1) {\n            this._addEventListener(type, listener);\n        } else {\n            this._image.addEventListener(type, listener);\n        }\n    }\n\n    removeEventListener (type, listener) {\n        if (!this._image) {\n            return;\n        }\n        if (this._events.indexOf(type) !== -1) {\n            this._removeEventListener(type, listener);\n        } else {\n            this._image.removeEventListener(type, listener);\n        }\n    }\n\n    setDuration (duration) {\n        this._duration = duration;\n    }\n\n    getDuration () {\n        return this._duration;\n    }\n\n    getCurrentTime () {\n        return this._currentTime;\n    }\n\n    setVolume (/*volume*/) {\n        // NA\n    }\n\n    getVolume () {\n        return 0;\n    }\n\n    play () {\n        if (!this._image) {\n            return;\n        }\n        this._startTimer();\n    }\n\n    pause () {\n        if (!this._image) {\n            return;\n        }\n        this._stopTimer();\n    }\n\n    stop () {\n        if (!this._image) {\n            return;\n        }\n        this._stopTimer();\n    }\n\n    reset () {\n        if (!this._image) {\n            return;\n        }\n        this._image = null;\n        this._listeners = {};\n    }\n\n    isEnded () {\n        return this._ended;\n    }\n}\n\nexport default ImagePlayer;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The VideoPlayer is a MediaPlayer implementation for playing video files.\n*/\n\nimport Debug from '../Debug';\nimport utils from '../utils/utils';\n\n\nclass VideoPlayer {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    isMediaSupported (mimeType) {\n        if (!this._video) {\n            throw \"isMediaSupported(): element not created\";\n        }\n        if (!(this._video instanceof HTMLMediaElement)) {\n            throw \"isMediaSupported(): element must be of type HTMLMediaElement\";\n        }\n\n        var canPlay = this._video.canPlayType(mimeType);\n        return (canPlay === \"probably\" || canPlay === \"maybe\");\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n        this._uri = '';\n        this._video = null;\n        this._debug = Debug.getInstance();\n    }\n\n    load (baseUrl, mediaFiles) {\n\n        // Get 'adsplayer-video' element if already declared in DOM\n        this._video = document.getElementById('adsplayer-video');\n\n        if (!this._video) {\n            // Create the video element\n            this._video = document.createElement('video');\n            this._video.autoplay = false;\n            this._video.id = 'adsplayer-video';\n        }\n\n        // Check if input format is supported\n        if (!this.isMediaSupported(mediaFiles[0].type)) {\n            return false;\n        }\n\n        // Sort the mediafiles in bitrate ascending order\n        mediaFiles.sort(function(a, b) {\n            if (a.bitrate && b.bitrate) {\n                return a.bitrate - b.bitrate;\n            }\n            return -1;\n        });\n\n        // Play the media file with lowest bitrate\n        this._uri = mediaFiles[0].uri;\n\n        // Add base URL\n        this._uri = utils.isAbsoluteURI(this._uri) ? this._uri : (baseUrl + this._uri);\n\n        this._debug.log(\"Load video media, uri = \" + this._uri);\n\n        this._video.addEventListener('error', function(e) {\n            console.log(e);\n        });\n\n        this._video.src = this._uri;\n\n        return true;\n    }\n\n    getType () {\n        return \"video\";\n    }\n\n    getElement () {\n        return this._video;\n    }\n\n    addEventListener (type, listener) {\n        if (!this._video) {\n            return;\n        }\n        this._video.addEventListener(type, listener);\n    }\n\n    removeEventListener (type, listener) {\n        if (!this._video) {\n            return;\n        }\n        this._video.removeEventListener(type, listener);\n    }\n\n    setDuration (/*duration*/) {\n        // duration is handled by the video element\n    }\n\n    getDuration () {\n        if (!this._video) {\n            return 0;\n        }\n        return this._video.duration;\n    }\n\n    getCurrentTime () {\n        if (!this._video) {\n            return 0;\n        }\n        return this._video.currentTime;\n    }\n\n    getVolume () {\n        if (!this._video) {\n            return 0;\n        }\n        return this._video.muted ? 0 : this._video.volume;\n    }\n\n    setVolume (volume) {\n        if (!this._video) {\n            return;\n        }\n        this._video.volume = volume;\n    }\n\n    play () {\n        if (!this._video) {\n            return;\n        }\n        this._video.play();\n    }\n\n    stop () {\n        if (!this._video) {\n            return;\n        }\n        this._video.pause();\n    }\n\n    pause () {\n        if (!this._video) {\n            return;\n        }\n        this._video.pause();\n    }\n\n    reset () {\n        if (!this._video) {\n            return;\n        }\n        this._video = null;\n    }\n\n    isEnded () {\n        return this._video.ended;\n    }\n}\n\nexport default VideoPlayer;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nvar utils = {};\n\nutils.isAbsoluteURI = function(uri) {\n    return ((uri.toLowerCase().indexOf('http://') >= 0) || (uri.toLowerCase().indexOf('https://') >= 0));\n};\n\nexport default utils;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nvar xmldom = {};\n\nxmldom.getElementsByTagName = function(node, name) {\n    var elements = node.getElementsByTagName(name);\n    if (elements.length < 1) {\n        var child = node.firstElementChild || node.firstChild;\n        if (child) {\n            var namespaceURI = child.namespaceURI;\n            elements = node.getElementsByTagNameNS(namespaceURI, name);\n        }\n    }\n    return elements;\n};\n\nxmldom.getElement = function(node, name) {\n    var elements = this.getElementsByTagName(node, name);\n    if (elements.length < 1) {\n        return null;\n    }\n    return elements[0];\n};\n\nxmldom.getElements = function(node, name) {\n    return this.getElementsByTagName(node, name);\n};\n\nxmldom.getSubElements = function(node, name, subName) {\n    var element = this.getElement(node, name);\n    if (element === null) {\n        return [];\n    }\n    return this.getElements(element, subName);\n};\n\nxmldom.getChildNode = function (node, name) {\n    if (!node || !node.childNodes) {\n        return null;\n    }\n    for (var i = 0; i < node.childNodes.length; i++) {\n        if (node.childNodes[i].nodeName === name) {\n            return node.childNodes[i];\n        }\n    }\n    return null;\n};\n\nxmldom.getNodeTextValue = function (node) {\n    var cdataSection = this.getChildNode(node, '#cdata-section'),\n        textSection = this.getChildNode(node, '#text');\n    if (cdataSection) {\n        return cdataSection.nodeValue;\n    } else if (textSection) {\n        return textSection.nodeValue;\n    }\n    return '';\n};\n\nxmldom.getChildNodeTextValue = function (node, name) {\n    var element = this.getElement(node, name);\n    if (element === null) {\n        return '';\n    }\n    return this.getNodeTextValue(element);\n};\n\n\nexport default xmldom;","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The AdPlayer manages the sequencing of playing creatives of a single Ad.\n* It takes as input the Ad object as returned by the VAST parser.\n* The AdPlayer plays sequentially all contained Creatives,\n* with the help of a CreativePlayer.\n*\n* Dispatch events:\n*  - 'adStart' when when the playback of the ad (first creative) is starting.\n*  - 'adEnd' when the playback of the (all creatives) has ended\n*/\n\nimport CreativePlayer from './CreativePlayer';\nimport Debug from '../Debug';\nimport EventBus from '../EventBus';\n\nclass AdPlayer {\n\n    _sendImpressions (impressions) {\n        let impression;\n\n        if (impressions.length === 0) {\n            return;\n        }\n\n        for (let i = 0; i < impressions.length; i++) {\n            impression = impressions[i];\n            if (impression.uri && impression.uri.length > 0) {\n                this._debug.log(\"Send Impression, uri = \" + impression.uri);\n                let http = new XMLHttpRequest();\n                http.open(\"GET\", impression.uri, true);\n                http.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n                http.send();\n            }\n        }\n    }\n\n    _onCreativeEnd () {\n\n        this._debug.log(\"Creative ended\");\n\n        // Stop the current creative media\n        this._stopCreative();\n\n        // Play next creative\n        this._playNextCreative();\n    }\n\n    _pauseCreative () {\n        if (!this._creativePlayer) {\n            return;\n        }\n        this._creativePlayer.pause();\n    }\n\n    _resumeCreative () {\n        if (!this._creativePlayer) {\n            return;\n        }\n        this._creativePlayer.play();\n    }\n\n    _stopCreative () {\n        if (!this._creativePlayer) {\n            return;\n        }\n        this._eventBus.removeEventListener('creativeEnd', this._onCreativeEndListener);\n        this._creativePlayer.stop();\n        this._creativePlayer = null;\n    }\n\n    _playCreative (index) {\n        var creative = this._ad.inLine.creatives[index],\n            linear;\n\n        this._creativeIndex = index;\n        this._debug.log(\"Play Creative - index = \" + this._creativeIndex);\n\n        // Play Linear element\n        linear = creative.linear;\n\n        if (linear) {\n            this._debug.log(\"Play Linear Ad, duration = \" + linear.duration);\n            this._eventBus.addEventListener('creativeEnd', this._onCreativeEndListener);\n            this._creativePlayer = new CreativePlayer();\n            if (!this._creativePlayer.init(creative.linear, this._adPlayerContainer, this._mainVideo, this._baseUrl)) {\n                this._playNextCreative();\n            }\n        } else {\n            this._playNextCreative();\n        }\n    }\n\n    _playNextCreative () {\n\n        this._creativeIndex++;\n\n        if (this._creativeIndex < this._ad.inLine.creatives.length) {\n            this._playCreative(this._creativeIndex);\n        } else {\n            // Notify end of Ad\n            this._eventBus.dispatchEvent({\n                type: \"adEnd\",\n                data: {}\n            });\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    /**\n     * Initializes the AdPlayer\n     * @method constructor\n     * @access public\n     * @memberof AdPlayer#\n     */\n\n    constructor () {\n        this._ad = null;\n        this._adPlayerContainer = null;\n        this._mainVideo = null;\n        this._baseUrl = '';\n        this._creativeIndex = -1;\n        this._creativePlayer = null;\n        this._debug = Debug.getInstance();\n        this._eventBus = EventBus.getInstance();\n\n        this._onCreativeEndListener = this._onCreativeEnd.bind(this);\n    }\n\n    /**\n     * Initializes the AdManager.\n     * @method init\n     * @access public\n     * @memberof VastPlayerManager#\n     * @param {Object} ad - the Ad to play\n     * @param {Array} adPlayerContainer - the HTML DOM container for ads player components\n     * @param {Object} mainVideo - the HTML5 video element used by the main media player\n     * @param {string} baseUrl - the base URL for media files\n     */\n    init (ad, adPlayerContainer, mainVideo, baseUrl) {\n        this._ad = ad;\n        this._adPlayerContainer = adPlayerContainer;\n        this._mainVideo = mainVideo;\n        this._baseUrl = baseUrl;\n    }\n\n    start () {\n        // Notify an Ad is starting to play\n        this._eventBus.dispatchEvent({\n            type: 'adStart',\n            data: {}\n        });\n\n        // Send Impressions tracking\n        this._sendImpressions(this._ad.inLine.impressions);\n\n        // Play first Creative\n        this._playCreative(0);\n    }\n\n    play () {\n        this._resumeCreative();\n    }\n\n    pause () {\n        this._pauseCreative();\n    }\n\n    stop () {\n        this._stopCreative();\n    }\n}\n\nexport default AdPlayer;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The CreativePlayer manages:\n* - the playing of media files within a Creative (with the help of a Image/VideoPlayer)\n* - the tracking events (with the help of a TrackingEventsManager)\n* - the display of the ad skipping component\n* - the user clicks\n*/\n\nimport TrackingEventsManager from './TrackingEventsManager';\nimport VideoPlayer from '../media/VideoPlayer';\nimport ImagePlayer from '../media/ImagePlayer';\nimport Debug from '../Debug';\nimport EventBus from '../EventBus';\n\nclass CreativePlayer {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _parseTime (str) {\n        var timeParts,\n            SECONDS_IN_HOUR = 60 * 60,\n            SECONDS_IN_MIN = 60;\n\n        if (!str) {\n            return -1;\n        }\n\n        timeParts = str.split(':');\n\n        // Check time format, must be HH:MM:SS(.mmm)\n        if (timeParts.length !== 3) {\n            return -1;\n        }\n\n        return  (parseInt(timeParts[0]) * SECONDS_IN_HOUR) +\n                (parseInt(timeParts[1]) * SECONDS_IN_MIN) +\n                (parseFloat(timeParts[2]));\n    }\n\n    _onMediaPlay () {\n\n        this._debug.log(\"Creative media play\");\n\n        // Notify the creative has ended\n        this._eventBus.dispatchEvent({\n            type: 'play',\n            data: {}\n        });\n    }\n\n    _onMediaPause () {\n\n        this._debug.log(\"Creative media pause\");\n\n        // Notify the creative has ended\n        this._eventBus.dispatchEvent({\n            type: 'pause',\n            data: {}\n        });\n    }\n\n    _onMediaError () {\n\n        this._debug.log(\"Creative media error\");\n\n        // Notify the creative has ended\n        this._eventBus.dispatchEvent({\n            type: 'creativeEnd',\n            data: {}\n        });\n    }\n\n    _onMediaEnded () {\n\n        this._debug.log(\"creative media ended\");\n\n        // Notify the creative has ended\n        this._eventBus.dispatchEvent({\n            type: 'creativeEnd',\n            data: {}\n        });\n    }\n\n    _onMediaTimeupdate () {\n\n        //this._debug.log(\"Media timeupdate: \" + this._mediaPlayer.getCurrentTime());\n    }\n\n    _onMainVideoVolumeChange () {\n        if (!this._mediaPlayer) {\n            return;\n        }\n        this._mediaPlayer.setVolume(this._mainVideo.muted ? 0 : this._mainVideo.volume);\n    }\n\n    _onAdClick (creative) {\n        // this = creative player\n        if (!creative.videoClicks) {\n            return;\n        }\n        this._debug.log(\"Creative Click\");\n        // ClickThrough : send an event for the application to open the web page\n        if (creative.videoClicks.clickThrough) {\n            this._debug.log(\"Ad click, uri = \" + creative.videoClicks.clickThrough);\n            this._eventBus.dispatchEvent({\n                type: 'click',\n                data: {\n                    uri: creative.videoClicks.clickThrough\n                }\n            });\n        }\n\n        // TODO\n        // ClickTracking\n        // if (this.videoClicks.clickTracking) {\n        // }\n    }\n\n    _load (creative, baseUrl) {\n        var mediaFile,\n            isVideo,\n            isImage;\n\n        if (!creative) {\n            return false;\n        }\n\n        if (creative.mediaFiles.length === 0) {\n            return false;\n        }\n\n        mediaFile = creative.mediaFiles[0];\n\n        // Video or image media ?\n        isVideo = mediaFile.type.indexOf('video') !== -1;\n        isImage = mediaFile.type.indexOf('image') !== -1;\n\n        if (isVideo) {\n            this._mediaPlayer = new VideoPlayer();\n        }\n        else if (isImage) {\n            this._mediaPlayer = new ImagePlayer();\n        } else {\n            // Unknown/unsupported media type\n            return false;\n        }\n\n        // Load the media files\n        this._debug.log(\"Creative load\");\n        if (!this._mediaPlayer.load(baseUrl, creative.mediaFiles)) {\n            this._mediaPlayer = null;\n            return false;\n        }\n\n        this._mediaPlayer.setDuration(this._parseTime(creative.duration));\n        this._mediaPlayer.addEventListener('play', this._onMediaPlayListener);\n        this._mediaPlayer.addEventListener('pause', this._onMediaPauseListener);\n        this._mediaPlayer.addEventListener('error', this._onMediaErrorListener);\n        this._mediaPlayer.addEventListener('timeupdate', this._onMediaTimeupdateListener);\n        this._mediaPlayer.addEventListener('ended', this._onMediaEndedListener);\n\n        // Add tracking events\n        if (creative.trackingEvents) {\n            this._trackingEventsManager = new TrackingEventsManager();\n            this._trackingEventsManager.init(creative.trackingEvents, this._mediaPlayer);\n            this._trackingEventsManager.start();\n        }\n\n        // Notify a creative is starting to play\n        this._eventBus.dispatchEvent({\n            type: 'creativeStart',\n            data: {}\n        });\n\n        // Notify a media element has been created and appended into document\n        this._eventBus.dispatchEvent({\n            type: 'addElement',\n            data: {\n                element: this._mediaPlayer.getElement(),\n                type: this._mediaPlayer.getType()\n            }\n        });\n\n        // Add the media player DOM element\n        this._adPlayerContainer.appendChild(this._mediaPlayer.getElement());\n\n        // Listener for click\n        if (creative.videoClicks) {\n            if (creative.videoClicks.clickThrough) {\n                this._mediaPlayer.getElement().style.cursor = 'pointer';\n            }\n            this._mediaPlayer.getElement().addEventListener('click', this._onAdClick.bind(this, creative));\n        }\n\n        // Align media volume to main video volume, add 'volumechange' listener\n        this._onMainVideoVolumeChange();\n        this._mainVideo.addEventListener('volumechange', this._onMainVideoVolumeChange.bind(this));\n\n        // Start playing the media\n        this._play();\n\n        return true;\n    }\n\n    _play () {\n\n        if (!this._mediaPlayer) {\n            return;\n        }\n\n        this._debug.log(\"Creative play\");\n\n        // Play the media player\n        this._mediaPlayer.play();\n    }\n\n    _pause () {\n\n        if (!this._mediaPlayer) {\n            return;\n        }\n\n        this._debug.log(\"Creative pause\");\n\n        // Pause the media player\n        this._mediaPlayer.pause();\n    }\n\n    _stop () {\n\n        if (!this._mediaPlayer) {\n            return;\n        }\n\n        this._debug.log(\"Creative stop\");\n\n        // Stop listening for 'volumechange' event\n        this._mainVideo.removeEventListener('volumechange', this._onMainVideoVolumeChange);\n        this._mainVideo = null;\n\n        // Stop the media player\n        this._mediaPlayer.removeEventListener('play', this._onMediaPlayListener);\n        this._mediaPlayer.removeEventListener('pause', this._onMediaPauseListener);\n        this._mediaPlayer.removeEventListener('error', this._onMediaErrorListener);\n        this._mediaPlayer.removeEventListener('timeupdate', this._onMediaTimeupdateListener);\n        this._mediaPlayer.removeEventListener('ended', this._onMediaEndedListener);\n        this._mediaPlayer.stop();\n\n        // Notify a media element has been removed from DOM\n        this._eventBus.dispatchEvent({\n            type: 'removeElement',\n            data: {\n                element: this._mediaPlayer.getElement(),\n                type: this._mediaPlayer.getType()\n            }\n        });\n\n        // Remove the element from the DOM\n        this._adPlayerContainer.removeChild(this._mediaPlayer.getElement());\n\n        // Reset the media player\n        this._mediaPlayer.reset();\n        this._mediaPlayer = null;\n\n        // Stop the TrackingEvents manager\n        if (this._trackingEventsManager) {\n            this._trackingEventsManager.stop();\n            this._trackingEventsManager = null;\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n        this._adPlayerContainer = null;\n        this._mediaPlayer = null;\n        this._trackingEventsManager = null;\n        this._mainVideo = null;\n        this._debug = Debug.getInstance();\n        this._eventBus = EventBus.getInstance();\n\n        this._onMediaPlayListener = this._onMediaPlay.bind(this);\n        this._onMediaPauseListener = this._onMediaPause.bind(this);\n        this._onMediaErrorListener = this._onMediaError.bind(this);\n        this._onMediaTimeupdateListener = this._onMediaTimeupdate.bind(this);\n        this._onMediaEndedListener = this._onMediaEnded.bind(this);\n    }\n\n    /**\n     * Initializes the creative player.\n     * @method init\n     * @access public\n     * @memberof CreativePlayer#\n     * @param {Object} creative - the creative element to play\n     * @param {Object} adPlayerContainer - the HTML DOM container for ads player components\n     * @param {Object} mainVideo - the HTML5 video element used by the main media player\n     * @param {string} baseUrl - the base URL for media files\n     */\n    init (creative, adPlayerContainer, mainVideo, baseUrl) {\n        this._adPlayerContainer = adPlayerContainer;\n        this._mainVideo = mainVideo;\n        return this._load(creative, baseUrl);\n    }\n\n    play () {\n        this._play();\n    }\n\n    pause () {\n        this._pause();\n    }\n\n    stop () {\n        this._stop();\n    }\n}\n\nexport default CreativePlayer;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The TrackingEventsManager manages the sending of the tracking events while a creative's media is playing.\n* It takes as input the list of tracking events to send.\n*/\n\nimport Debug from '../Debug';\n\nclass TrackingEventsManager {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _postEvent (uri) {\n        let xhr = new XMLHttpRequest();\n        xhr.open('GET', uri, true);\n        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n        xhr.send();\n    }\n\n    _addEventListener (element, eventType, trackingEvent) {\n\n        let self = this,\n            _listener = function(/*event*/) {\n                if (this.completed === true) {\n                    return;\n                }\n                if (this.uri === undefined || this.uri.length === 0) {\n                    return;\n                }\n                if (this.condition && !this.condition()) {\n                    return;\n                }\n                self._debug.log(\"Send tracking event \" + this.event + \", uri = \" + this.uri);\n                self._postEvent(this.uri);\n                if (this.oneShot === true) {\n                    this.completed = true;\n                }\n            },\n            _eventListener = {\n                type: eventType,\n                element: element,\n                listener: _listener.bind(trackingEvent)\n            };\n\n        element.addEventListener(eventType, _eventListener.listener);\n        this._eventListeners.push(_eventListener);\n    }\n\n    _addPlayerEventListeners () {\n\n        for (let i = 0; i < this._trackingEvents.length; i++) {\n            let trackingEvent = this._trackingEvents[i];\n            if (trackingEvent.uri && trackingEvent.uri.length > 0) {\n                switch (trackingEvent.event) {\n                    case 'creativeView':\n                        trackingEvent.oneShot = true;\n                        this._addEventListener(this._adMediaPlayer, 'loadeddata', trackingEvent);\n                        break;\n                    case 'start':\n                        trackingEvent.oneShot = true;\n                        this._addEventListener(this._adMediaPlayer, 'playing', trackingEvent);\n                        break;\n                    case 'pause':\n                        trackingEvent.oneShot = false;\n                        trackingEvent.condition = () => {\n                            // To ignore pause event that may be raised at end of stream\n                            return (this._adMediaPlayer.isEnded() === false );\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'pause', trackingEvent);\n                        break;\n                    case 'resume':\n                        trackingEvent.oneShot = false;\n                        trackingEvent.condition = () => {\n                            return (this._adMediaPlayer.getCurrentTime() > 0);\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'play', trackingEvent);\n                        break;\n                    case 'firstQuartile':\n                        trackingEvent.oneShot = true;\n                        trackingEvent.condition = () => {\n                            //_debug.log(\"Progress: \" + (this._adMediaPlayer.getCurrentTime() / _adMediaPlayer.getDuration()));\n                            return ((this._adMediaPlayer.getCurrentTime() / this._adMediaPlayer.getDuration()) >= 0.25);\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'timeupdate', trackingEvent);\n                        break;\n                    case 'midpoint':\n                        trackingEvent.oneShot = true;\n                        trackingEvent.condition = () => {\n                            //_debug.log(\"Progress: \" + (this._adMediaPlayer.getCurrentTime() / _adMediaPlayer.getDuration()));\n                            return ((this._adMediaPlayer.getCurrentTime() / this._adMediaPlayer.getDuration()) >= 0.50);\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'timeupdate', trackingEvent);\n                        break;\n                    case 'thirdQuartile':\n                        trackingEvent.oneShot = true;\n                        trackingEvent.condition = () => {\n                            //_debug.log(\"Progress: \" + (this._adMediaPlayer.getCurrentTime() / _adMediaPlayer.getDuration()));\n                            return ((this._adMediaPlayer.getCurrentTime() / this._adMediaPlayer.getDuration()) >= 0.75);\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'timeupdate', trackingEvent);\n                        break;\n                    case 'rewind':\n                        trackingEvent.oneShot = false;\n                        trackingEvent.condition = () => {\n                            let res = ((this._adMediaPlayer.getCurrentTime() < this._currentTime) && (this._adMediaPlayer.isEnded() === false));\n                            this._currentTime = this._adMediaPlayer.getCurrentTime();\n                            return res;\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'timeupdate', trackingEvent);\n                        break;\n                    case 'complete':\n                        this._addEventListener(this._adMediaPlayer, 'ended', trackingEvent);\n                        break;\n                    case 'mute':\n                        trackingEvent.oneShot = false;\n                        trackingEvent.condition = () => {\n                            let res = !this._mute && (this._adMediaPlayer.getVolume() === 0);\n                            this._mute = (this._adMediaPlayer.getVolume() === 0);\n                            return res;\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'volumechange', trackingEvent);\n                        break;\n                    case 'unmute':\n                        trackingEvent.oneShot = false;\n                        trackingEvent.condition = () => {\n                            let res = !this._unmute && (this._adMediaPlayer.getVolume() > 0);\n                            this._unmute = (this._adMediaPlayer.getVolume() > 0);\n                            return res;\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'volumechange', trackingEvent);\n                        break;\n                    case 'fullscreen':\n                    case 'exitFullscreen':\n                        trackingEvent.oneShot = false;\n                        trackingEvent.condition = (event = trackingEvent.event) => {\n                            let state = (event === 'fullscreen');\n                            return (document.fullScreen === state || document.mozFullScreen === state || document.webkitIsFullScreen === state);\n                        };\n                        this._addEventListener(document, 'webkitfullscreenchange', trackingEvent);\n                        this._addEventListener(document, 'mozfullscreenchange', trackingEvent);\n                        this._addEventListener(document, 'MSFullscreenChange', trackingEvent);\n                        this._addEventListener(document, 'fullscreenChange', trackingEvent);\n                        break;\n                    case 'progress':\n                        trackingEvent.oneShot = true;\n                        trackingEvent.condition = () => {\n                            if (trackingEvent.offsetPercent) {\n                                //this._debug.log(\"progress:\" + this._adMediaPlayer.getCurrentTime()+\" vs offsetPercent = \" + trackingEvent.offsetPercent * this._adMediaPlayer.getDuration());\n                                return (this._adMediaPlayer.getCurrentTime() >= trackingEvent.offsetPercent * this._adMediaPlayer.getDuration());\n                            } else {\n                                //this._debug.log(\"progress:\" + this._adMediaPlayer.getCurrentTime()+\" vs offsetInSeconds \" + trackingEvent.offsetInSeconds);\n                                return (this._adMediaPlayer.getCurrentTime() >= trackingEvent.offsetInSeconds);\n                            }\n                        };\n                        this._addEventListener(this._adMediaPlayer, 'timeupdate', trackingEvent);\n                        break;\n                    case 'acceptInvitationLinear':\n                        trackingEvent.oneShot = false;\n                        this._addEventListener(this._adMediaPlayer, 'click', trackingEvent);\n                        break;\n                    case 'closeLinear':\n                        trackingEvent.oneShot = false;\n                        this._addEventListener(window, 'beforeunload', trackingEvent);\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n\n    _removePlayerEventListeners () {\n        for (let i = 0; i < this._eventListeners.length; i++) {\n            this._eventListeners[i].element.removeEventListener(this._eventListeners[i].type, this._eventListeners[i].listener);\n        }\n        this._eventListeners = [];\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n        this._trackingEvents = null;\n        this._adMediaPlayer = null;\n        this._currentTime = -1;\n        this._mute = -1;\n        this._unmute = -1;\n        this._debug = Debug.getInstance();\n        this._eventListeners = [];\n    }\n\n    /**\n     * Initializes the TrackingEventsManager.\n     * @method init\n     * @access public\n     * @memberof TrackingEventsManager#\n     * @param {Array} trackingEvents - the array of tracking events to manage\n     * @param {Object} adMediaPlayer - the ad media player\n     */\n    init (trackingEvents, adMediaPlayer) {\n        this._trackingEvents = trackingEvents;\n        this._adMediaPlayer = adMediaPlayer;\n        this._mute = (this._adMediaPlayer.getVolume() === 0);\n        this._unmute = (this._adMediaPlayer.getVolume() > 0);\n    }\n\n    start () {\n        if (this._trackingEvents.length === 0) {\n            return;\n        }\n        this._addPlayerEventListeners();\n    }\n\n    stop () {\n        this._removePlayerEventListeners();\n    }\n}\n\nexport default TrackingEventsManager;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* VAST parser. This class parses VAST file in XML format\n* and construct the corresponding VAST object according to VAST data model.\n*/\n\nimport vast from './model/Vast';\nimport xmldom from '../utils/xmldom';\n\nclass VastParser {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _getTrackingEvent (trackingNode) {\n        let trackingEvent = new vast.TrackingEvent();\n\n        trackingEvent.event = trackingNode.getAttribute('event');\n        trackingEvent.uri = xmldom.getNodeTextValue(trackingNode);\n        if (trackingEvent.event == \"progress\") {\n            var offsetValue = trackingNode.getAttribute('offset');\n            if (offsetValue.indexOf(\"%\") == -1) {\n                /* convert HH:MM:SS ( or HH:MM:SS.mmm) in seconds */\n                trackingEvent.offsetInSeconds = new Date('1970-01-01T' + offsetValue + 'Z').getTime() / 1000;\n            }\n            else {\n                trackingEvent.offsetPercent = offsetValue.substring(0, offsetValue.indexOf(\"%\")) / 100;\n            }\n        }\n        return trackingEvent;\n    }\n\n    _getVideoClicks (videoClicksNode) {\n        let videoClicks = new vast.VideoClicks(),\n            nodeName,\n            nodeValue;\n\n        for (let i = 0; i < videoClicksNode.childNodes.length; i++) {\n            nodeName = videoClicksNode.childNodes[i].nodeName;\n            nodeValue = xmldom.getNodeTextValue(videoClicksNode.childNodes[i]);\n\n            switch (nodeName) {\n                case \"ClickThrough\":\n                    videoClicks.clickThrough = nodeValue;\n                    break;\n                case \"ClickTracking\":\n                    videoClicks.clickTracking = nodeValue;\n                    break;\n                case \"CustomClick\":\n                    videoClicks.customClick = nodeValue;\n                    break;\n            }\n        }\n\n        return videoClicks;\n    }\n\n    _getMediaFile (mediaFileNode) {\n        let mediaFile = new vast.MediaFile();\n\n        mediaFile.id = mediaFileNode.getAttribute('id');\n        mediaFile.delivery = mediaFileNode.getAttribute('delivery');\n        mediaFile.type = mediaFileNode.getAttribute('type');\n        mediaFile.bitrate = mediaFileNode.getAttribute('bitrate');\n        mediaFile.width = mediaFileNode.getAttribute('width');\n        mediaFile.height = mediaFileNode.getAttribute('height');\n        mediaFile.scalable = mediaFileNode.getAttribute('scalable');\n        mediaFile.maintainAspectRatio = mediaFileNode.getAttribute('maintainAspectRatio');\n        mediaFile.apiFramework = mediaFileNode.getAttribute('apiFramework');\n        mediaFile.uri = xmldom.getNodeTextValue(mediaFileNode);\n\n        return mediaFile;\n    }\n\n    _getLinear (linearNode) {\n        let linear = new vast.Linear(),\n            trackingNodes,\n            videoClicksNode,\n            mediaFileNodes,\n            i;\n\n        linear.duration = xmldom.getChildNodeTextValue(linearNode, 'Duration');\n        linear.adParameters = xmldom.getChildNodeTextValue(linearNode, 'AdParameters');\n\n        trackingNodes = xmldom.getSubElements(linearNode, 'TrackingEvents', 'Tracking');\n        for (i = 0; i < trackingNodes.length; i++) {\n            linear.trackingEvents.push(this._getTrackingEvent(trackingNodes[i]));\n        }\n\n        videoClicksNode = xmldom.getElement(linearNode, 'VideoClicks');\n        if (videoClicksNode) {\n            linear.videoClicks = this._getVideoClicks(videoClicksNode);\n        }\n\n        mediaFileNodes = xmldom.getSubElements(linearNode, 'MediaFiles', 'MediaFile');\n        for (i = 0; i < mediaFileNodes.length; i++) {\n            linear.mediaFiles.push(this._getMediaFile(mediaFileNodes[i]));\n        }\n\n        return linear;\n    }\n\n    _getCreative (creativeNode) {\n        let creative = new vast.Creative(),\n            linearNode;\n\n        creative.id = creativeNode.getAttribute('id');\n        creative.adId = creativeNode.getAttribute('AdID');\n        creative.sequence = creativeNode.getAttribute('sequence');\n\n        linearNode = xmldom.getElement(creativeNode, 'Linear');\n        if (linearNode) {\n            creative.linear = this._getLinear(linearNode);\n        }\n\n        // TODO: get Companion and non-Linear elements\n\n        return creative;\n    }\n\n    _getInLine (adNode) {\n        let inLine = new vast.InLine(),\n            inLineNode = xmldom.getElement(adNode, 'InLine'),\n            impressionNodes,\n            creativeNodes,\n            i;\n\n        if (inLineNode === null) {\n            return null;\n        }\n\n        inLine.adSystem = xmldom.getChildNodeTextValue(inLineNode, 'AdSystem');\n        inLine.adTitle = xmldom.getChildNodeTextValue(inLineNode, 'AdTitle');\n        inLine.description = xmldom.getChildNodeTextValue(inLineNode, 'Description');\n        inLine.survey = xmldom.getChildNodeTextValue(inLineNode, 'Survey');\n        inLine.error = xmldom.getChildNodeTextValue(inLineNode, 'Error');\n\n        impressionNodes = xmldom.getElements(inLineNode, 'Impression');\n        for (i = 0; i < impressionNodes.length; i++) {\n            var impression = new vast.Impression();\n            impression.id = impressionNodes[i].getAttribute('id');\n            impression.uri = xmldom.getNodeTextValue(impressionNodes[i]);\n            inLine.impressions.push(impression);\n\n        }\n\n        creativeNodes = xmldom.getSubElements(inLineNode, 'Creatives', 'Creative');\n        for (i = 0; i < creativeNodes.length; i++) {\n            inLine.creatives.push(this._getCreative(creativeNodes[i]));\n        }\n\n        return inLine;\n    }\n\n    _getAd (adNode) {\n        let ad = new vast.Ad();\n        ad.id = adNode.getAttribute('id');\n        ad.sequence = adNode.getAttribute('sequence');\n        ad.inLine = this._getInLine(adNode);\n        return ad;\n    }\n\n    _getAds (vastNode, vast_) {\n        let adNodes = xmldom.getElements(vastNode, 'Ad');\n        for (let i = 0; i < adNodes.length; i++) {\n            vast_.ads.push(this._getAd(adNodes[i]));\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor() {\n    }\n\n    /**\n    * Parses the VAST XML DOM and get the triggers.\n    * @param {object} xmlDom - the XML DOM to parse\n    */\n    parse (xmlDom) {\n        let vast_ = new vast.Vast(),\n            vastNode = xmldom.getElement(xmlDom, 'VAST');\n\n        if (vastNode === null) {\n            return vast_;\n        }\n\n        vast_.version = vastNode.getAttribute('version');\n\n        this._getAds(vastNode, vast_);\n\n        return vast_;\n    }\n}\n\nexport default VastParser;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* The VastPlayerManager manages the sequencing of playing ads of a single VAST.\n* It takes as input the list of Vast objects as returned by the VAST parser.\n* For each Vast, the VastPlayerManager plays sequentially all contained Ads,\n* with the help of an AdPlayer.\n*/\n\n\nimport AdPlayer from './AdPlayer';\nimport Debug from '../Debug';\nimport EventBus from '../EventBus';\n\nclass VastPlayerManager {\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PRIVATE ////////////////////////////////////////////\n\n    _onAdEnd () {\n\n        this._debug.log(\"Ad ended\");\n\n        // Stop the current Ad\n        this._stopAd();\n\n        // Play next Ad\n        this._playNextAd();\n    }\n\n    _pauseAd () {\n        if (!this._adPlayer) {\n            return;\n        }\n        this._adPlayer.pause();\n    }\n\n    _resumeAd () {\n        if (!this._adPlayer) {\n            return;\n        }\n        this._adPlayer.play();\n    }\n\n    _stopAd () {\n        if (!this._adPlayer) {\n            return;\n        }\n        this._eventBus.removeEventListener('adEnd', this._onAdEndListener);\n        this._adPlayer.stop();\n        this._adPlayer = null;\n    }\n\n    _playAd (index) {\n        let vast = this._vasts[this._vastIndex],\n            ad = vast.ads[index];\n\n        this._adIndex = index;\n        this._debug.log(\"Play Ad - index = \" + this._adIndex);\n\n        this._eventBus.addEventListener('adEnd', this._onAdEndListener);\n        this._adPlayer = new AdPlayer();\n        this._adPlayer.init(ad, this._adPlayerContainer, this._mainVideo, vast.baseUrl);\n        this._adPlayer.start();\n    }\n\n    _playNextAd () {\n        let vast = this._vasts[this._vastIndex];\n\n        this._adIndex++;\n\n        if (this._adIndex < vast.ads.length) {\n            this._playAd(this._adIndex);\n        } else {\n            this._playNextVast();\n        }\n    }\n\n    _playVast (index) {\n        let vast = this._vasts[index];\n\n        if (vast.ads.length === 0) {\n            // Empty VAST\n            return;\n        }\n\n        this._vastIndex = index;\n        this._debug.log(\"Play Vast - index = \" + this._vastIndex);\n\n        // Play first Ad\n        this._playAd(0);\n    }\n\n    _playNextVast () {\n\n        this._vastIndex++;\n\n        if (this._vastIndex < this._vasts.length) {\n            this._playVast(this._vastIndex);\n        } else {\n            // Notify end of trigger\n            this._eventBus.dispatchEvent({\n                type: 'triggerEnd',\n                data: {}\n            });\n        }\n    }\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////\n    ////////////////////////////////////////// PUBLIC /////////////////////////////////////////////\n\n    constructor () {\n        this._vasts = [];\n        this._adPlayerContainer = null;\n        this._adIndex = -1;\n        this._adPlayer = null;\n        this._debug = Debug.getInstance();\n        this._eventBus = EventBus.getInstance();\n        this._onAdEndListener = this._onAdEnd.bind(this);\n    }\n\n    /**\n     * Initializes the VastPlayerManager.\n     * @method init\n     * @access public\n     * @memberof VastPlayerManager#\n     * @param {Array} vasts - the array of Vast components to play\n     * @param {Array} adPlayerContainer - the HTML DOM container for ads player components\n     */\n    init (vasts, adPlayerContainer, mainVideo) {\n        this._vasts = vasts;\n        this._adPlayerContainer = adPlayerContainer;\n        this._mainVideo = mainVideo;\n    }\n\n    start () {\n        if (!this._vasts || this._vasts.length === 0) {\n            return;\n        }\n\n        // Notify a trigger is starting to play\n        this._eventBus.dispatchEvent({\n            type: 'triggerStart',\n            data: {}\n        });\n\n        this._playVast(0);\n    }\n\n    play () {\n        this._resumeAd();\n    }\n\n    pause () {\n        this._pauseAd();\n    }\n\n    stop () {\n        this._stopAd();\n    }\n}\n\nexport default VastPlayerManager;\n","/*\n* The copyright in this software module is being made available under the BSD License, included\n* below. This software module may be subject to other third party and/or contributor rights,\n* including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2016, Orange\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification, are permitted\n* provided that the following conditions are met:\n* - Redistributions of source code must retain the above copyright notice, this list of conditions\n*   and the following disclaimer.\n* - Redistributions in binary form must reproduce the above copyright notice, this list of\n*   conditions and the following disclaimer in the documentation and/or other materials provided\n*   with the distribution.\n* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote\n*   products derived from this software module without specific prior written permission.\n*\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR\n* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O\n* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n* @class Vast\n* @ignore\n*/\nclass Vast {\n    constructor () {\n        this.version = '';\n        this.ads = [];\n    }\n}\n\n/**\n* @class Ad\n* @ignore\n*/\nclass Ad {\n    constructor () {\n        this.id = '';                       // [Optional] an ad server-defined string for the ad\n        this.sequence = 0;                  // [Optional] the sequence in which an ad should play\n        this.inLine = null;\n        this.wrapper = null;\n    }\n}\n\n/**\n* @class InLine\n* @ignore\n*/\nclass InLine {\n    constructor () {\n        this.adSystem = '';                 // [Required] Source ad server\n        this.adTitle = '';                  // [Required] Title\n        this.description = '';              // [Optional] Description\n        this.survey = '';                   // [Optional] URI of request to survey vendor\n        this.error = '';                    // [Optional] URI to request if ad does not play due to error\n        this.impressions = [];              // [Required] URIs to track impressions.\n        this.creatives = [];                // [Required] Creative elements\n        this.extensions = [];               // [Optional] Any valid XML may be included in the Extensions node\n    }\n}\n\n/**\n* @class Impression\n* @ignore\n*/\nclass Impression {\n    constructor () {\n        this.uri = '';                      // [Required] URI to track Impression\n        this.id = '';                       // [Optional] Identifier\n    }\n}\n\n/**\n* @class Extensions\n* @ignore\n*/\nclass Extensions {\n    constructor () {\n        this.uri = '';                      //\n        this.other = '';                    //\n    }\n}\n\n/**\n* @class Creative\n* @ignore\n*/\nclass Creative {\n    constructor () {\n        this.id = '';                       // [Optional] Identifier\n        this.adId = '';                     // [Optional] Ad-ID for the creative (formerly ISCI)\n        this.sequence = 0;                  // [Optional] The preferred order in which multiple Creatives should be displayed\n        this.linear = null;                 // [Optional] Linear ad\n        this.CompanionAds = [];             // [Optional] Companion ads\n        this.nonLinearAds = [];             // [Optional] Non-linear ads\n    }\n}\n\n// Creative types\nCreative.TYPE = {\n    LINEAR: 'linear',\n    NON_LINEAR_ADS: 'NonLinearAds',\n    COMPANION_ADS : 'CompanionAds'\n};\n\n/**\n* @class Linear\n* @ignore\n*/\nclass Linear {\n    constructor () {\n        this.duration = 0;                  // [Required] Duration in standard time format, hh:mm:ss\n        this.trackingEvents = [];           // [Optional] Tracking events elements\n        this.adParameters = '';             // [Optional] Data to be passed into the video ad\n        this.videoClicks = null;            // [Optional] Video clicks\n        this.mediaFiles = [];               // [Required] Media file elements\n    }\n}\n\n/**\n* @class Companion\n* @ignore\n*/\nclass Companion {\n    constructor () {\n        this.id = '';                       // optional : identifier\n        this.width = 0;                     // width pixel dimension of companion\n        this.height = 0;                    // height pixel dimension of companion\n        this.staticResource = null;         // optional : pointer to the static resource : AdsPlayer.vast.model.Ad.StaticResource\n        this.iFrameResource = '';           // optional : URI source for an IFrame to display the companion element\n        this.hTMLResource = '';             // optional : HTML to display the companion element : shall be CDATA value\n        this.trackingEvents = [];           // optional : pointer to any number of tracking objects : AdsPlayer.vast.model.Ad.CompanionTracking\n        this.clickThrough = '';             // optional : URI to open as destination page when user clicks on the companion\n        this.altText = '';                  // optional : alt text to be displayed when companion is rendered in HTML environment.\n        this.adParameters = '';             // optional : data to be passed into the companion ads\n    }\n}\n\n//\n//      Non Linear Ads\n//\n\n/**\n* @class Companion\n* @ignore\n*/\nclass NonLinear {\n    constructor () {\n        this.id = '';                       // optional : identifier\n        this.width = 0;                     // width pixel dimension of non linear\n        this.height = 0;                    // height pixel dimension of non linear\n        this.expandedWidth = 0;             // optional : pixel dimensions of expanding nonlinear ad when in expanded state\n        this.expandedHeight  = 0;           // optional : pixel dimensions of expanding nonlinear ad when in expanded state\n        this.scalable = true;               // optional : whether it is acceptable to scale the image\n        this.maintainAspectRatio = true;    // optional : whether the ad must have its aspect ratio maintained when scaled\n        this.apiFramework = '';             // optional : defines the method to use for communication with the nonlinear element\n        this.staticResource = null;         // optional : pointer to the static resource : AdsPlayer.vast.model.Ad.StaticResource\n        this.hTMLResource = '';             // optional : HTML to display the companion element : shall be CDATA value\n        this.trackingEvents = [];           // optional : pointer to any number of tracking objects : AdsPlayer.vast.model.Ad.Tracking\n        this.clickThrough = '';             // optional : URI to open as destination page when user clicks on the non-linear ad unit\n        this.adParameters = '';             // optional : data to be passed into the video ad\n    }\n}\n\n/**\n* @class TrackingEvent\n* @ignore\n*/\nclass TrackingEvent {\n    constructor () {\n        this.uri = '';                      // [Optional] URI to track various events during playback\n        this.event = '';                    // [Required] The name of the event to track for the Linear element\n        this.offsetInSeconds = '';          // [Optional] Required in \"Progess\" event, not use with other events\n        this.offsetPercent = '';            // [Optional] Required in \"Progess\" event, not use with other events\n    }\n}\n\n\n/**\n* [TrackingEvent description]\n* @type {Object}\n*/\nTrackingEvent.TYPE = {\n    CREATIVEVIEW:'creativeView',\n    START:'start',\n    MIDPOINT: 'midpoint',\n    FIRSTQUARTILE: 'firstQuartile',\n    THIRDQUARTILE: 'thirdQuartile',\n    COMPLETE: 'complete',\n    MUTE: 'mute',\n    UNMUTE: 'unmute',\n    PAUSE: 'pause',\n    REWIND: 'rewind',\n    RESUME: 'resume',\n    FULLSCREEN: 'fullscreen',\n    EXPAND: 'expand',\n    COLLAPSE: 'collapse',\n    ACCEPTINVITATION: 'acceptInvitation',\n    CLOSE: 'close'\n};\n\n/**\n* @class VideoClicks\n* @ignore\n*/\nclass VideoClicks {\n    constructor () {\n        this.clickThrough = '';             // [Optional] URI to open as destination page when user clicks on the video\n        this.clickTracking = '';            // [Optional] URI to request for tracking purposes when user clicks on the video\n        this.customClick = '';              // [Optional] URI to request on custom events such as hotspotted video\n    }\n}\n\n/**\n* @class MediaFile\n* @ignore\n*/\nclass MediaFile {\n    constructor () {\n        this.id = '';                       // [Optional] Identifier\n        this.delivery = '';                 // [Required] Method of delivery of ad ('streaming' or 'progressive')\n        this.type = '';                     // [Required] MIME type\n        this.bitrate = 0;                   // [Optional] Bitrate of encoded video in Kbps\n        this.width = 0;                     // [Required] Pixel dimensions of video\n        this.height = 0;                    // [Required] Pixel dimensions of video\n        this.scalable = true;               // [Optional] Whether it is acceptable to scale the image.\n        this.maintainAspectRatio = true;    // [Optional] Whether the ad must have its aspect ratio maintained when scaled\n        this.apiFramework = '';             // [Optional] Defines the method to use for communication if the MediaFile is interactive.\n        this.uri = '';\n    }\n}\n\n// MediaFile delivery types\nMediaFile.DELIVERY = {\n    STREAMING: 'streaming',\n    PROGRESSIVE: 'progressive '\n};\n\n/**\n* @class StaticResource\n* @ignore\n*/\nclass StaticResource {\n    constructor () {\n        this.uRI = '';              // optional : URI to a static file, such as an image or SWF file\n        this.creativeType  ='';     // mime type of static resource\n    }\n}\n\n\nvar vast = {};\n\nvast.Vast = Vast;\nvast.Ad = Ad;\nvast.InLine = InLine;\nvast.Impression = Impression;\nvast.Extensions = Extensions;\nvast.Creative = Creative;\nvast.Linear = Linear;\nvast.Companion = Companion;\nvast.NonLinear = NonLinear;\nvast.TrackingEvent = TrackingEvent;\nvast.VideoClicks = VideoClicks;\nvast.MediaFile = MediaFile;\nvast.StaticResource = StaticResource;\n\nexport default vast;\n\nexport { Vast, Ad, InLine, Impression, Extensions, Creative, Linear, Companion, NonLinear, TrackingEvent, VideoClicks, MediaFile, StaticResource };\n"]}