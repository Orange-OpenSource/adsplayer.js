/*
* The copyright in this software module is being made available under the BSD License, included
* below. This software module may be subject to other third party and/or contributor rights,
* including patent rights, and no such rights are granted under this license.
*
* Copyright (c) 2016, Orange
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification, are permitted
* provided that the following conditions are met: 
* - Redistributions of source code must retain the above copyright notice, this list of conditions
*   and the following disclaimer.
* - Redistributions in binary form must reproduce the above copyright notice, this list of
*   conditions and the following disclaimer in the documentation and/or other materials provided
*   with the distribution.
* - Neither the name of Orange nor the names of its contributors may be used to endorse or promote
*   products derived from this software module without specific prior written permission.
*
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR
* IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER O
* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
* WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
* WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/* Last build : 2016-11-28_10:26:5 / git revision : 62ff64f */

/* jshint ignore:start */
!function e(t,i,n){function r(s,u){if(!i[s]){if(!t[s]){var o="function"==typeof require&&require;if(!u&&o)return o(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[s]={exports:{}};t[s][0].call(d.exports,function(e){var i=t[s][1][e];return r(i?i:e)},d,d.exports,e,t,i,n)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0}),i.AdsPlayer=void 0;var r=e("./src/AdsPlayer"),a=n(r),s="undefined"!=typeof window&&window||t,u=s.adsplayer;u||(u=s.adsplayer={}),u.AdsPlayer=a["default"],i["default"]=u,i.AdsPlayer=a["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/AdsPlayer":2}],2:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){this._error=e.data}function s(e){this._warning=e.data}Object.defineProperty(i,"__esModule",{value:!0});var u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("./AdsPlayerController"),l=n(o),d=e("./EventBus"),h=n(d),c="AdsPlayer",_="1.0.0",v="62ff64f",g="2016-11-28_10:26:5",f=function(){function e(t){r(this,e),this._adsPlayerContainer=t,this._error=null,this._warning=null,this._eventBus=h["default"].getInstance(),this._adsPlayerController=null,this.onErrorListener=a.bind(this),this.onWarningListener=s.bind(this)}return u(e,[{key:"getName",value:function(){return c}},{key:"init",value:function(e,t){this._adsPlayerController=new l["default"],this._adsPlayerController.init(e,this._adsPlayerContainer),this._eventBus.addEventListener("error",this.onErrorListener),this._eventBus.addEventListener("warning",this.onWarningListener),t()}},{key:"load",value:function(e,t){e.adsUrl?this._adsPlayerController.load(e.adsUrl).then(function(){t()})["catch"](function(){t()}):t()}},{key:"stop",value:function(){this._adsPlayerController.stop()}},{key:"reset",value:function(){this._adsPlayerController.reset()}},{key:"destroy",value:function(){this._adsPlayerController.destroy(),this._eventBus.removeEventListener("error",this.onErrorListener),this._eventBus.removeEventListener("warning",this.onWarningListener)}},{key:"getVersion",value:function(){return _}},{key:"getVersionFull",value:function(){return v.indexOf("@@")===-1?_+"_"+v:_}},{key:"getBuildDate",value:function(){return g.indexOf("@@")===-1?g:"Not a builded version"}},{key:"play",value:function(){this._adsPlayerController.play()}},{key:"pause",value:function(){this._adsPlayerController.pause()}},{key:"addEventListener",value:function(e,t,i){this._eventBus.addEventListener(e,t,i)}},{key:"removeEventListener",value:function(e,t){this._eventBus.removeEventListener(e,t)}},{key:"getError",value:function(){return this._error}},{key:"getWarning",value:function(){return this._warning}}]),e}();i["default"]=f},{"./AdsPlayerController":3,"./EventBus":6}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./Debug"),u=n(s),o=e("./FileLoader"),l=n(o),d=e("./ErrorHandler"),h=n(d),c=e("./EventBus"),_=n(c),v=e("./mast/MastParser"),g=n(v),f=e("./mast/TriggerManager"),y=n(f),m=e("./vast/VastParser"),p=n(m),E=e("./vast/VastPlayerManager"),k=n(E),b=function(){function e(){r(this,e),this._mainPlayer=null,this._mainVideo=null,this._adsPlayerContainer=null,this._mast=null,this._fileLoaders=[],this._triggerManagers=[],this._vastPlayerManager=null,this._mastParser=new g["default"],this._vastParser=new p["default"],this._errorHandler=h["default"].getInstance(),this._debug=u["default"].getInstance(),this._eventBus=_["default"].getInstance(),this._onVideoPlayingListener=this._onVideoPlaying.bind(this),this._onVideoTimeupdateListener=this._onVideoTimeupdate.bind(this),this._onVideoEndedListener=this._onVideoEnded.bind(this),this._onTriggerEndListener=this._onTriggerEnd.bind(this)}return a(e,[{key:"_loadVast",value:function(e){var t=this,i=new l["default"],n=null;return new Promise(function(r){t._debug.log("Download VAST file: "+e),i.load(e).then(function(e){t._debug.log("Parse VAST file"),n=t._vastParser.parse(e.response),n.baseUrl=e.baseUrl,r(n)})["catch"](function(e){e&&t._errorHandler.sendWarning(h["default"].LOAD_VAST_FAILED,"Failed to load VAST file",e),r(null)}),t._fileLoaders.push(i)})}},{key:"_loadTriggerVasts",value:function(e){var t,i,n=[];for(t=0;t<e.sources.length;t++)i=e.sources[t].uri,i.indexOf("http://")===-1&&(i=this._mast.baseUrl+i),n.push(this._loadVast(i));return new Promise(function(t,i){Promise.all(n).then(function(i){for(var n=0;n<i.length;n++)i[n]&&i[n].ad&&e.vasts.push(i[n]);t()})["catch"](function(){i()})})}},{key:"_parseMastFile",value:function(e,t){var i,n;if(this._mast=this._mastParser.parse(e),this._mast)for(this._mast.baseUrl=t,n=0;n<this._mast.triggers.length;n++)i=new y["default"],i.init(this._mast.triggers[n]),this._triggerManagers.push(i)}},{key:"_onVideoPlaying",value:function(){this._vastPlayerManager&&(this._debug.log("Pause main video"),this._mainVideo.pause())}},{key:"_onVideoTimeupdate",value:function(){var e=this._checkTriggersStart();null!==e&&this._activateTrigger(e)}},{key:"_onVideoEnded",value:function(){var e=this._checkTriggersStart();null!==e&&this._activateTrigger(e),this._checkTriggersEnd()}},{key:"_pauseVideo",value:function(){this._mainVideo.paused||(this._debug.log("Pause main video"),this._mainVideo.pause())}},{key:"_resumeVideo",value:function(){this._mainVideo.paused&&(this._debug.log("Resume main video"),this._mainVideo.play())}},{key:"_onTriggerEnd",value:function(){this._debug.log("End playing trigger"),this._vastPlayerManager&&(this._vastPlayerManager.reset(),this._vastPlayerManager=null);var e=this._checkTriggersStart();null!==e?this._activateTrigger(e):(this._eventBus.dispatchEvent({type:"end",data:null}),this._mainVideo.ended||this._resumeVideo())}},{key:"_playTrigger",value:function(e){0!==e.vasts.length&&(this._pauseVideo(),this._eventBus.dispatchEvent({type:"start",data:null}),this._debug.log("Start playing trigger "+e.id),this._vastPlayerManager=new k["default"],this._vastPlayerManager.init(e.vasts,this._adsPlayerContainer,this._mainVideo),this._vastPlayerManager.start())}},{key:"_activateTrigger",value:function(e){var t=this;this._vastPlayerManager||(this._debug.log("Activate trigger "+e.id),e.activated=!0,0===e.vasts.length?this._loadTriggerVasts(e).then(function(){t._playTrigger(e)}):this._playTrigger(e))}},{key:"_checkTriggersStart",value:function(){for(var e=0;e<this._triggerManagers.length;e++)if(this._triggerManagers[e].checkStartConditions(this._mainVideo))return this._triggerManagers[e].getTrigger();return null}},{key:"_checkTriggersEnd",value:function(){for(var e=0;e<this._triggerManagers.length;e++)this._triggerManagers[e].checkEndConditions(this._mainVideo)&&(this._triggerManagers.splice(0,1),e--)}},{key:"_start",value:function(){if(this._mast){0===this._mast.triggers.length&&this._debug.warn("No trigger in MAST");var e=this._checkTriggersStart();null!==e&&this._activateTrigger(e)}}}]),a(e,[{key:"init",value:function(e,t){this._mainPlayer=e,this._mainVideo=e.getVideoModel().getElement(),this._adsPlayerContainer=t,this._mainVideo.addEventListener("playing",this._onVideoPlayingListener),this._mainVideo.addEventListener("timeupdate",this._onVideoTimeupdateListener),this._mainVideo.addEventListener("seeking",this._onVideoTimeupdateListener),this._mainVideo.addEventListener("ended",this._onVideoEndedListener),this._eventBus.addEventListener("triggerEnd",this._onTriggerEndListener),this._debug.setLevel(4)}},{key:"load",value:function(e){var t=this,i=new l["default"];return this._mast=null,this._triggerManagers=[],this._debug.log("Download MAST file: "+e),new Promise(function(n,r){i.load(e).then(function(e){t._debug.log("Parse MAST file"),t._parseMastFile(e.response,e.baseUrl),t._debug.log("Start"),t._start(),n()})["catch"](function(e){e?(t._errorHandler.sendError(e.name,e.message,e.data),r(e)):n()}),t._fileLoaders.push(i)})}},{key:"stop",value:function(){this._debug.log("Stop");for(var e=0;e<this._fileLoaders.length;e++)this._fileLoaders[e].abort();this._fileLoaders=[],this._vastPlayerManager&&(this._vastPlayerManager.stop(),this._vastPlayerManager.reset(),this._vastPlayerManager=null,this._eventBus.dispatchEvent({type:"end",data:null}))}},{key:"reset",value:function(){this._debug.log("Reset"),this.stop(),this._triggerManagers=[],this._mast=null}},{key:"destroy",value:function(){this._debug.log("Destroy"),this.reset(),this._mainVideo.removeEventListener("playing",this._onVideoPlayingListener),this._mainVideo.removeEventListener("timeupdate",this._onVideoTimeupdateListener),this._mainVideo.removeEventListener("seeking",this._onVideoTimeupdateListener),this._mainVideo.removeEventListener("ended",this._onVideoEndedListener),this._eventBus.removeEventListener("triggerEnd",this._onTriggerEndListener)}},{key:"play",value:function(){this._debug.log("Play"),this._vastPlayerManager&&this._vastPlayerManager.play()}},{key:"pause",value:function(){this._debug.log("Pause"),this._vastPlayerManager&&this._vastPlayerManager.pause()}}]),e}();i["default"]=b},{"./Debug":4,"./ErrorHandler":5,"./EventBus":6,"./FileLoader":7,"./mast/MastParser":8,"./mast/TriggerManager":9,"./vast/VastParser":16,"./vast/VastPlayerManager":17}],4:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Date.prototype.HHMMSSmmm=function(){var e=this.getHours().toString(),t=this.getMinutes().toString(),i=this.getSeconds().toString(),n=this.getMilliseconds().toString(),r=e[1]?e:"0"+e[0],a=t[1]?t:"0"+t[0],s=i[1]?i:"0"+i[0],u=n[2]?n:"0"+(n[1]?n:"0"+n[0]);return r+":"+a+":"+s+"."+u},Date.prototype.MMSSmmm=function(){var e=this.getMinutes().toString(),t=this.getSeconds().toString(),i=this.getMilliseconds().toString(),n=e[1]?e:"0"+e[0],r=t[1]?t:"0"+t[0],a=i[2]?i:"0"+(i[1]?i:"0"+i[0]);return n+":"+r+"."+a};var a=function(){this.logArray=[],this.showLevel=!0};a.prototype.error=a.prototype.warn=a.prototype.info=a.prototype.debug=function(e){this.logArray.push(e)},a.prototype.getLogs=function(){return this.logArray};var s=0,u=1,o=2,l=3,d=4,h=4,c=null,_=function(){function e(){return n(this,e),null!==c?c:(this._level=4,this._showTimestamp=!0,this._showElapsedTime=!1,this._startTime=new Date,this._logger=console,c=this)}return r(e,[{key:"_getStringLevel",value:function(e){switch(e){case s:return"";case u:return"ERROR";case o:return"WARN";case l:return"INFO";case d:case h:return"DEBUG";default:return""}}},{key:"_prepareLog",value:function(e,t){var i="",n=null;return this.showTimestamp&&(n=new Date,i+="["+n.HHMMSSmmm()+"]"),this._logger&&this._logger.showLevel&&(i+="["+this._getStringLevel(e)+"]"),this.showElapsedTime&&(i+="["+new Date(n-this._startTime).MMSSmmm()+"]"),i+="[AdsPlayer] ",Array.apply(null,t).forEach(function(e){i+=e+" "}),i}},{key:"_log",value:function(e,t){if(e<=this.getLevel()){var i=this._prepareLog(e,t);switch(e){case u:this._logger.error(i);break;case o:this._logger.warn(i);break;case l:this._logger.info(i);break;case d:this._logger.debug(i)}}}}],[{key:"getInstance",value:function(){return null===c&&(c=new e),c}}]),r(e,[{key:"getLevel",value:function(){return this._level}},{key:"setLevel",value:function(e){this._level=e}},{key:"getLogger",value:function(){return this._logger}},{key:"setLogger",value:function(e){switch(e){case"memory":this._logger=new a;break;case"console":this._logger=console;break;default:this._logger=null}}},{key:"error",value:function(){this._log(u,arguments)}},{key:"warn",value:function(){this._log(o,arguments)}},{key:"info",value:function(){this._log(l,arguments)}},{key:"log",value:function(){this._log(d,arguments)}}]),e}();i["default"]=_},{}],5:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./Debug"),u=n(s),o=e("./EventBus"),l=n(o),d=null,h=function(){function e(){return r(this,e),null!==d?d:(this._eventBus=l["default"].getInstance(),this._debug=u["default"].getInstance(),d=this)}return a(e,null,[{key:"getInstance",value:function(){return null===d&&(d=new e),d}}]),a(e,[{key:"sendWarning",value:function(e,t,i){this._eventBus.dispatchEvent({type:"warning",data:{code:e,message:t,data:i}}),this._debug.warn("[Warn] Code: "+e+", Message: "+t+", Data: "+JSON.stringify(i,null,"\t"))}},{key:"sendError",value:function(e,t,i){this._eventBus.dispatchEvent({type:"error",data:{code:e,message:t,data:i}}),this._debug.error("[Error] Code: "+e+", Message: "+t+", Data: "+JSON.stringify(i,null,"\t"))}}]),e}();h.DOWNLOAD_ERR_FILES="DOWNLOAD_ERR_FILES",h.DOWNLOAD_ERR_NOT_XML="DOWNLOAD_ERR_NOT_XML",h.LOAD_VAST_FAILED="LOAD_VAST_FAILED",h.NO_VALID_MEDIA_FOUND="NO_VALID_MEDIA_FOUND",h.LOAD_MEDIA_FAILED="LOAD_MEDIA_FAILED",h.UNSUPPORTED_MEDIA_FILE="UNSUPPORTED_MEDIA_FILE",h.UNAVAILABLE_LINK="UNAVAILABLE_LINK",i["default"]=h},{"./Debug":4,"./EventBus":6}],6:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./Debug"),u=n(s),o=null,l=function(){function e(){return r(this,e),null!==o?o:(this._registrations={},this._debug=u["default"].getInstance(),o=this)}return a(e,[{key:"_getListeners",value:function(e,t){void 0===t&&(t=!1);var i=(t?"1":"0")+e;return i in this._registrations||(this._registrations[i]=[]),this._registrations[i]}}],[{key:"getInstance",value:function(){return null===o&&(o=new e),o}}]),a(e,[{key:"addEventListener",value:function(e,t,i){var n=this._getListeners(e,i),r=n.indexOf(t);r===-1&&n.push(t)}},{key:"removeEventListener",value:function(e,t,i){var n=this._getListeners(e,i),r=n.indexOf(t);r!==-1&&n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=this._getListeners(e.type,!1).slice(),i=0;for(i=0;i<t.length;i+=1)t[i].call(this,e);return!e.defaultPrevented}}]),e}();i["default"]=l},{"./Debug":4}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./ErrorHandler"),u=n(s),o=function(){function e(){r(this,e),this._request=null}return a(e,[{key:"_parseBaseUrl",value:function(e){var t=null;return e.indexOf("/")!==-1&&(e.indexOf("?")!==-1&&(e=e.substring(0,e.indexOf("?"))),t=e.substring(0,e.lastIndexOf("/")+1)),t}},{key:"_parseXml",value:function(e){if(!window.DOMParser)return null;try{var t=new window.DOMParser,i=t.parseFromString(e,"text/xml");if(i.getElementsByTagName("parsererror").length>0)throw new Error("Error parsing XML");return i}catch(n){return null}}},{key:"_abort",value:function(){null!==this._request&&this._request.readyState>0&&this._request.readyState<4&&this._request.abort()}},{key:"_load",value:function(e,t,i){var n=this._parseBaseUrl(e),r=!0,a=null,s=null,o=null,l=this;o=function(){this.aborted=!0},a=function(){if(!(this.status<200||this.status>299)&&200===this.status&&4===this.readyState){var e=this.responseXML||l._parseXml(this.responseText);if(null===e)return void(r=!0);this.responseURL&&(n=l._parseBaseUrl(this.responseURL)),r=!1,t({response:e,baseUrl:n})}},s=function(){r&&(r=!1,this.aborted?i():this.status<200||this.status>299?i({name:u["default"].DOWNLOAD_ERR_FILES,message:"Failed to download file",data:{url:e,status:this.status}}):null===this.responseXML&&i({name:u["default"].DOWNLOAD_ERR_NOT_XML,message:"The downloaded file format is not in xml format",data:{url:e}}))};try{this._request=new XMLHttpRequest,this._request.onload=a,this._request.onloadend=s,this._request.onerror=s,this._request.onabort=o,this._request.open("GET",e,!0),this._request.timeout=1e4,this._request.send()}catch(d){this._request.onerror()}}}]),a(e,[{key:"load",value:function(e){var t=this;return new Promise(function(i,n){t._load(e,i,n)})}},{key:"abort",value:function(){null!==this._request&&this._request.readyState>0&&this._request.readyState<4&&this._request.abort()}}]),e}();i["default"]=o},{"./ErrorHandler":5}],8:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./model/Mast"),u=n(s),o=e("../utils/xmldom"),l=n(o),d=function(){function e(){r(this,e)}return a(e,[{key:"_getCondition",value:function(e){var t=new u["default"].Condition,i=void 0;t.type=e.getAttribute("type"),t.name=e.getAttribute("name"),t.value=e.getAttribute("value"),t.operator=e.getAttribute("operator"),i=e.getElementsByTagName("condition");for(var n=0;n<i.length;n++)t.conditions.push(this._getCondition(i[n]));return t}},{key:"_getSource",value:function(e){var t=new u["default"].Source,i=void 0;t.uri=e.getAttribute("uri"),t.altReference=e.getAttribute("altReference"),t.format=e.getAttribute("format"),i=e.getElementsByTagName("source");for(var n=0;n<i.length;n++)t.sources.push(this._getSource(i[n]));return t}},{key:"_getTrigger",value:function(e){var t=new u["default"].Trigger,i=l["default"].getSubElements(e,"startConditions","condition"),n=l["default"].getSubElements(e,"endConditions","condition"),r=l["default"].getSubElements(e,"sources","source"),a=void 0;for(t.id=e.getAttribute("id"),t.description=e.getAttribute("description"),a=0;a<i.length;a++)t.startConditions.push(this._getCondition(i[a]));for(a=0;a<n.length;a++)t.endConditions.push(this._getCondition(n[a]));for(a=0;a<r.length;a++)t.sources.push(this._getSource(r[a]));return t}},{key:"_getTriggers",value:function(e,t){for(var i=l["default"].getSubElements(e,"triggers","trigger"),n=0;n<i.length;n++)t.triggers.push(this._getTrigger(i[n]))}}]),a(e,[{key:"parse",value:function(e){var t=new u["default"].Mast,i=l["default"].getElement(e,"MAST");return null===i?t:(this._getTriggers(i,t),t)}}]),e}();i["default"]=d},{"../utils/xmldom":13,"./model/Mast":10}],9:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("./model/Mast"),s=function(){function e(){n(this,e),this._trigger=null}return r(e,[{key:"_parseTime",value:function(e){var t,i=3600,n=60;return e?(t=e.split(":"),3!==t.length?-1:parseInt(t[0])*i+parseInt(t[1])*n+parseFloat(t[2])):-1}},{key:"_compareValues",value:function(e,t,i){var n=!1;if(e<0||t<0)return!1;switch(i){case a.Condition.OPERATOR.EQ:n=e===t;break;case a.Condition.OPERATOR.NEQ:n=e!==t;break;case a.Condition.OPERATOR.GTR:n=e>t;break;case a.Condition.OPERATOR.GEQ:n=e>=t;break;case a.Condition.OPERATOR.LT:n=e<t;break;case a.Condition.OPERATOR.LEQ:n=e<=t;break;case a.Condition.OPERATOR.MOD:n=e%t===0}return n}},{key:"_evaluateCondition",value:function(e,t){var i,n=!1;if(0===t.currentTime&&e.type===a.Condition.TYPE.EVENT&&e.name===a.Condition.NAME.ON_ITEM_START&&(n=!0),e.type===a.Condition.TYPE.PROPERTY)switch(e.name){case a.Condition.NAME.POSITION:n=this._compareValues(t.currentTime,this._parseTime(e.value),e.operator);break;case a.Condition.NAME.DURATION:n=this._compareValues(t.duration,this._parseTime(e.value),e.operator)}for(t.ended&&e.type===a.Condition.TYPE.EVENT&&e.name===a.Condition.NAME.ON_ITEM_END&&(n=!0),i=0;i<e.conditions.length;i++)n&=this._evaluateCondition(e.conditions[i],t);return n}},{key:"_evaluateConditions",value:function(e,t){var i,n=!1;for(i=0;i<e.length;i++)n|=this._evaluateCondition(e[i],t);return n}}]),r(e,[{key:"init",value:function(e){this._trigger=e}},{key:"getTrigger",value:function(){return this._trigger}},{key:"checkStartConditions",value:function(e){return!this._trigger.activated&&this._evaluateConditions(this._trigger.startConditions,e)}},{key:"checkEndConditions",value:function(e){return this._evaluateConditions(this._trigger.endConditions,e)}}]),e}();i["default"]=s},{"./model/Mast":10}],10:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function l(){n(this,l),this.baseUrl="",this.triggers=[]},a=function d(){n(this,d),this.id="",this.description=0,this.startConditions=[],this.endConditions=[],this.sources=[],this.alreadyProcessed=!1,this.vasts=[],this.activated=!1},s=function h(){n(this,h),this.type="",this.name="",this.value="",this.operator="",this.conditions=[]};s.TYPE={EVENT:"event",PROPERTY:"property"},s.NAME={ON_ITEM_START:"OnItemStart",ON_ITEM_END:"OnItemEnd",POSITION:"Position",DURATION:"Duration"},s.OPERATOR={EQ:"EQ",NEQ:"NEQ",GTR:"GTR",GEQ:"GEQ",LT:"LT",LEQ:"LEQ",MOD:"MOD"};var u=function c(){n(this,c),this.uri="",this.altReference="",this.format="",this.sources=[]};u.FORMAT={VAST:"vast",UIF:"uif"};var o={};o.Mast=r,o.Trigger=a,o.Condition=s,o.Source=u,i["default"]=o,i.Mast=r,i.Trigger=a,i.Condition=s,i.Source=u},{}],11:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("../Debug"),u=n(s),o=function(){function e(){r(this,e),this._uri="",this._image=null,this._duration=0,this._currentTime=0,this._listeners={},this._timerInterval=null,this._timerTime=-1,this._events=["play","pause","timeupdate","ended"],this._debug=u["default"].getInstance()}return a(e,[{key:"_getListeners",value:function(e){return e in this._listeners||(this._listeners[e]=[]),this._listeners[e]}},{key:"_addEventListener",value:function(e,t){var i=this._getListeners(e),n=i.indexOf(t);n===-1&&i.push(t)}},{key:"_removeEventListener",value:function(e,t){var i=this._getListeners(e),n=i.indexOf(t);n!==-1&&i.splice(n,1)}},{key:"_notifyEvent",value:function(e){var t=this._getListeners(e),i=0;for(i=0;i<t.length;i++)t[i].call(this)}},{key:"_updateCurrentTime",value:function(){var e=(new Date).getTime();this._currentTime+=(e-this._timerTime)/1e3,this._notifyEvent("timeupdate"),this._currentTime>=this._duration&&(this._stopTimer(),this._notifyEvent("ended")),this._timerTime=e}},{key:"_startTimer",value:function(){null===this._timerInterval&&(this._notifyEvent("play"),this._timerTime=(new Date).getTime(),this._timerInterval=setInterval(this._updateCurrentTime.bind(this),200))}},{key:"_stopTimer",value:function(){null!==this._timerInterval&&(this._notifyEvent("pause"),clearInterval(this._timerInterval),this._timerInterval=null)}}]),a(e,[{key:"load",value:function(e,t){var i,n,r=null;for(n=0;n<t.length;n++)if(i=t[n].type,"image/jpeg"===i||"image/jpg"===i||"image/png"===i||"image/gif"===i){r=t[n];break}return null!==r&&(this._image=document.getElementById("adsplayer-image"),this._image||(this._image=document.createElement("img"),this._image.autoplay=!1,this._image.id="adsplayer-image"),this._uri=r.uri,this._uri=this._uri.indexOf("http://")===-1?e+this._uri:this._uri,this._debug.log("Load image media, uri = "+this._uri),this._image.src=this._uri,this._currentTime=0,!0)}},{key:"getType",value:function(){return"image"}},{key:"getElement",value:function(){return this._image}},{key:"addEventListener",value:function(e,t){this._image&&(this._events.indexOf(e)!==-1?this._addEventListener(e,t):this._image.addEventListener(e,t))}},{key:"removeEventListener",value:function(e,t){this._image&&(this._events.indexOf(e)!==-1?this._removeEventListener(e,t):this._image.removeEventListener(e,t))}},{key:"setDuration",value:function(e){this._duration=e}},{key:"getDuration",value:function(){return this._duration}},{key:"getCurrentTime",value:function(){return this._currentTime}},{key:"setVolume",value:function(){}},{key:"getVolume",value:function(){return 0}},{key:"play",value:function(){this._image&&this._startTimer()}},{key:"pause",value:function(){this._image&&this._stopTimer()}},{key:"stop",value:function(){this._image&&this._stopTimer()}},{key:"reset",value:function(){this._image&&(this._image=null,this._listeners={})}}]),e}();i["default"]=o},{"../Debug":4}],12:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("../Debug"),u=n(s),o=function(){function e(){r(this,e),this._uri="",this._video=null,this._debug=u["default"].getInstance()}return a(e,[{key:"isMediaSupported",value:function(e){if(!this._video)throw"isMediaSupported(): element not created";if(!(this._video instanceof HTMLMediaElement))throw"isMediaSupported(): element must be of type HTMLMediaElement";var t=this._video.canPlayType(e);return"probably"===t||"maybe"===t}}]),a(e,[{key:"load",value:function(e,t){return this._video=document.getElementById("adsplayer-video"),this._video||(this._video=document.createElement("video"),this._video.autoplay=!1,this._video.id="adsplayer-video"),!!this.isMediaSupported(t[0].type)&&(t.sort(function(e,t){return e.bitrate&&t.bitrate?e.bitrate-t.bitrate:-1}),this._uri=t[0].uri,this._uri=this._uri.indexOf("http://")===-1?e+this._uri:this._uri,this._debug.log("Load video media, uri = "+this._uri),this._video.addEventListener("error",function(e){console.log(e)}),this._video.src=this._uri,!0)}},{key:"getType",value:function(){return"video"}},{key:"getElement",value:function(){return this._video}},{key:"addEventListener",value:function(e,t){this._video&&this._video.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._video&&this._video.removeEventListener(e,t)}},{key:"setDuration",value:function(){}},{key:"getDuration",value:function(){return this._video?this._video.duration:0}},{key:"getCurrentTime",value:function(){return this._video?this._video.currentTime:0}},{key:"getVolume",value:function(){return this._video?this._video.muted?0:this._video.volume:0}},{key:"setVolume",value:function(e){this._video&&(this._video.volume=e)}},{key:"play",value:function(){this._video&&this._video.play()}},{key:"stop",value:function(){this._video&&this._video.pause()}},{key:"pause",value:function(){this._video&&this._video.pause()}},{key:"reset",value:function(){this._video&&(this._video=null)}}]),e}();i["default"]=o},{"../Debug":4}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n={};n.getElementsByTagName=function(e,t){var i=e.getElementsByTagName(t);if(i.length<1){var n=e.firstElementChild||e.firstChild;if(n){var r=n.namespaceURI;i=e.getElementsByTagNameNS(r,t)}}return i},n.getElement=function(e,t){var i=this.getElementsByTagName(e,t);return i.length<1?null:i[0]},n.getElements=function(e,t){return this.getElementsByTagName(e,t)},n.getSubElements=function(e,t,i){var n=this.getElement(e,t);return null===n?[]:this.getElements(n,i)},n.getChildNode=function(e,t){if(!e||!e.childNodes)return null;for(var i=0;i<e.childNodes.length;i++)if(e.childNodes[i].nodeName===t)return e.childNodes[i];return null},n.getNodeTextValue=function(e){var t=this.getChildNode(e,"#cdata-section"),i=this.getChildNode(e,"#text");return t?t.nodeValue:i?i.nodeValue:""},n.getChildNodeTextValue=function(e,t){var i=this.getElement(e,t);return null===i?"":this.getNodeTextValue(i)},i["default"]=n},{}],14:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./TrackingEventsManager"),u=n(s),o=e("../media/VideoPlayer"),l=n(o),d=e("../media/ImagePlayer"),h=n(d),c=e("../Debug"),_=n(c),v=e("../EventBus"),g=n(v),f=function(){function e(){r(this,e),this._adPlayerContainer=null,this._mediaPlayer=null,this._trackingEventsManager=null,this._mainVideo=null,this._debug=_["default"].getInstance(),this._eventBus=g["default"].getInstance(),this._onMediaPlayListener=this._onMediaPlay.bind(this),this._onMediaPauseListener=this._onMediaPause.bind(this),this._onMediaErrorListener=this._onMediaError.bind(this),this._onMediaTimeupdateListener=this._onMediaTimeupdate.bind(this),this._onMediaEndedListener=this._onMediaEnded.bind(this)}return a(e,[{key:"_parseTime",value:function(e){var t,i=3600,n=60;return e?(t=e.split(":"),3!==t.length?-1:parseInt(t[0])*i+parseInt(t[1])*n+parseFloat(t[2])):-1}},{key:"_onMediaPlay",value:function(){this._debug.log("Creative media play"),this._eventBus.dispatchEvent({type:"play",data:{}})}},{key:"_onMediaPause",value:function(){this._debug.log("Creative media pause"),this._eventBus.dispatchEvent({type:"pause",data:{}})}},{key:"_onMediaError",value:function(){this._debug.log("Creative media error"),this._eventBus.dispatchEvent({type:"creativeEnd",data:{}})}},{key:"_onMediaEnded",value:function(){this._debug.log("creative media ended"),this._eventBus.dispatchEvent({type:"creativeEnd",data:{}})}},{key:"_onMediaTimeupdate",
value:function(){}},{key:"_onAdClick",value:function(){this.videoClicks&&(this._debug.log("Creative Click"),this.videoClicks.clickThrough&&(this._debug.log("Ad click, uri = "+this.videoClicks.clickThrough),this._eventBus.dispatchEvent({type:"click",data:{uri:this.videoClicks.clickThrough}})))}},{key:"_load",value:function(e,t){var i,n,r;if(!e)return!1;if(0===e.mediaFiles.length)return!1;if(i=e.mediaFiles[0],n=i.type.indexOf("video")!==-1,r=i.type.indexOf("image")!==-1,n)this._mediaPlayer=new l["default"];else{if(!r)return!1;this._mediaPlayer=new h["default"]}return this._debug.log("Creative load"),this._mediaPlayer.load(t,e.mediaFiles)?(this._mediaPlayer.setDuration(this._parseTime(e.duration)),this._mediaPlayer.addEventListener("play",this._onMediaPlayListener),this._mediaPlayer.addEventListener("pause",this._onMediaPauseListener),this._mediaPlayer.addEventListener("error",this._onMediaErrorListener),this._mediaPlayer.addEventListener("timeupdate",this._onMediaTimeupdateListener),this._mediaPlayer.addEventListener("ended",this._onMediaEndedListener),e.trackingEvents&&(this._trackingEventsManager=new u["default"],this._trackingEventsManager.init(e.trackingEvents,this._mediaPlayer),this._trackingEventsManager.start()),this._eventBus.dispatchEvent({type:"creativeStart",data:{}}),this._eventBus.dispatchEvent({type:"addElement",data:{element:this._mediaPlayer.getElement(),type:this._mediaPlayer.getType()}}),this._adPlayerContainer.appendChild(this._mediaPlayer.getElement()),e.videoClicks&&(e.videoClicks.clickThrough&&(this._mediaPlayer.getElement().style.cursor="pointer"),this._mediaPlayer.getElement().addEventListener("click",this._onAdClick.bind(e).bind(this))),this._onMainVideoVolumeChange(),this._play(),!0):(this._mediaPlayer=null,!1)}},{key:"_play",value:function(){this._mediaPlayer&&(this._debug.log("Creative play"),this._mediaPlayer.play())}},{key:"_pause",value:function(){this._mediaPlayer&&(this._debug.log("Creative pause"),this._mediaPlayer.pause())}},{key:"_stop",value:function(){this._mediaPlayer&&(this._debug.log("Creative stop"),this._mediaPlayer.removeEventListener("play",this._onMediaPlayListener),this._mediaPlayer.removeEventListener("pause",this._onMediaPauseListener),this._mediaPlayer.removeEventListener("error",this._onMediaErrorListener),this._mediaPlayer.removeEventListener("timeupdate",this._onMediaTimeupdateListener),this._mediaPlayer.removeEventListener("ended",this._onMediaEndedListener),this._mediaPlayer.stop(),this._eventBus.dispatchEvent({type:"removeElement",data:{element:this._mediaPlayer.getElement(),type:this._mediaPlayer.getType()}}),this._adPlayerContainer.removeChild(this._mediaPlayer.getElement()),this._mediaPlayer.reset(),this._mediaPlayer=null,this._trackingEventsManager&&(this._trackingEventsManager.stop(),this._trackingEventsManager=null))}},{key:"_onMainVideoVolumeChange",value:function(){this._mediaPlayer&&this._mediaPlayer.setVolume(this._mainVideo.muted?0:this._mainVideo.volume)}}]),a(e,[{key:"init",value:function(e,t){this._adPlayerContainer=e,this._mainVideo=t,this._mainVideo.addEventListener("volumechange",this._onMainVideoVolumeChange.bind(this))}},{key:"load",value:function(e,t){return this._load(e,t)}},{key:"play",value:function(){this._play()}},{key:"pause",value:function(){this._pause()}},{key:"stop",value:function(){this._stop()}},{key:"reset",value:function(){this._mainVideo.removeEventListener("volumechange",this._onMainVideoVolumeChange),this._mainVideo=null}}]),e}();i["default"]=f},{"../Debug":4,"../EventBus":6,"../media/ImagePlayer":11,"../media/VideoPlayer":12,"./TrackingEventsManager":15}],15:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("../Debug"),u=n(s),o=function(){function e(){r(this,e),this._trackingEvents=null,this._adMediaPlayer=null,this._currentTime=-1,this._mute=-1,this._unmute=-1,this._debug=u["default"].getInstance(),this._eventListeners=[]}return a(e,[{key:"_postEvent",value:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Content-Type","application/json; charset=UTF-8"),t.send()}},{key:"_addEventListener",value:function(e,t,i){var n=this,r=function(){this.completed!==!0&&void 0!==this.uri&&0!==this.uri.length&&(this.condition&&!this.condition()||(n._debug.log("Send tracking event "+this.event+", uri = "+this.uri),n._postEvent(this.uri),this.oneShot===!0&&(this.completed=!0)))},a={type:t,element:e,listener:r.bind(i)};e.addEventListener(t,a.listener),this._eventListeners.push(a)}},{key:"_addPlayerEventListeners",value:function(){for(var e=this,t=0;t<this._trackingEvents.length;t++){var i=this._trackingEvents[t];if(i.uri&&i.uri.length>0)switch(i.event){case"creativeView":i.oneShot=!0,this._addEventListener(this._adMediaPlayer,"loadeddata",i);break;case"start":i.oneShot=!0,this._addEventListener(this._adMediaPlayer,"playing",i);break;case"pause":i.oneShot=!1,this._addEventListener(this._adMediaPlayer,"paused",i);break;case"resume":i.oneShot=!1,i.condition=function(){return e._adMediaPlayer.getCurrentTime()>0},this._addEventListener(this._adMediaPlayer,"play",i);break;case"firstQuartile":i.oneShot=!0,i.condition=function(){return e._adMediaPlayer.getCurrentTime()/e._adMediaPlayer.getDuration()>=.25},this._addEventListener(this._adMediaPlayer,"timeupdate",i);break;case"midpoint":i.oneShot=!0,i.condition=function(){return e._adMediaPlayer.getCurrentTime()/e._adMediaPlayer.getDuration()>=.5},this._addEventListener(this._adMediaPlayer,"timeupdate",i);break;case"thirdQuartile":i.oneShot=!0,i.condition=function(){return e._adMediaPlayer.getCurrentTime()/e._adMediaPlayer.getDuration()>=.75},this._addEventListener(this._adMediaPlayer,"timeupdate",i);break;case"rewind":i.oneShot=!1,i.condition=function(){var t=e._adMediaPlayer.getCurrentTime()<e._currentTime;return e._currentTime=e._adMediaPlayer.getCurrentTime(),t},this._addEventListener(this._adMediaPlayer,"timeupdate",i);break;case"complete":this._addEventListener(this._adMediaPlayer,"ended",i);break;case"mute":i.oneShot=!1,i.condition=function(){var t=!e._mute&&0===e._adMediaPlayer.getVolume();return e._mute=0===e._adMediaPlayer.getVolume(),t},this._addEventListener(this._adMediaPlayer,"volumechange",i);break;case"unmute":i.oneShot=!1,i.condition=function(){var t=!e._unmute&&e._adMediaPlayer.getVolume()>0;return e._unmute=e._adMediaPlayer.getVolume()>0,t},this._addEventListener(this._adMediaPlayer,"volumechange",i);break;case"fullscreen":i.oneShot=!1,i.condition=function(){return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen},this._addEventListener(document,"webkitfullscreenchange",i),this._addEventListener(document,"mozfullscreenchange",i),this._addEventListener(document,"MSFullscreenChange",i),this._addEventListener(document,"fullscreenChange",i)}}}},{key:"_removePlayerEventListeners",value:function(){for(var e=0;e<this._eventListeners.length;e++)this._eventListeners[e].element.removeEventListener(this._eventListeners[e].type,this._eventListeners[e].listener);this._eventListeners=[]}}]),a(e,[{key:"init",value:function(e,t){this._trackingEvents=e,this._adMediaPlayer=t,this._mute=0===this._adMediaPlayer.getVolume(),this._unmute=this._adMediaPlayer.getVolume()>0}},{key:"start",value:function(){0!==this._trackingEvents.length&&this._addPlayerEventListeners()}},{key:"stop",value:function(){this._removePlayerEventListeners()}}]),e}();i["default"]=o},{"../Debug":4}],16:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./model/Vast"),u=n(s),o=e("../utils/xmldom"),l=n(o),d=function(){function e(){r(this,e)}return a(e,[{key:"_getTrackingEvent",value:function(e){var t=new u["default"].TrackingEvent;return t.event=e.getAttribute("event"),t.uri=l["default"].getNodeTextValue(e),t}},{key:"_getVideoClicks",value:function(e){for(var t=new u["default"].VideoClicks,i=void 0,n=void 0,r=0;r<e.childNodes.length;r++)switch(i=e.childNodes[r].nodeName,n=l["default"].getNodeTextValue(e.childNodes[r]),i){case"ClickThrough":t.clickThrough=n;break;case"ClickTracking":t.clickTracking=n;break;case"CustomClick":t.customClick=n}return t}},{key:"_getMediaFile",value:function(e){var t=new u["default"].MediaFile;return t.id=e.getAttribute("id"),t.delivery=e.getAttribute("delivery"),t.type=e.getAttribute("type"),t.bitrate=e.getAttribute("bitrate"),t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.scalable=e.getAttribute("scalable"),t.maintainAspectRatio=e.getAttribute("maintainAspectRatio"),t.apiFramework=e.getAttribute("apiFramework"),t.uri=l["default"].getNodeTextValue(e),t}},{key:"_getLinear",value:function(e){var t=new u["default"].Linear,i=void 0,n=void 0,r=void 0,a=void 0;for(t.duration=l["default"].getChildNodeTextValue(e,"Duration"),t.adParameters=l["default"].getChildNodeTextValue(e,"AdParameters"),i=l["default"].getSubElements(e,"TrackingEvents","Tracking"),a=0;a<i.length;a++)t.trackingEvents.push(this._getTrackingEvent(i[a]));for(n=l["default"].getElement(e,"VideoClicks"),n&&(t.videoClicks=this._getVideoClicks(n)),r=l["default"].getSubElements(e,"MediaFiles","MediaFile"),a=0;a<r.length;a++)t.mediaFiles.push(this._getMediaFile(r[a]));return t}},{key:"_getCreative",value:function(e){var t=new u["default"].Creative,i=void 0;return t.id=e.getAttribute("id"),t.adId=e.getAttribute("AdID"),t.sequence=e.getAttribute("sequence"),i=l["default"].getElement(e,"Linear"),i&&(t.linear=this._getLinear(i)),t}},{key:"_getInLine",value:function(e){var t=new u["default"].InLine,i=l["default"].getElement(e,"InLine"),n=void 0,r=void 0,a=void 0;if(null===i)return null;for(t.adSystem=l["default"].getChildNodeTextValue(i,"AdSystem"),t.adTitle=l["default"].getChildNodeTextValue(i,"AdTitle"),t.description=l["default"].getChildNodeTextValue(i,"Description"),t.survey=l["default"].getChildNodeTextValue(i,"Survey"),t.error=l["default"].getChildNodeTextValue(i,"Error"),n=l["default"].getElements(i,"Impression"),a=0;a<n.length;a++){var s=new u["default"].Impression;s.id=n[a].getAttribute("id"),s.uri=l["default"].getNodeTextValue(n[a]),t.impressions.push(s)}for(r=l["default"].getSubElements(i,"Creatives","Creative"),a=0;a<r.length;a++)t.creatives.push(this._getCreative(r[a]));return t}},{key:"_getAd",value:function(e,t){var i=l["default"].getElement(e,"Ad");null!==i&&(t.ad=new u["default"].Ad,t.ad.id=i.getAttribute("id"),t.ad.inLine=this._getInLine(i))}}]),a(e,[{key:"parse",value:function(e){var t=new u["default"].Vast,i=l["default"].getElement(e,"VAST");return null===i?t:(t.version=i.getAttribute("version"),this._getAd(i,t),t)}}]),e}();i["default"]=d},{"../utils/xmldom":13,"./model/Vast":18}],17:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./CreativePlayer"),u=n(s),o=e("../Debug"),l=n(o),d=e("../ErrorHandler"),h=n(d),c=e("../EventBus"),_=n(c),v=function(){function e(){r(this,e),this._vasts=[],this._adPlayerContainer=null,this._vastIndex=-1,this._creativeIndex=-1,this._creativePlayer=new u["default"],this._errorHandler=h["default"].getInstance(),this._debug=l["default"].getInstance(),this._eventBus=_["default"].getInstance(),this._mediaPlayer=null,this._onCreativeEndListener=this._onCreativeEnd.bind(this)}return a(e,[{key:"_sendImpressions",value:function(e){var t=void 0;if(0!==e.length)for(var i=0;i<e.length;i++)if(t=e[i],t.uri&&t.uri.length>0){this._debug.log("Send Impression, uri = "+t.uri);var n=new XMLHttpRequest;n.open("GET",t.uri,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send()}}},{key:"_onCreativeEnd",value:function(){this._debug.log("Creative ended"),this._stopCreative(),this._playNextCreative()}},{key:"_pauseCreative",value:function(){this._creativePlayer&&this._creativePlayer.pause()}},{key:"_resumeCreative",value:function(){this._creativePlayer&&this._creativePlayer.play()}},{key:"_stopCreative",value:function(){this._creativePlayer&&(this._eventBus.removeEventListener("creativeEnd",this._onCreativeEndListener),this._creativePlayer.stop())}},{key:"_playCreative",value:function(e){var t,i=this._vasts[this._vastIndex].ad.inLine.creatives[e];this._creativeIndex=e,this._debug.log("Play Creative - index = "+this._creativeIndex),t=i.linear,t?(this._debug.log("Play Linear Ad, duration = "+t.duration),this._eventBus.addEventListener("creativeEnd",this._onCreativeEndListener),this._creativePlayer.load(i.linear,this._vasts[this._vastIndex].baseUrl)||this._playNextCreative()):this._playNextCreative()}},{key:"_playVast",value:function(e){var t=this._vasts[e],i=t.ad;null!==i&&(this._vastIndex=e,this._debug.log("Play Vast - index = "+this._vastIndex+", Ad id = "+i.id),this._sendImpressions(i.inLine.impressions),this._playCreative(0))}},{key:"_playNextVast",value:function(){this._vastIndex++,this._vastIndex<this._vasts.length?this._playVast(this._vastIndex):this._eventBus.dispatchEvent({type:"triggerEnd",data:{}})}},{key:"_playNextCreative",value:function(){var e=this._vasts[this._vastIndex].ad;this._creativeIndex++,this._creativeIndex<e.inLine.creatives.length?this._playCreative(this._creativeIndex):this._playNextVast()}}]),a(e,[{key:"init",value:function(e,t,i){this._vasts=e,this._adPlayerContainer=t,this._creativePlayer.init(this._adPlayerContainer,i)}},{key:"start",value:function(){this._vasts&&0!==this._vasts.length&&(this._eventBus.dispatchEvent({type:"triggerStart",data:{}}),this._playVast(0))}},{key:"play",value:function(){this._resumeCreative()}},{key:"pause",value:function(){this._pauseCreative()}},{key:"stop",value:function(){this._stopCreative()}},{key:"reset",value:function(){this._creativePlayer.reset()}}]),e}();i["default"]=v},{"../Debug":4,"../ErrorHandler":5,"../EventBus":6,"./CreativePlayer":14}],18:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function m(){n(this,m),this.version="",this.ad=null},a=function p(){n(this,p),this.id="",this.inLine=null,this.wrapper=null},s=function E(){n(this,E),this.adSystem="",this.adTitle="",this.description="",this.survey="",this.error="",this.impressions=[],this.creatives=[],this.extensions=[]},u=function k(){n(this,k),this.uri="",this.id=""},o=function b(){n(this,b),this.uri="",this.other=""},l=function P(){n(this,P),this.id="",this.adId="",this.sequence=0,this.linear=null,this.CompanionAds=[],this.nonLinearAds=[]};l.TYPE={LINEAR:"linear",NON_LINEAR_ADS:"NonLinearAds",COMPANION_ADS:"CompanionAds"};var d=function T(){n(this,T),this.duration=0,this.trackingEvents=[],this.adParameters="",this.videoClicks=null,this.mediaFiles=[]},h=function L(){n(this,L),this.id="",this.width=0,this.height=0,this.staticResource=null,this.iFrameResource="",this.hTMLResource="",this.trackingEvents=[],this.clickThrough="",this.altText="",this.adParameters=""},c=function M(){n(this,M),this.id="",this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.apiFramework="",this.staticResource=null,this.hTMLResource="",this.trackingEvents=[],this.clickThrough="",this.adParameters=""},_=function C(){n(this,C),this.uri="",this.event=""};_.TYPE={CREATIVEVIEW:"creativeView",START:"start",MIDPOINT:"midpoint",FIRSTQUARTILE:"firstQuartile",THIRDQUARTILE:"thirdQuartile",COMPLETE:"complete",MUTE:"mute",UNMUTE:"unmute",PAUSE:"pause",REWIND:"rewind",RESUME:"resume",FULLSCREEN:"fullscreen",EXPAND:"expand",COLLAPSE:"collapse",ACCEPTINVITATION:"acceptInvitation",CLOSE:"close"};var v=function w(){n(this,w),this.clickThrough="",this.clickTracking="",this.customClick=""},g=function A(){n(this,A),this.id="",this.delivery="",this.type="",this.bitrate=0,this.width=0,this.height=0,this.scalable=!0,this.maintainAspectRatio=!0,this.apiFramework="",this.uri=""};g.DELIVERY={STREAMING:"streaming",PROGRESSIVE:"progressive "};var f=function V(){n(this,V),this.uRI="",this.creativeType=""},y={};y.Vast=r,y.Ad=a,y.InLine=s,y.Impression=u,y.Extensions=o,y.Creative=l,y.Linear=d,y.Companion=h,y.NonLinear=c,y.TrackingEvent=_,y.VideoClicks=v,y.MediaFile=g,y.StaticResource=f,i["default"]=y,i.Vast=r,i.Ad=a,i.InLine=s,i.Impression=u,i.Extensions=o,i.Creative=l,i.Linear=d,i.Companion=h,i.NonLinear=c,i.TrackingEvent=_,i.VideoClicks=v,i.MediaFile=g,i.StaticResource=f},{}]},{},[1]);
/* jshint ignore:end */
//# sourceMappingURL=adsplayer.js.map
